import { __decorate, __metadata } from "tslib";
import { ApplicationRef, ComponentFactoryResolver, ComponentRef, EmbeddedViewRef, Injectable, Injector } from '@angular/core';
import { Subject } from 'rxjs';
import { finalize, startWith } from 'rxjs/operators';
import { FormBuilderComponent } from '../../form/form-builder/form-builder.component';
var DialogService = /** @class */ (function () {
    function DialogService(componentFactoryResolver, appRef, injector) {
        this.componentFactoryResolver = componentFactoryResolver;
        this.appRef = appRef;
        this.injector = injector;
    }
    /**
     * Create a custom dialog
     * @param options The options of the dialog
     */
    DialogService.prototype.create = function (options) {
        return window.Metro.dialog.create(options);
    };
    /**
     * Close a created dialog
     * @param dialogObj The object returned by the create method
     */
    DialogService.prototype.close = function (dialogObj) {
        return window.Metro.dialog.close(dialogObj);
    };
    /**
     * Shows an alert dialog
     * @param title The title of the dialog
     * @param message The message of the dialog
     * @param cls Optional css classes
     * @param okBtnText The text of the OK-Button
     * @param okBtnCls An optional css class for the OK-Button
     */
    DialogService.prototype.alert = function (title, message, cls, okBtnText, okBtnCls) {
        var _this = this;
        var subject$ = new Subject();
        var options = {
            title: title,
            content: message,
            clsDialog: cls,
            overlayClickClose: true
        };
        if (okBtnText) {
            options.actions = [{
                    caption: okBtnText,
                    cls: (okBtnCls ? okBtnCls : '') + ' js-dialog-close',
                    onclick: function () {
                        subject$.next();
                        subject$.complete();
                    }
                }];
        }
        var alertObj = this.create(options);
        return subject$.asObservable().pipe(finalize(function () {
            _this.close(alertObj);
        }));
    };
    /**
     * Shows a confirm dialog
     * @param title The title of the confirm
     * @param message The message of the confirm
     * @param yesBtnText The text for the Yes-Button
     * @param noBtnText The text for the No-Button
     * @param cls An optional css class for the dialog
     * @param yesBtnCls An optional css class for the Yes-Button
     * @param noBtnCls An optional css class for the No-Button
     */
    DialogService.prototype.confirm = function (title, message, yesBtnText, noBtnText, cls, yesBtnCls, noBtnCls) {
        var _this = this;
        var subject$ = new Subject();
        var options = {
            title: title,
            content: message,
            actions: [
                {
                    caption: yesBtnText ? yesBtnText : 'Yes',
                    cls: (yesBtnCls ? yesBtnCls : 'success') + ' js-dialog-close',
                    onclick: function () {
                        subject$.next(true);
                        subject$.complete();
                    }
                },
                {
                    caption: noBtnText ? noBtnText : 'No',
                    cls: (noBtnCls ? noBtnCls : 'alert') + ' js-dialog-close',
                    onclick: function () {
                        subject$.next(false);
                        subject$.complete();
                    }
                }
            ],
            clsDialog: cls
        };
        var confirmObj = this.create(options);
        return subject$.asObservable().pipe(finalize(function () {
            _this.close(confirmObj);
        }));
    };
    /**
     * Show a prompt dialog
     * @param title The title of the prompt
     * @param message The message of the prompt
     * @param submitBtnText The text of the Submit-Button
     * @param placeholder The placeholder of the input
     * @param cls An optional css class for the dialog
     * @param submitBtnCls An optional css class for Submit-Button
     * @param inputCls An optional css class for the input
     */
    DialogService.prototype.prompt = function (title, message, submitBtnText, placeholder, cls, submitBtnCls, inputCls) {
        var _this = this;
        var subject$ = new Subject();
        var options = {
            title: title,
            content: (message ? message : '') +
                ("<br><input data-role=\"input\" type=\"text\" class=\"" + inputCls + "\" placeholder=\"" + (placeholder ? placeholder : '') + "\" />"),
            actions: [
                {
                    caption: submitBtnText ? submitBtnText : 'Submit',
                    cls: (submitBtnCls ? submitBtnCls : 'success') + ' js-dialog-close',
                    onclick: function () {
                        subject$.next(value);
                        subject$.complete();
                    }
                }
            ],
            clsDialog: cls
        };
        var promptObj = this.create(options);
        var input = promptObj.find('input');
        var value = '';
        input.on('change', function () {
            value = input.val();
        });
        return subject$.asObservable().pipe(finalize(function () {
            _this.close(promptObj);
        }));
    };
    /**
     * Show a prompt dialog that contains a form
     * @param title The title of the prompt
     * @param form The form group
     * @param submitBtnText The text of the Submit-Button
     * @param abortBtnText The text of the Abort-Button
     * @param placeholder The placeholder of the input
     * @param cls An optional css class for the dialog
     * @param submitBtnCls An optional css class for Submit-Button
     * @param abortBtnCls An optional css class for Abort-Button
     */
    DialogService.prototype.formPrompt = function (title, form, submitBtnText, abortBtnText, placeholder, cls, submitBtnCls, abortBtnCls) {
        var _this = this;
        var componentRef = this.componentFactoryResolver.resolveComponentFactory(FormBuilderComponent).create(this.injector);
        componentRef.instance.formGroup = form;
        this.appRef.attachView(componentRef.hostView);
        var domElement = componentRef.hostView.rootNodes[0];
        var subject$ = new Subject();
        var options = {
            title: title,
            content: 'content',
            actions: [
                {
                    caption: abortBtnText ? abortBtnText : 'Abort',
                    cls: abortBtnCls ? abortBtnCls : 'warning',
                    onclick: function () {
                        subject$.next(null);
                        subject$.complete();
                    }
                },
                {
                    caption: submitBtnText ? submitBtnText : 'Submit',
                    cls: (submitBtnCls ? submitBtnCls : 'success') + ' submit-btn',
                    onclick: function () {
                        subject$.next(form.value);
                        subject$.complete();
                    }
                }
            ],
            clsDialog: cls
        };
        var promptObj = this.create(options);
        promptObj.find('.dialog-content').empty().append(domElement);
        var formStateSubscription = form.statusChanges.pipe(startWith(form.status)).subscribe(function (valid) {
            var submitBtn = promptObj.find('.dialog-actions button.submit-btn');
            if (valid === 'VALID') {
                submitBtn.removeAttr('disabled');
            }
            else {
                submitBtn.attr('disabled', 'disabled');
            }
        });
        return subject$.asObservable().pipe(finalize(function () {
            _this.close(promptObj);
            componentRef.destroy();
            formStateSubscription.unsubscribe();
        }));
    };
    /**
     * Show a dialog that contains a component
     * @param component The component class to render
     * @param dialogData Data to pass to the new component instance
     * @param title The title of the dialog
     * @param closeBtnText Custom text for the close button
     * @param cls Custom dialog class (accent, size etc.)
     * @param closeBtnCls Custom close button class
     */
    DialogService.prototype.show = function (component, dialogData, title, closeBtnText, cls, closeBtnCls) {
        var _this = this;
        var componentRef = this.componentFactoryResolver.resolveComponentFactory(component).create(this.injector);
        if (!!dialogData) {
            componentRef.instance.dialogDataInput = dialogData;
        }
        this.appRef.attachView(componentRef.hostView);
        var domElement = componentRef.hostView.rootNodes[0];
        var subject$ = new Subject();
        var dialogDataSubscription;
        if (!!componentRef.instance.dialogDataEmitter) {
            dialogDataSubscription = componentRef.instance.dialogDataEmitter
                .pipe(finalize(function () {
                subject$.complete();
            })).subscribe(function (data) {
                subject$.next(data);
            });
        }
        var options = {
            title: title,
            content: $(domElement),
            actions: [
                {
                    caption: closeBtnText ? closeBtnText : 'Submit',
                    cls: (closeBtnCls ? closeBtnCls : 'success') + ' submit-btn',
                    onclick: function () {
                        subject$.complete();
                    }
                }
            ],
            clsDialog: cls
        };
        var dialogObj = this.create(options);
        return subject$.asObservable().pipe(finalize(function () {
            if (dialogDataSubscription) {
                dialogDataSubscription.unsubscribe();
            }
            _this.close(dialogObj);
            componentRef.destroy();
        }));
    };
    /**
     * Show an info dialog
     * @param content The content of the info
     * @param options Options for info
     */
    DialogService.prototype.info = function (content, options) {
        return window.Metro.infobox.create(content, '', options).data('infobox');
    };
    DialogService.ctorParameters = function () { return [
        { type: ComponentFactoryResolver },
        { type: ApplicationRef },
        { type: Injector }
    ]; };
    DialogService = __decorate([
        Injectable(),
        __metadata("design:paramtypes", [ComponentFactoryResolver,
            ApplicationRef,
            Injector])
    ], DialogService);
    return DialogService;
}());
export { DialogService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGlhbG9nLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZy1tZXRybzQvIiwic291cmNlcyI6WyJsaWIvaW5mb3JtYXRpb24vZGlhbG9nL2RpYWxvZy5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUMsY0FBYyxFQUFFLHdCQUF3QixFQUFFLFlBQVksRUFBRSxlQUFlLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUM1SCxPQUFPLEVBQWEsT0FBTyxFQUFlLE1BQU0sTUFBTSxDQUFDO0FBQ3ZELE9BQU8sRUFBQyxRQUFRLEVBQUUsU0FBUyxFQUFDLE1BQU0sZ0JBQWdCLENBQUM7QUFDbkQsT0FBTyxFQUFDLG9CQUFvQixFQUFDLE1BQU0sZ0RBQWdELENBQUM7QUE0Q3BGO0lBRUUsdUJBQW9CLHdCQUFrRCxFQUNsRCxNQUFzQixFQUN0QixRQUFrQjtRQUZsQiw2QkFBd0IsR0FBeEIsd0JBQXdCLENBQTBCO1FBQ2xELFdBQU0sR0FBTixNQUFNLENBQWdCO1FBQ3RCLGFBQVEsR0FBUixRQUFRLENBQVU7SUFBSSxDQUFDO0lBRTNDOzs7T0FHRztJQUNJLDhCQUFNLEdBQWIsVUFBYyxPQUFzQjtRQUNsQyxPQUFhLE1BQU8sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUNwRCxDQUFDO0lBRUQ7OztPQUdHO0lBQ0ksNkJBQUssR0FBWixVQUFhLFNBQWM7UUFDekIsT0FBYSxNQUFPLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDckQsQ0FBQztJQUVEOzs7Ozs7O09BT0c7SUFDSSw2QkFBSyxHQUFaLFVBQWEsS0FBYSxFQUFFLE9BQWUsRUFBRSxHQUFZLEVBQUUsU0FBa0IsRUFBRSxRQUFpQjtRQUFoRyxpQkE0QkM7UUEzQkMsSUFBTSxRQUFRLEdBQUcsSUFBSSxPQUFPLEVBQVEsQ0FBQztRQUVy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QUFDO2lCQUNGO2FBQ0Y7WUFDRCxTQUFTLEVBQUUsR0FBRztTQUNmLENBQUM7UUFFRixJQUFNLFNBQVMsR0FBUSxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBRTVDLE9BQU8sUUFBUSxDQUFDLFlBQVksRUFBRSxDQUFDLElBQUksQ0FDakMsUUFBUSxDQUFDO1lBQ1AsSUFBSSxzQkFBc0IsRUFBRTtnQkFDMUIsc0JBQXNCLENBQUMsV0FBVyxFQUFFLENBQUM7YUFDdEM7WUFFRCxLQUFJLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQ3RCLFlBQVksQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUN6QixDQUFDLENBQUMsQ0FDSCxDQUFDO0lBQ0osQ0FBQztJQUVEOzs7O09BSUc7SUFDSSw0QkFBSSxHQUFYLFVBQVksT0FBZSxFQUFFLE9BQXdCO1FBRW5ELE9BQWEsTUFBTyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBRSxFQUFFLEVBQUUsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQ2xGLENBQUM7O2dCQS9SNkMsd0JBQXdCO2dCQUMxQyxjQUFjO2dCQUNaLFFBQVE7O0lBSjNCLGFBQWE7UUFEekIsVUFBVSxFQUFFO3lDQUdtQyx3QkFBd0I7WUFDMUMsY0FBYztZQUNaLFFBQVE7T0FKM0IsYUFBYSxDQWtTekI7SUFBRCxvQkFBQztDQUFBLEFBbFNELElBa1NDO1NBbFNZLGFBQWEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0FwcGxpY2F0aW9uUmVmLCBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsIENvbXBvbmVudFJlZiwgRW1iZWRkZWRWaWV3UmVmLCBJbmplY3RhYmxlLCBJbmplY3Rvcn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7T2JzZXJ2YWJsZSwgU3ViamVjdCwgU3Vic2NyaXB0aW9ufSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHtmaW5hbGl6ZSwgc3RhcnRXaXRofSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7Rm9ybUJ1aWxkZXJDb21wb25lbnR9IGZyb20gJy4uLy4uL2Zvcm0vZm9ybS1idWlsZGVyL2Zvcm0tYnVpbGRlci5jb21wb25lbnQnO1xyXG5pbXBvcnQge000Rm9ybUdyb3VwfSBmcm9tICcuLi8uLi9mb3JtL200LWZvcm0tZ3JvdXAnO1xyXG5pbXBvcnQge000RGlhbG9nRGF0YUVtaXR0ZXIsIE00RGlhbG9nRGF0YUlucHV0fSBmcm9tICcuL2RpYWxvZy1pbnRlcmZhY2VzJztcclxuXHJcbmRlY2xhcmUgdmFyICQ6IGFueTtcclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgRGlhbG9nT3B0aW9ucyB7XHJcbiAgdGl0bGU/OiBzdHJpbmc7XHJcbiAgY29udGVudD86IHN0cmluZ3xhbnk7XHJcbiAgYWN0aW9ucz86IHsgY2FwdGlvbjogc3RyaW5nLCBjbHM6IHN0cmluZywgb25jbGljazogKCkgPT4gdm9pZCB9W107XHJcbiAgYWN0aW9uc0FsaWduPzogJ2xlZnQnfCdyaWdodCc7XHJcbiAgZGVmYXVsdEFjdGlvbj86IGJvb2xlYW47XHJcbiAgb3ZlcmxheT86IGJvb2xlYW47XHJcbiAgb3ZlcmxheUNvbG9yPzogc3RyaW5nO1xyXG4gIG92ZXJsYXlBbHBoYT86IG51bWJlcjtcclxuICBvdmVybGF5Q2xpY2tDbG9zZT86IGJvb2xlYW47XHJcbiAgd2lkdGg/OiBudW1iZXI7XHJcbiAgY2xvc2VBY3Rpb24/OiBib29sZWFuO1xyXG4gIGNsc0RpYWxvZz86IHN0cmluZztcclxuICBjbHNUaXRsZT86IHN0cmluZztcclxuICBjbHNDb250ZW50Pzogc3RyaW5nO1xyXG4gIGNsc0FjdGlvbj86IHN0cmluZztcclxuICBjbHNEZWZhdWx0QWN0aW9uPzogc3RyaW5nO1xyXG4gIGF1dG9IaWRlPzogbnVtYmVyO1xyXG4gIHJlbW92ZU9uQ2xvc2U/OiBib29sZWFuO1xyXG4gIHNob3c/OiBib29sZWFuO1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIEluZm9ib3hPcHRpb25zIHtcclxuICB0eXBlPzogJ2RlZmF1bHQnfCdzdWNjZXNzJ3wnaW5mbyd8J2FsZXJ0J3wnd2FybmluZyc7XHJcbiAgd2lkdGg/OiBudW1iZXI7XHJcbiAgaGVpZ2h0PzogbnVtYmVyO1xyXG4gIG92ZXJsYXk/OiBib29sZWFuO1xyXG4gIG92ZXJsYXlDb2xvcj86IHN0cmluZztcclxuICBvdmVybGF5QWxwaGE/OiBzdHJpbmc7XHJcbiAgYXV0b0hpZGU/OiBudW1iZXI7XHJcbiAgcmVtb3ZlT25DbG9zZT86IGJvb2xlYW47XHJcbiAgY2xvc2VCdXR0b24/OiBib29sZWFuO1xyXG4gIGNsc0JveD86IHN0cmluZztcclxuICBjbHNCb3hDb250ZW50Pzogc3RyaW5nO1xyXG4gIGNsc092ZXJsYXk/OiBzdHJpbmc7XHJcbn1cclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIERpYWxvZ1NlcnZpY2Uge1xyXG5cclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGNvbXBvbmVudEZhY3RvcnlSZXNvbHZlcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxyXG4gICAgICAgICAgICAgIHByaXZhdGUgYXBwUmVmOiBBcHBsaWNhdGlvblJlZixcclxuICAgICAgICAgICAgICBwcml2YXRlIGluamVjdG9yOiBJbmplY3RvcikgeyB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENyZWF0ZSBhIGN1c3RvbSBkaWFsb2dcclxuICAgKiBAcGFyYW0gb3B0aW9ucyBUaGUgb3B0aW9ucyBvZiB0aGUgZGlhbG9nXHJcbiAgICovXHJcbiAgcHVibGljIGNyZWF0ZShvcHRpb25zOiBEaWFsb2dPcHRpb25zKTogYW55IHtcclxuICAgIHJldHVybiAoPGFueT53aW5kb3cpLk1ldHJvLmRpYWxvZy5jcmVhdGUob3B0aW9ucyk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDbG9zZSBhIGNyZWF0ZWQgZGlhbG9nXHJcbiAgICogQHBhcmFtIGRpYWxvZ09iaiBUaGUgb2JqZWN0IHJldHVybmVkIGJ5IHRoZSBjcmVhdGUgbWV0aG9kXHJcbiAgICovXHJcbiAgcHVibGljIGNsb3NlKGRpYWxvZ09iajogYW55KTogYW55IHtcclxuICAgIHJldHVybiAoPGFueT53aW5kb3cpLk1ldHJvLmRpYWxvZy5jbG9zZShkaWFsb2dPYmopO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2hvd3MgYW4gYWxlcnQgZGlhbG9nXHJcbiAgICogQHBhcmFtIHRpdGxlIFRoZSB0aXRsZSBvZiB0aGUgZGlhbG9nXHJcbiAgICogQHBhcmFtIG1lc3NhZ2UgVGhlIG1lc3NhZ2Ugb2YgdGhlIGRpYWxvZ1xyXG4gICAqIEBwYXJhbSBjbHMgT3B0aW9uYWwgY3NzIGNsYXNzZXNcclxuICAgKiBAcGFyYW0gb2tCdG5UZXh0IFRoZSB0ZXh0IG9mIHRoZSBPSy1CdXR0b25cclxuICAgKiBAcGFyYW0gb2tCdG5DbHMgQW4gb3B0aW9uYWwgY3NzIGNsYXNzIGZvciB0aGUgT0stQnV0dG9uXHJcbiAgICovXHJcbiAgcHVibGljIGFsZXJ0KHRpdGxlOiBzdHJpbmcsIG1lc3NhZ2U6IHN0cmluZywgY2xzPzogc3RyaW5nLCBva0J0blRleHQ/OiBzdHJpbmcsIG9rQnRuQ2xzPzogc3RyaW5nKTogT2JzZXJ2YWJsZTx2b2lkPiB7XHJcbiAgICBjb25zdCBzdWJqZWN0JCA9IG5ldyBTdWJqZWN0PHZvaWQ+KCk7XHJcblxyXG4gICAgY29uc3Qgb3B0aW9uczogRGlhbG9nT3B0aW9ucyA9IHtcclxuICAgICAgdGl0bGU6IHRpdGxlLFxyXG4gICAgICBjb250ZW50OiBtZXNzYWdlLFxyXG4gICAgICBjbHNEaWFsb2c6IGNscyxcclxuICAgICAgb3ZlcmxheUNsaWNrQ2xvc2U6IHRydWVcclxuICAgIH07XHJcblxyXG4gICAgaWYgKG9rQnRuVGV4dCkge1xyXG4gICAgICBvcHRpb25zLmFjdGlvbnMgPSBbe1xyXG4gICAgICAgIGNhcHRpb246IG9rQnRuVGV4dCxcclxuICAgICAgICBjbHM6IChva0J0bkNscyA/IG9rQnRuQ2xzIDogJycpICsgJyBqcy1kaWFsb2ctY2xvc2UnLFxyXG4gICAgICAgIG9uY2xpY2s6ICgpID0+IHtcclxuICAgICAgICAgIHN1YmplY3QkLm5leHQoKTtcclxuICAgICAgICAgIHN1YmplY3QkLmNvbXBsZXRlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBhbGVydE9iaiA9IHRoaXMuY3JlYXRlKG9wdGlvbnMpO1xyXG5cclxuICAgIHJldHVybiBzdWJqZWN0JC5hc09ic2VydmFibGUoKS5waXBlKFxyXG4gICAgICBmaW5hbGl6ZSgoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5jbG9zZShhbGVydE9iaik7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2hvd3MgYSBjb25maXJtIGRpYWxvZ1xyXG4gICAqIEBwYXJhbSB0aXRsZSBUaGUgdGl0bGUgb2YgdGhlIGNvbmZpcm1cclxuICAgKiBAcGFyYW0gbWVzc2FnZSBUaGUgbWVzc2FnZSBvZiB0aGUgY29uZmlybVxyXG4gICAqIEBwYXJhbSB5ZXNCdG5UZXh0IFRoZSB0ZXh0IGZvciB0aGUgWWVzLUJ1dHRvblxyXG4gICAqIEBwYXJhbSBub0J0blRleHQgVGhlIHRleHQgZm9yIHRoZSBOby1CdXR0b25cclxuICAgKiBAcGFyYW0gY2xzIEFuIG9wdGlvbmFsIGNzcyBjbGFzcyBmb3IgdGhlIGRpYWxvZ1xyXG4gICAqIEBwYXJhbSB5ZXNCdG5DbHMgQW4gb3B0aW9uYWwgY3NzIGNsYXNzIGZvciB0aGUgWWVzLUJ1dHRvblxyXG4gICAqIEBwYXJhbSBub0J0bkNscyBBbiBvcHRpb25hbCBjc3MgY2xhc3MgZm9yIHRoZSBOby1CdXR0b25cclxuICAgKi9cclxuICBwdWJsaWMgY29uZmlybSh0aXRsZTogc3RyaW5nLCBtZXNzYWdlOiBzdHJpbmcsIHllc0J0blRleHQ/OiBzdHJpbmcsIG5vQnRuVGV4dD86IHN0cmluZyxcclxuICAgICAgICAgICAgICAgICBjbHM/OiBzdHJpbmcsIHllc0J0bkNscz86IHN0cmluZywgbm9CdG5DbHM/OiBzdHJpbmcpOiBPYnNlcnZhYmxlPGJvb2xlYW4+IHtcclxuICAgIGNvbnN0IHN1YmplY3QkID0gbmV3IFN1YmplY3Q8Ym9vbGVhbj4oKTtcclxuXHJcbiAgICBjb25zdCBvcHRpb25zOiBEaWFsb2dPcHRpb25zID0ge1xyXG4gICAgICB0aXRsZTogdGl0bGUsXHJcbiAgICAgIGNvbnRlbnQ6IG1lc3NhZ2UsXHJcbiAgICAgIGFjdGlvbnM6IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICBjYXB0aW9uOiB5ZXNCdG5UZXh0ID8geWVzQnRuVGV4dCA6ICdZZXMnLFxyXG4gICAgICAgICAgY2xzOiAoeWVzQnRuQ2xzID8geWVzQnRuQ2xzIDogJ3N1Y2Nlc3MnKSArICcganMtZGlhbG9nLWNsb3NlJyxcclxuICAgICAgICAgIG9uY2xpY2s6ICgpID0+IHtcclxuICAgICAgICAgICAgc3ViamVjdCQubmV4dCh0cnVlKTtcclxuICAgICAgICAgICAgc3ViamVjdCQuY29tcGxldGUoKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIGNhcHRpb246IG5vQnRuVGV4dCA/IG5vQnRuVGV4dCA6ICdObycsXHJcbiAgICAgICAgICBjbHM6IChub0J0bkNscyA/IG5vQnRuQ2xzIDogJ2FsZXJ0JykgKyAnIGpzLWRpYWxvZy1jbG9zZScsXHJcbiAgICAgICAgICBvbmNsaWNrOiAoKSA9PiB7XHJcbiAgICAgICAgICAgIHN1YmplY3QkLm5leHQoZmFsc2UpO1xyXG4gICAgICAgICAgICBzdWJqZWN0JC5jb21wbGV0ZSgpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgXSxcclxuICAgICAgY2xzRGlhbG9nOiBjbHNcclxuICAgIH07XHJcblxyXG4gICAgY29uc3QgY29uZmlybU9iaiA9IHRoaXMuY3JlYXRlKG9wdGlvbnMpO1xyXG5cclxuICAgIHJldHVybiBzdWJqZWN0JC5hc09ic2VydmFibGUoKS5waXBlKFxyXG4gICAgICBmaW5hbGl6ZSgoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5jbG9zZShjb25maXJtT2JqKTtcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTaG93IGEgcHJvbXB0IGRpYWxvZ1xyXG4gICAqIEBwYXJhbSB0aXRsZSBUaGUgdGl0bGUgb2YgdGhlIHByb21wdFxyXG4gICAqIEBwYXJhbSBtZXNzYWdlIFRoZSBtZXNzYWdlIG9mIHRoZSBwcm9tcHRcclxuICAgKiBAcGFyYW0gc3VibWl0QnRuVGV4dCBUaGUgdGV4dCBvZiB0aGUgU3VibWl0LUJ1dHRvblxyXG4gICAqIEBwYXJhbSBwbGFjZWhvbGRlciBUaGUgcGxhY2Vob2xkZXIgb2YgdGhlIGlucHV0XHJcbiAgICogQHBhcmFtIGNscyBBbiBvcHRpb25hbCBjc3MgY2xhc3MgZm9yIHRoZSBkaWFsb2dcclxuICAgKiBAcGFyYW0gc3VibWl0QnRuQ2xzIEFuIG9wdGlvbmFsIGNzcyBjbGFzcyBmb3IgU3VibWl0LUJ1dHRvblxyXG4gICAqIEBwYXJhbSBpbnB1dENscyBBbiBvcHRpb25hbCBjc3MgY2xhc3MgZm9yIHRoZSBpbnB1dFxyXG4gICAqL1xyXG4gIHB1YmxpYyBwcm9tcHQodGl0bGU6IHN0cmluZywgbWVzc2FnZTogc3RyaW5nLCBzdWJtaXRCdG5UZXh0Pzogc3RyaW5nLCBwbGFjZWhvbGRlcj86IHN0cmluZyxcclxuICAgICAgICAgICAgICAgIGNscz86IHN0cmluZywgc3VibWl0QnRuQ2xzPzogc3RyaW5nLCBpbnB1dENscz86IHN0cmluZyk6IE9ic2VydmFibGU8c3RyaW5nPiB7XHJcbiAgICBjb25zdCBzdWJqZWN0JCA9IG5ldyBTdWJqZWN0PHN0cmluZz4oKTtcclxuXHJcbiAgICBjb25zdCBvcHRpb25zOiBEaWFsb2dPcHRpb25zID0ge1xyXG4gICAgICB0aXRsZTogdGl0bGUsXHJcbiAgICAgIGNvbnRlbnQ6IChtZXNzYWdlID8gbWVzc2FnZSA6ICcnKSArXHJcbiAgICAgICAgICAgICAgICBgPGJyPjxpbnB1dCBkYXRhLXJvbGU9XCJpbnB1dFwiIHR5cGU9XCJ0ZXh0XCIgY2xhc3M9XCIke2lucHV0Q2xzfVwiIHBsYWNlaG9sZGVyPVwiJHtwbGFjZWhvbGRlciA/IHBsYWNlaG9sZGVyIDogJyd9XCIgLz5gLFxyXG4gICAgICBhY3Rpb25zOiBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgY2FwdGlvbjogc3VibWl0QnRuVGV4dCA/IHN1Ym1pdEJ0blRleHQgOiAnU3VibWl0JyxcclxuICAgICAgICAgIGNsczogKHN1Ym1pdEJ0bkNscyA/IHN1Ym1pdEJ0bkNscyA6ICdzdWNjZXNzJykgKyAnIGpzLWRpYWxvZy1jbG9zZScsXHJcbiAgICAgICAgICBvbmNsaWNrOiAoKSA9PiB7XHJcbiAgICAgICAgICAgIHN1YmplY3QkLm5leHQodmFsdWUpO1xyXG4gICAgICAgICAgICBzdWJqZWN0JC5jb21wbGV0ZSgpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgXSxcclxuICAgICAgY2xzRGlhbG9nOiBjbHNcclxuICAgIH07XHJcblxyXG4gICAgY29uc3QgcHJvbXB0T2JqOiBhbnkgPSB0aGlzLmNyZWF0ZShvcHRpb25zKTtcclxuICAgIGNvbnN0IGlucHV0ID0gcHJvbXB0T2JqLmZpbmQoJ2lucHV0Jyk7XHJcblxyXG4gICAgbGV0IHZhbHVlID0gJyc7XHJcbiAgICBpbnB1dC5vbignY2hhbmdlJywgKCkgPT4ge1xyXG4gICAgICB2YWx1ZSA9IGlucHV0LnZhbCgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIHN1YmplY3QkLmFzT2JzZXJ2YWJsZSgpLnBpcGUoXHJcbiAgICAgIGZpbmFsaXplKCgpID0+IHtcclxuICAgICAgICB0aGlzLmNsb3NlKHByb21wdE9iaik7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2hvdyBhIHByb21wdCBkaWFsb2cgdGhhdCBjb250YWlucyBhIGZvcm1cclxuICAgKiBAcGFyYW0gdGl0bGUgVGhlIHRpdGxlIG9mIHRoZSBwcm9tcHRcclxuICAgKiBAcGFyYW0gZm9ybSBUaGUgZm9ybSBncm91cFxyXG4gICAqIEBwYXJhbSBzdWJtaXRCdG5UZXh0IFRoZSB0ZXh0IG9mIHRoZSBTdWJtaXQtQnV0dG9uXHJcbiAgICogQHBhcmFtIGFib3J0QnRuVGV4dCBUaGUgdGV4dCBvZiB0aGUgQWJvcnQtQnV0dG9uXHJcbiAgICogQHBhcmFtIHBsYWNlaG9sZGVyIFRoZSBwbGFjZWhvbGRlciBvZiB0aGUgaW5wdXRcclxuICAgKiBAcGFyYW0gY2xzIEFuIG9wdGlvbmFsIGNzcyBjbGFzcyBmb3IgdGhlIGRpYWxvZ1xyXG4gICAqIEBwYXJhbSBzdWJtaXRCdG5DbHMgQW4gb3B0aW9uYWwgY3NzIGNsYXNzIGZvciBTdWJtaXQtQnV0dG9uXHJcbiAgICogQHBhcmFtIGFib3J0QnRuQ2xzIEFuIG9wdGlvbmFsIGNzcyBjbGFzcyBmb3IgQWJvcnQtQnV0dG9uXHJcbiAgICovXHJcbiAgcHVibGljIGZvcm1Qcm9tcHQ8VCA9IHN0cmluZz4odGl0bGU6IHN0cmluZywgZm9ybTogTTRGb3JtR3JvdXAsIHN1Ym1pdEJ0blRleHQ/OiBzdHJpbmcsIGFib3J0QnRuVGV4dD86IHN0cmluZywgcGxhY2Vob2xkZXI/OiBzdHJpbmcsXHJcbiAgICAgICAgICAgICAgICBjbHM/OiBzdHJpbmcsIHN1Ym1pdEJ0bkNscz86IHN0cmluZywgYWJvcnRCdG5DbHM/OiBzdHJpbmcpOiBPYnNlcnZhYmxlPFQ+IHtcclxuICAgIGNvbnN0IGNvbXBvbmVudFJlZjogQ29tcG9uZW50UmVmPEZvcm1CdWlsZGVyQ29tcG9uZW50PiA9IHRoaXMuY29tcG9uZW50RmFjdG9yeVJlc29sdmVyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KEZvcm1CdWlsZGVyQ29tcG9uZW50KS5jcmVhdGUodGhpcy5pbmplY3Rvcik7XHJcbiAgICBjb21wb25lbnRSZWYuaW5zdGFuY2UuZm9ybUdyb3VwID0gZm9ybTtcclxuICAgIHRoaXMuYXBwUmVmLmF0dGFjaFZpZXcoY29tcG9uZW50UmVmLmhvc3RWaWV3KTtcclxuICAgIGNvbnN0IGRvbUVsZW1lbnQgPSAoY29tcG9uZW50UmVmLmhvc3RWaWV3IGFzIEVtYmVkZGVkVmlld1JlZjxhbnk+KS5yb290Tm9kZXNbMF0gYXMgSFRNTEVsZW1lbnQ7XHJcblxyXG4gICAgY29uc3Qgc3ViamVjdCQgPSBuZXcgU3ViamVjdDxUPigpO1xyXG5cclxuICAgIGNvbnN0IG9wdGlvbnM6IERpYWxvZ09wdGlvbnMgPSB7XHJcbiAgICAgIHRpdGxlOiB0aXRsZSxcclxuICAgICAgY29udGVudDogJ2NvbnRlbnQnLFxyXG4gICAgICBhY3Rpb25zOiBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgY2FwdGlvbjogYWJvcnRCdG5UZXh0ID8gYWJvcnRCdG5UZXh0IDogJ0Fib3J0JyxcclxuICAgICAgICAgIGNsczogYWJvcnRCdG5DbHMgPyBhYm9ydEJ0bkNscyA6ICd3YXJuaW5nJyxcclxuICAgICAgICAgIG9uY2xpY2s6ICgpID0+IHtcclxuICAgICAgICAgICAgc3ViamVjdCQubmV4dChudWxsKTtcclxuICAgICAgICAgICAgc3ViamVjdCQuY29tcGxldGUoKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIGNhcHRpb246IHN1Ym1pdEJ0blRleHQgPyBzdWJtaXRCdG5UZXh0IDogJ1N1Ym1pdCcsXHJcbiAgICAgICAgICBjbHM6IChzdWJtaXRCdG5DbHMgPyBzdWJtaXRCdG5DbHMgOiAnc3VjY2VzcycpICsgJyBzdWJtaXQtYnRuJyxcclxuICAgICAgICAgIG9uY2xpY2s6ICgpID0+IHtcclxuICAgICAgICAgICAgc3ViamVjdCQubmV4dChmb3JtLnZhbHVlKTtcclxuICAgICAgICAgICAgc3ViamVjdCQuY29tcGxldGUoKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIF0sXHJcbiAgICAgIGNsc0RpYWxvZzogY2xzXHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IHByb21wdE9iajogYW55ID0gdGhpcy5jcmVhdGUob3B0aW9ucyk7XHJcbiAgICBwcm9tcHRPYmouZmluZCgnLmRpYWxvZy1jb250ZW50JykuZW1wdHkoKS5hcHBlbmQoZG9tRWxlbWVudCk7XHJcblxyXG4gICAgY29uc3QgZm9ybVN0YXRlU3Vic2NyaXB0aW9uID0gZm9ybS5zdGF0dXNDaGFuZ2VzLnBpcGUoc3RhcnRXaXRoKGZvcm0uc3RhdHVzKSkuc3Vic2NyaWJlKCh2YWxpZDogJ1ZBTElEJ3wnSU5WQUxJRCcpID0+IHtcclxuICAgICAgY29uc3Qgc3VibWl0QnRuID0gcHJvbXB0T2JqLmZpbmQoJy5kaWFsb2ctYWN0aW9ucyBidXR0b24uc3VibWl0LWJ0bicpO1xyXG5cclxuICAgICAgaWYgKHZhbGlkID09PSAnVkFMSUQnKSB7XHJcbiAgICAgICAgc3VibWl0QnRuLnJlbW92ZUF0dHIoJ2Rpc2FibGVkJyk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgc3VibWl0QnRuLmF0dHIoJ2Rpc2FibGVkJywgJ2Rpc2FibGVkJyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiBzdWJqZWN0JC5hc09ic2VydmFibGUoKS5waXBlKFxyXG4gICAgICBmaW5hbGl6ZSgoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5jbG9zZShwcm9tcHRPYmopO1xyXG4gICAgICAgIGNvbXBvbmVudFJlZi5kZXN0cm95KCk7XHJcbiAgICAgICAgZm9ybVN0YXRlU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2hvdyBhIGRpYWxvZyB0aGF0IGNvbnRhaW5zIGEgY29tcG9uZW50XHJcbiAgICogQHBhcmFtIGNvbXBvbmVudCBUaGUgY29tcG9uZW50IGNsYXNzIHRvIHJlbmRlclxyXG4gICAqIEBwYXJhbSBkaWFsb2dEYXRhIERhdGEgdG8gcGFzcyB0byB0aGUgbmV3IGNvbXBvbmVudCBpbnN0YW5jZVxyXG4gICAqIEBwYXJhbSB0aXRsZSBUaGUgdGl0bGUgb2YgdGhlIGRpYWxvZ1xyXG4gICAqIEBwYXJhbSBjbG9zZUJ0blRleHQgQ3VzdG9tIHRleHQgZm9yIHRoZSBjbG9zZSBidXR0b25cclxuICAgKiBAcGFyYW0gY2xzIEN1c3RvbSBkaWFsb2cgY2xhc3MgKGFjY2VudCwgc2l6ZSBldGMuKVxyXG4gICAqIEBwYXJhbSBjbG9zZUJ0bkNscyBDdXN0b20gY2xvc2UgYnV0dG9uIGNsYXNzXHJcbiAgICovXHJcbiAgcHVibGljIHNob3c8VE91dHB1dCA9IG51bGw+KGNvbXBvbmVudDogbmV3ICguLi5hcmdzOiBhbnlbXSkgPT4gYW55LCBkaWFsb2dEYXRhPzogYW55LCB0aXRsZT86IHN0cmluZywgY2xvc2VCdG5UZXh0Pzogc3RyaW5nLCBjbHM/OiBzdHJpbmcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsb3NlQnRuQ2xzPzogc3RyaW5nKTogT2JzZXJ2YWJsZTxUT3V0cHV0PiB7XHJcbiAgICBjb25zdCBjb21wb25lbnRSZWY6IENvbXBvbmVudFJlZjxhbnk+ID0gdGhpcy5jb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoY29tcG9uZW50KS5jcmVhdGUodGhpcy5pbmplY3Rvcik7XHJcblxyXG4gICAgaWYgKCEhZGlhbG9nRGF0YSkge1xyXG4gICAgICAoPE00RGlhbG9nRGF0YUlucHV0PFRPdXRwdXQ+PmNvbXBvbmVudFJlZi5pbnN0YW5jZSkuZGlhbG9nRGF0YUlucHV0ID0gZGlhbG9nRGF0YTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmFwcFJlZi5hdHRhY2hWaWV3KGNvbXBvbmVudFJlZi5ob3N0Vmlldyk7XHJcbiAgICBjb25zdCBkb21FbGVtZW50ID0gKGNvbXBvbmVudFJlZi5ob3N0VmlldyBhcyBFbWJlZGRlZFZpZXdSZWY8YW55Pikucm9vdE5vZGVzWzBdIGFzIEhUTUxFbGVtZW50O1xyXG5cclxuICAgIGNvbnN0IHN1YmplY3QkID0gbmV3IFN1YmplY3Q8VE91dHB1dD4oKTtcclxuXHJcbiAgICBsZXQgZGlhbG9nRGF0YVN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xyXG5cclxuICAgIGlmICghISg8TTREaWFsb2dEYXRhRW1pdHRlcjxUT3V0cHV0Pj5jb21wb25lbnRSZWYuaW5zdGFuY2UpLmRpYWxvZ0RhdGFFbWl0dGVyKSB7XHJcbiAgICAgIGRpYWxvZ0RhdGFTdWJzY3JpcHRpb24gPSAoPE00RGlhbG9nRGF0YUVtaXR0ZXI8VE91dHB1dD4+Y29tcG9uZW50UmVmLmluc3RhbmNlKS5kaWFsb2dEYXRhRW1pdHRlclxyXG4gICAgICAgIC5waXBlKGZpbmFsaXplKCgpID0+IHtcclxuICAgICAgICAgIHN1YmplY3QkLmNvbXBsZXRlKCk7XHJcbiAgICAgICAgfSkpLnN1YnNjcmliZSgoZGF0YSkgPT4ge1xyXG4gICAgICAgICAgc3ViamVjdCQubmV4dChkYXRhKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBvcHRpb25zOiBEaWFsb2dPcHRpb25zID0ge1xyXG4gICAgICB0aXRsZTogdGl0bGUsXHJcbiAgICAgIGNvbnRlbnQ6ICQoZG9tRWxlbWVudCksXHJcbiAgICAgIGFjdGlvbnM6IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICBjYXB0aW9uOiBjbG9zZUJ0blRleHQgPyBjbG9zZUJ0blRleHQgOiAnU3VibWl0JyxcclxuICAgICAgICAgIGNsczogKGNsb3NlQnRuQ2xzID8gY2xvc2VCdG5DbHMgOiAnc3VjY2VzcycpICsgJyBzdWJtaXQtYnRuJyxcclxuICAgICAgICAgIG9uY2xpY2s6ICgpID0+IHtcclxuICAgICAgICAgICAgc3ViamVjdCQuY29tcGxldGUoKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIF0sXHJcbiAgICAgIGNsc0RpYWxvZzogY2xzXHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IGRpYWxvZ09iajogYW55ID0gdGhpcy5jcmVhdGUob3B0aW9ucyk7XHJcblxyXG4gICAgcmV0dXJuIHN1YmplY3QkLmFzT2JzZXJ2YWJsZSgpLnBpcGUoXHJcbiAgICAgIGZpbmFsaXplKCgpID0+IHtcclxuICAgICAgICBpZiAoZGlhbG9nRGF0YVN1YnNjcmlwdGlvbikge1xyXG4gICAgICAgICAgZGlhbG9nRGF0YVN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5jbG9zZShkaWFsb2dPYmopO1xyXG4gICAgICAgIGNvbXBvbmVudFJlZi5kZXN0cm95KCk7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2hvdyBhbiBpbmZvIGRpYWxvZ1xyXG4gICAqIEBwYXJhbSBjb250ZW50IFRoZSBjb250ZW50IG9mIHRoZSBpbmZvXHJcbiAgICogQHBhcmFtIG9wdGlvbnMgT3B0aW9ucyBmb3IgaW5mb1xyXG4gICAqL1xyXG4gIHB1YmxpYyBpbmZvKGNvbnRlbnQ6IHN0cmluZywgb3B0aW9ucz86IEluZm9ib3hPcHRpb25zKTogeyBzZXRDb250ZW50OiAoY29udGVudDogc3RyaW5nKSA9PiB2b2lkO1xyXG4gICAgc2V0VHlwZTogKHR5cGU6ICdkZWZhdWx0J3wnc3VjY2Vzcyd8J2luZm8nfCdhbGVydCd8J3dhcm5pbmcnKSA9PiB2b2lkOyBjbG9zZTogKCkgPT4gdm9pZCB9IHtcclxuICAgIHJldHVybiAoPGFueT53aW5kb3cpLk1ldHJvLmluZm9ib3guY3JlYXRlKGNvbnRlbnQsICcnLCBvcHRpb25zKS5kYXRhKCdpbmZvYm94Jyk7XHJcbiAgfVxyXG59XHJcbiJdfQ==