import { __decorate, __metadata } from "tslib";
import { AfterViewInit, ChangeDetectionStrategy, Component, ElementRef, EventEmitter, Input, OnChanges, OnDestroy, Output, SimpleChanges, ViewChild } from '@angular/core';
import { Subject } from 'rxjs';
import { finalize, take } from 'rxjs/operators';
var DialogComponent = /** @class */ (function () {
    function DialogComponent(element) {
        this.element = element;
        this.isOpen = false;
        this.closeEvent = new EventEmitter();
        this.closeSubject$ = new Subject();
    }
    DialogComponent.prototype.open = function () {
        var _this = this;
        this.dialogObj.open();
        return this.closeSubject$.pipe(take(1), finalize(function () { return _this.close(); }));
    };
    DialogComponent.prototype.close = function () {
        if (this.dialogObj) {
            this.dialogObj.close();
        }
    };
    DialogComponent.prototype.ngAfterViewInit = function () {
        var _this = this;
        var dialogOptions = {
            width: this.width,
            show: this.isOpen,
            overlay: this.overlay,
            overlayClickClose: this.overlayClickClose
        };
        if (this.overlayColor) {
            dialogOptions.overlayColor = this.overlayColor;
        }
        if (this.overlayAlpha) {
            dialogOptions.overlayAlpha = this.overlayAlpha;
        }
        this.dialogObj = $(this.dialog.nativeElement).dialog(dialogOptions).data('dialog');
        this.dialogObj.options.onClose = function () {
            _this.closeEvent.emit();
            _this.closeSubject$.next(_this.data);
        };
        this.observeClassValue();
    };
    DialogComponent.prototype.observeClassValue = function () {
        var _this = this;
        var classValueCallback = function () {
            var classValue = _this.element.nativeElement.getAttribute('class');
            _this.dialogObj.element.attr('class', (classValue ? classValue + ' ' : '') + "dialog");
        };
        this.classObserver = new MutationObserver(classValueCallback);
        this.classObserver.observe(this.element.nativeElement, {
            attributeFilter: ['class'],
            attributes: true
        });
        classValueCallback();
    };
    DialogComponent.prototype.ngOnChanges = function (changes) {
        if (this.dialogObj) {
            if (changes['isOpen']) {
                if (this.isOpen) {
                    this.open();
                }
                else {
                    this.close();
                }
            }
            if (changes['width']) {
                this.dialogObj.element.css('width', this.width + "px");
            }
            if (changes['overlay'] || changes['overlayColor'] || changes['overlayAlpha'] || changes['overlayClickClose']) {
                this.dialogObj.options.overlay = this.overlay;
                this.dialogObj.options.overlayColor = this.overlayColor;
                this.dialogObj.options.overlayAlpha = this.overlayAlpha;
                this.dialogObj.options.overlayClickClose = this.overlayClickClose;
            }
        }
    };
    DialogComponent.prototype.ngOnDestroy = function () {
        if (this.dialogObj) {
            this.close();
            this.dialogObj.element.remove();
        }
        if (this.classObserver) {
            this.classObserver.disconnect();
        }
    };
    DialogComponent.ctorParameters = function () { return [
        { type: ElementRef }
    ]; };
    __decorate([
        Input('open'),
        __metadata("design:type", Object)
    ], DialogComponent.prototype, "isOpen", void 0);
    __decorate([
        Input('width'),
        __metadata("design:type", String)
    ], DialogComponent.prototype, "width", void 0);
    __decorate([
        Input('overlay'),
        __metadata("design:type", Boolean)
    ], DialogComponent.prototype, "overlay", void 0);
    __decorate([
        Input('overlay-color'),
        __metadata("design:type", String)
    ], DialogComponent.prototype, "overlayColor", void 0);
    __decorate([
        Input('overlay-alpha'),
        __metadata("design:type", String)
    ], DialogComponent.prototype, "overlayAlpha", void 0);
    __decorate([
        Input('overlay-click-close'),
        __metadata("design:type", Boolean)
    ], DialogComponent.prototype, "overlayClickClose", void 0);
    __decorate([
        Input('data'),
        __metadata("design:type", Object)
    ], DialogComponent.prototype, "data", void 0);
    __decorate([
        ViewChild('dialog', { static: true }),
        __metadata("design:type", ElementRef)
    ], DialogComponent.prototype, "dialog", void 0);
    __decorate([
        Output('close-event'),
        __metadata("design:type", Object)
    ], DialogComponent.prototype, "closeEvent", void 0);
    DialogComponent = __decorate([
        Component({
            selector: 'm4-dialog',
            template: "<div #dialog>\r\n  <div class=\"dialog-title\">\r\n    <ng-content select=\"[dialog-title]\"></ng-content>\r\n  </div>\r\n  <div class=\"dialog-content\">\r\n    <ng-content select=\"[dialog-content]\"></ng-content>\r\n  </div>\r\n  <div class=\"dialog-actions\">\r\n    <ng-content select=\"[dialog-actions]\"></ng-content>\r\n  </div>\r\n</div>\r\n",
            changeDetection: ChangeDetectionStrategy.OnPush,
            styles: [""]
        }),
        __metadata("design:paramtypes", [ElementRef])
    ], DialogComponent);
    return DialogComponent;
}());
export { DialogComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGlhbG9nLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25nLW1ldHJvNC8iLCJzb3VyY2VzIjpbImxpYi9pbmZvcm1hdGlvbi9kaWFsb2cvZGlhbG9nLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUNMLGFBQWEsRUFDYix1QkFBdUIsRUFDdkIsU0FBUyxFQUNULFVBQVUsRUFBRSxZQUFZLEVBQ3hCLEtBQUssRUFDTCxTQUFTLEVBQ1QsU0FBUyxFQUFFLE1BQU0sRUFDakIsYUFBYSxFQUNiLFNBQVMsRUFDVixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQWEsT0FBTyxFQUFDLE1BQU0sTUFBTSxDQUFDO0FBQ3pDLE9BQU8sRUFBQyxRQUFRLEVBQUUsSUFBSSxFQUFDLE1BQU0sZ0JBQWdCLENBQUM7QUFVOUM7SUFtQkUseUJBQW9CLE9BQW1CO1FBQW5CLFlBQU8sR0FBUCxPQUFPLENBQVk7UUFsQnhCLFdBQU0sR0FBRyxLQUFLLENBQUM7UUFVUCxlQUFVLEdBQUcsSUFBSSxZQUFZLEVBQVEsQ0FBQztRQUtyRCxrQkFBYSxHQUFHLElBQUksT0FBTyxFQUFPLENBQUM7SUFHRCxDQUFDO0lBRXBDLDhCQUFJLEdBQVg7UUFBQSxpQkFHQztRQUZDLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDdEIsT0FBTyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsUUFBUSxDQUFDLGNBQU0sT0FBQSxLQUFJLENBQUMsS0FBSyxFQUFFLEVBQVosQ0FBWSxDQUFDLENBQUMsQ0FBQztJQUN4RSxDQUFDO0lBRU0sK0JBQUssR0FBWjtRQUNFLElBQUksSUFBSSxDQUFDLFNBQVMsRUFBRTtZQUNsQixJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssRUFBRSxDQUFDO1NBQ3hCO0lBQ0gsQ0FBQztJQUVELHlDQUFlLEdBQWY7UUFBQSxpQkF1QkM7UUF0QkMs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ZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgQWZ0ZXJWaWV3SW5pdCxcclxuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcclxuICBDb21wb25lbnQsXHJcbiAgRWxlbWVudFJlZiwgRXZlbnRFbWl0dGVyLFxyXG4gIElucHV0LFxyXG4gIE9uQ2hhbmdlcyxcclxuICBPbkRlc3Ryb3ksIE91dHB1dCxcclxuICBTaW1wbGVDaGFuZ2VzLFxyXG4gIFZpZXdDaGlsZFxyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQge09ic2VydmFibGUsIFN1YmplY3R9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQge2ZpbmFsaXplLCB0YWtlfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcblxyXG5kZWNsYXJlIHZhciAkOiBhbnk7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ200LWRpYWxvZycsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL2RpYWxvZy5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vZGlhbG9nLmNvbXBvbmVudC5jc3MnXSxcclxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaFxyXG59KVxyXG5leHBvcnQgY2xhc3MgRGlhbG9nQ29tcG9uZW50IGltcGxlbWVudHMgT25DaGFuZ2VzLCBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3kge1xyXG4gIEBJbnB1dCgnb3BlbicpIGlzT3BlbiA9IGZhbHNlO1xyXG4gIEBJbnB1dCgnd2lkdGgnKSB3aWR0aDogc3RyaW5nO1xyXG4gIEBJbnB1dCgnb3ZlcmxheScpIG92ZXJsYXk6IGJvb2xlYW47XHJcbiAgQElucHV0KCdvdmVybGF5LWNvbG9yJykgb3ZlcmxheUNvbG9yOiBzdHJpbmc7XHJcbiAgQElucHV0KCdvdmVybGF5LWFscGhhJykgb3ZlcmxheUFscGhhOiBzdHJpbmc7XHJcbiAgQElucHV0KCdvdmVybGF5LWNsaWNrLWNsb3NlJykgb3ZlcmxheUNsaWNrQ2xvc2U6IGJvb2xlYW47XHJcblxyXG4gIEBJbnB1dCgnZGF0YScpIGRhdGE6IGFueTtcclxuXHJcbiAgQFZpZXdDaGlsZCgnZGlhbG9nJywgeyBzdGF0aWM6IHRydWUgfSkgcHJpdmF0ZSBkaWFsb2c6IEVsZW1lbnRSZWY7XHJcbiAgQE91dHB1dCgnY2xvc2UtZXZlbnQnKSBjbG9zZUV2ZW50ID0gbmV3IEV2ZW50RW1pdHRlcjx2b2lkPigpO1xyXG5cclxuXHJcbiAgZGlhbG9nT2JqOiBhbnk7XHJcblxyXG4gIHByaXZhdGUgY2xvc2VTdWJqZWN0JCA9IG5ldyBTdWJqZWN0PGFueT4oKTtcclxuICBwcml2YXRlIGNsYXNzT2JzZXJ2ZXI6IE11dGF0aW9uT2JzZXJ2ZXI7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgZWxlbWVudDogRWxlbWVudFJlZikge31cclxuXHJcbiAgcHVibGljIG9wZW4oKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIHRoaXMuZGlhbG9nT2JqLm9wZW4oKTtcclxuICAgIHJldHVybiB0aGlzLmNsb3NlU3ViamVjdCQucGlwZSh0YWtlKDEpLCBmaW5hbGl6ZSgoKSA9PiB0aGlzLmNsb3NlKCkpKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBjbG9zZSgpIHtcclxuICAgIGlmICh0aGlzLmRpYWxvZ09iaikge1xyXG4gICAgICB0aGlzLmRpYWxvZ09iai5jbG9zZSgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xyXG4gICAgY29uc3QgZGlhbG9nT3B0aW9uczogYW55ID0ge1xyXG4gICAgICB3aWR0aDogdGhpcy53aWR0aCxcclxuICAgICAgc2hvdzogdGhpcy5pc09wZW4sXHJcbiAgICAgIG92ZXJsYXk6IHRoaXMub3ZlcmxheSxcclxuICAgICAgb3ZlcmxheUNsaWNrQ2xvc2U6IHRoaXMub3ZlcmxheUNsaWNrQ2xvc2VcclxuICAgIH07XHJcblxyXG4gICAgaWYgKHRoaXMub3ZlcmxheUNvbG9yKSB7XHJcbiAgICAgIGRpYWxvZ09wdGlvbnMub3ZlcmxheUNvbG9yID0gdGhpcy5vdmVybGF5Q29sb3I7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMub3ZlcmxheUFscGhhKSB7XHJcbiAgICAgIGRpYWxvZ09wdGlvbnMub3ZlcmxheUFscGhhID0gdGhpcy5vdmVybGF5QWxwaGE7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5kaWFsb2dPYmogPSAkKHRoaXMuZGlhbG9nLm5hdGl2ZUVsZW1lbnQpLmRpYWxvZyhkaWFsb2dPcHRpb25zKS5kYXRhKCdkaWFsb2cnKTtcclxuICAgIHRoaXMuZGlhbG9nT2JqLm9wdGlvbnMub25DbG9zZSA9ICgpID0+IHtcclxuICAgICAgdGhpcy5jbG9zZUV2ZW50LmVtaXQoKTtcclxuICAgICAgdGhpcy5jbG9zZVN1YmplY3QkLm5leHQodGhpcy5kYXRhKTtcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5vYnNlcnZlQ2xhc3NWYWx1ZSgpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBvYnNlcnZlQ2xhc3NWYWx1ZSgpIHtcclxuICAgIGNvbnN0IGNsYXNzVmFsdWVDYWxsYmFjayA9ICgpID0+IHtcclxuICAgICAgY29uc3QgY2xhc3NWYWx1ZSA9IHRoaXMuZWxlbWVudC5uYXRpdmVFbGVtZW50LmdldEF0dHJpYnV0ZSgnY2xhc3MnKTtcclxuICAgICAgdGhpcy5kaWFsb2dPYmouZWxlbWVudC5hdHRyKCdjbGFzcycsIGAke2NsYXNzVmFsdWUgPyBjbGFzc1ZhbHVlICsgJyAnIDogJyd9ZGlhbG9nYCk7XHJcbiAgICB9O1xyXG4gICAgdGhpcy5jbGFzc09ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoY2xhc3NWYWx1ZUNhbGxiYWNrKTtcclxuXHJcbiAgICB0aGlzLmNsYXNzT2JzZXJ2ZXIub2JzZXJ2ZSh0aGlzLmVsZW1lbnQubmF0aXZlRWxlbWVudCwge1xyXG4gICAgICBhdHRyaWJ1dGVGaWx0ZXI6IFsnY2xhc3MnXSxcclxuICAgICAgYXR0cmlidXRlczogdHJ1ZVxyXG4gICAgfSk7XHJcblxyXG4gICAgY2xhc3NWYWx1ZUNhbGxiYWNrKCk7XHJcbiAgfVxyXG5cclxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XHJcbiAgICBpZiAodGhpcy5kaWFsb2dPYmopIHtcclxuICAgICAgaWYgKGNoYW5nZXNbJ2lzT3BlbiddKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNPcGVuKSB7XHJcbiAgICAgICAgICB0aGlzLm9wZW4oKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKGNoYW5nZXNbJ3dpZHRoJ10pIHtcclxuICAgICAgICB0aGlzLmRpYWxvZ09iai5lbGVtZW50LmNzcygnd2lkdGgnLCBgJHt0aGlzLndpZHRofXB4YCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChjaGFuZ2VzWydvdmVybGF5J10gfHwgY2hhbmdlc1snb3ZlcmxheUNvbG9yJ10gfHwgY2hhbmdlc1snb3ZlcmxheUFscGhhJ10gfHwgY2hhbmdlc1snb3ZlcmxheUNsaWNrQ2xvc2UnXSkge1xyXG4gICAgICAgIHRoaXMuZGlhbG9nT2JqLm9wdGlvbnMub3ZlcmxheSA9IHRoaXMub3ZlcmxheTtcclxuICAgICAgICB0aGlzLmRpYWxvZ09iai5vcHRpb25zLm92ZXJsYXlDb2xvciA9IHRoaXMub3ZlcmxheUNvbG9yO1xyXG4gICAgICAgIHRoaXMuZGlhbG9nT2JqLm9wdGlvbnMub3ZlcmxheUFscGhhID0gdGhpcy5vdmVybGF5QWxwaGE7XHJcbiAgICAgICAgdGhpcy5kaWFsb2dPYmoub3B0aW9ucy5vdmVybGF5Q2xpY2tDbG9zZSA9IHRoaXMub3ZlcmxheUNsaWNrQ2xvc2U7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xyXG4gICAgaWYgKHRoaXMuZGlhbG9nT2JqKSB7XHJcbiAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgICAgdGhpcy5kaWFsb2dPYmouZWxlbWVudC5yZW1vdmUoKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodGhpcy5jbGFzc09ic2VydmVyKSB7XHJcbiAgICAgIHRoaXMuY2xhc3NPYnNlcnZlci5kaXNjb25uZWN0KCk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcbiJdfQ==