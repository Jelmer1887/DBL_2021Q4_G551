import { __decorate, __extends, __metadata } from "tslib";
import { Component, ElementRef, Input, ViewChild, ViewEncapsulation } from '@angular/core';
import { ControlBase } from '../control-base';
import { DefaultValueAccessor } from '../../helper/default-value-accessor';
import { TypeAlias } from '../../helper/type-alias';
import { asapScheduler } from 'rxjs';
import { ObjectHelper } from '../../helper/object-helper';
var SliderComponent = /** @class */ (function (_super) {
    __extends(SliderComponent, _super);
    function SliderComponent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    SliderComponent_1 = SliderComponent;
    SliderComponent.prototype.createControl = function () {
        var _this = this;
        return new Promise(function (complete) {
            var originalElement = $(_this.input.nativeElement);
            ObjectHelper.hide(originalElement);
            if (_this.clonedElement) {
                _this.clonedElement.parent().parent().find('.slider-min-max').remove();
                _this.clonedElement.parent().remove();
            }
            _this.clonedElement = originalElement.clone();
            ObjectHelper.show(_this.clonedElement);
            originalElement.parent().append(_this.clonedElement);
            _this.slider = _this.clonedElement.slider().data('slider');
            _this.clonedElement.parent().find('button.marker').one('blur', function () {
                _this.touchCallback();
            });
            _this.clonedElement.on('change', function () {
                asapScheduler.schedule(function () {
                    _this.changeValue(+_this.clonedElement.val());
                });
            });
            complete();
        });
    };
    SliderComponent.prototype.disable = function (disabled) {
        if (disabled) {
            this.clonedElement.parent().addClass('disabled');
        }
        else {
            this.clonedElement.parent().removeClass('disabled');
        }
    };
    SliderComponent.prototype.newValue = function () {
        if (!this.slider) {
            return;
        }
        this.slider.val(this.innerValue);
    };
    SliderComponent.prototype.newClassValue = function (newClasses, oldClasses) {
        if (this.clonedElement) {
            var target_1 = this.clonedElement.parent();
            oldClasses.forEach(function (cls) {
                target_1.removeClass(cls);
            });
            newClasses.forEach(function (cls) {
                target_1.addClass(cls);
            });
        }
    };
    var SliderComponent_1;
    __decorate([
        Input('min'),
        __metadata("design:type", Number)
    ], SliderComponent.prototype, "min", void 0);
    __decorate([
        Input('max'),
        __metadata("design:type", Number)
    ], SliderComponent.prototype, "max", void 0);
    __decorate([
        Input('show-min-max'),
        __metadata("design:type", Boolean)
    ], SliderComponent.prototype, "showMinMax", void 0);
    __decorate([
        Input('accuracy'),
        __metadata("design:type", Number)
    ], SliderComponent.prototype, "accuracy", void 0);
    __decorate([
        Input('buffer'),
        __metadata("design:type", Number)
    ], SliderComponent.prototype, "buffer", void 0);
    __decorate([
        Input('hint'),
        __metadata("design:type", Boolean)
    ], SliderComponent.prototype, "hint", void 0);
    __decorate([
        Input('hint-always'),
        __metadata("design:type", Boolean)
    ], SliderComponent.prototype, "hintAlways", void 0);
    __decorate([
        Input('hint-position'),
        __metadata("design:type", String)
    ], SliderComponent.prototype, "hintPosition", void 0);
    __decorate([
        Input('hint-mask'),
        __metadata("design:type", String)
    ], SliderComponent.prototype, "hintMask", void 0);
    __decorate([
        Input('vertical'),
        __metadata("design:type", Boolean)
    ], SliderComponent.prototype, "vertical", void 0);
    __decorate([
        Input('size'),
        __metadata("design:type", Number)
    ], SliderComponent.prototype, "size", void 0);
    __decorate([
        Input('thin'),
        __metadata("design:type", String)
    ], SliderComponent.prototype, "thin", void 0);
    __decorate([
        Input('cycle-marker'),
        __metadata("design:type", Boolean)
    ], SliderComponent.prototype, "cycleMarker", void 0);
    __decorate([
        Input('cls-slider'),
        __metadata("design:type", String)
    ], SliderComponent.prototype, "clsSlider", void 0);
    __decorate([
        Input('cls-backside'),
        __metadata("design:type", String)
    ], SliderComponent.prototype, "clsBackside", void 0);
    __decorate([
        Input('cls-complete'),
        __metadata("design:type", String)
    ], SliderComponent.prototype, "clsComplete", void 0);
    __decorate([
        Input('cls-buffer'),
        __metadata("design:type", String)
    ], SliderComponent.prototype, "clsBuffer", void 0);
    __decorate([
        Input('cls-marker'),
        __metadata("design:type", String)
    ], SliderComponent.prototype, "clsMarker", void 0);
    __decorate([
        Input('cls-hint'),
        __metadata("design:type", String)
    ], SliderComponent.prototype, "clsHint", void 0);
    __decorate([
        Input('cls-min-max'),
        __metadata("design:type", String)
    ], SliderComponent.prototype, "clsMinMax", void 0);
    __decorate([
        Input('cls-min'),
        __metadata("design:type", String)
    ], SliderComponent.prototype, "clsMin", void 0);
    __decorate([
        Input('cls-max'),
        __metadata("design:type", String)
    ], SliderComponent.prototype, "clsMax", void 0);
    __decorate([
        ViewChild('input', { static: true }),
        __metadata("design:type", ElementRef)
    ], SliderComponent.prototype, "input", void 0);
    SliderComponent = SliderComponent_1 = __decorate([
        Component({
            selector: 'm4-slider',
            template: "<input type=\"number\" #input\r\n\r\n\r\n       [attr.data-min]=\"min\"\r\n       [attr.data-max]=\"max\"\r\n       [attr.data-show-min-max]=\"showMinMax\"\r\n       [attr.data-accuracy]=\"accuracy\"\r\n       [attr.data-buffer]=\"buffer\"\r\n       [attr.data-hint]=\"hint\"\r\n       [attr.data-hint-always]=\"hintAlways\"\r\n       [attr.data-hint-position]=\"hintPosition\"\r\n       [attr.data-hint-mask]=\"hintMask\"\r\n       [attr.data-vertical]=\"vertical\"\r\n       [attr.data-size]=\"size\"\r\n\r\n       [attr.data-cls-slider]=\"clsSlider\"\r\n       [attr.data-cls-backside]=\"clsBackside\"\r\n       [attr.data-cls-complete]=\"clsComplete\"\r\n       [attr.data-cls-buffer]=\"clsBuffer\"\r\n       [attr.data-cls-marker]=\"clsMarker\"\r\n       [attr.data-cls-hint]=\"clsHint\"\r\n       [attr.data-cls-min-max]=\"clsMinMax\"\r\n       [attr.data-cls-min]=\"clsMin\"\r\n       [attr.data-cls-max]=\"clsMax\"\r\n\r\n       [class.thin]=\"thin === 'thin'\"\r\n       [class.ultra-thin]=\"thin === 'ultra-thin'\"\r\n       [class.cycle-marker]=\"cycleMarker\">\r\n",
            providers: [DefaultValueAccessor.get(SliderComponent_1), TypeAlias.get(SliderComponent_1)],
            encapsulation: ViewEncapsulation.None,
            styles: [".slider.primary .complete{background-color:#0366d6}.slider.primary .backside{background-color:#3969a0}.slider.secondary .complete{background-color:#607d8b}.slider.secondary .backside{background-color:#767676}.slider.success .complete{background-color:#60a917}.slider.success .backside{background-color:#607947}.slider.alert .complete{background-color:#ce352c}.slider.alert .backside{background-color:#906d6b}.slider.warning .complete{background-color:#ff9447}.slider.warning .backside{background-color:#d19c75}.slider.yellow .complete{background-color:#ffe484}.slider.yellow .backside{background-color:#e0d3a3}.slider.info .complete{background-color:#5ebdec}.slider.info .backside{background-color:#8baebf}.slider.dark .backside,.slider.dark .complete{background-color:#505050}.slider.light .backside,.slider.light .complete{background-color:#f8f8f8}m4-slider .disabled .complete,m4-slider .disabled button.marker{background-color:#989898}"]
        })
    ], SliderComponent);
    return SliderComponent;
}(ControlBase));
export { SliderComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2xpZGVyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25nLW1ldHJvNC8iLCJzb3VyY2VzIjpbImxpYi9mb3JtL3NsaWRlci9zbGlkZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUMsU0FBUyxFQUFFLFVBQVUsRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFFLGlCQUFpQixFQUFDLE1BQU0sZUFBZSxDQUFDO0FBQ3pGLE9BQU8sRUFBQyxXQUFXLEVBQUMsTUFBTSxpQkFBaUIsQ0FBQztBQUM1QyxPQUFPLEVBQUMsb0JBQW9CLEVBQUMsTUFBTSxxQ0FBcUMsQ0FBQztBQUN6RSxPQUFPLEVBQUMsU0FBUyxFQUFDLE1BQU0seUJBQXlCLENBQUM7QUFDbEQsT0FBTyxFQUFDLGFBQWEsRUFBQyxNQUFNLE1BQU0sQ0FBQztBQUVuQyxPQUFPLEVBQUMsWUFBWSxFQUFDLE1BQU0sNEJBQTRCLENBQUM7QUFXeEQ7SUFBcUMsbUNBQW1CO0lBQXhEOztJQTJGQSxDQUFDO3dCQTNGWSxlQUFlO0lBK0IxQix1Q0FBYSxHQUFiO1FBQUEsaUJBNEJDO1FBM0JDLE9BQU8sSUFBSSxPQUFPLENBQU8sVUFBQyxRQUFRO1lBQ2hDLElBQU0sZUFBZSxHQUFHLENBQUMsQ0FBQyxLQUFJLENBQUMsS0FBSyxDQUFDLGFBQWEsQ0FBQyxDQUFDO1lBQ3BELFlBQVksQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLENBQUM7WUFFbkMsSUFBSSxLQUFJLENBQUMsYUFBYSxFQUFFO2dCQUN0QixLQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sRUFBRSxDQUFDLE1BQU0sRUFBRSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDO2dCQUN0RSxLQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sRUFBRSxDQUFDLE1BQU0sRUFBRSxDQUFDO2FBQ3RDO1lBRUQsS0FBSSxDQUFDLGFBQWEsR0FBRyxlQUFlLENBQUMsS0FBSyxF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LENBQUM7O3NEQUFtQjtJQUNoQjtRQUF0QixLQUFLLENBQUMsY0FBYyxDQUFDOzt3REFBcUI7SUFDcEI7UUFBdEIsS0FBSyxDQUFDLGNBQWMsQ0FBQzs7d0RBQXFCO0lBQ3RCO1FBQXBCLEtBQUssQ0FBQyxZQUFZLENBQUM7O3NEQUFtQjtJQUNsQjtRQUFwQixLQUFLLENBQUMsWUFBWSxDQUFDOztzREFBbUI7SUFDcEI7UUFBbEIsS0FBSyxDQUFDLFVBQVUsQ0FBQzs7b0RBQWlCO0lBQ2I7UUFBckIsS0FBSyxDQUFDLGFBQWEsQ0FBQzs7c0RBQW1CO0lBQ3RCO1FBQWpCLEtBQUssQ0FBQyxTQUFTLENBQUM7O21EQUFnQjtJQUNmO1FBQWpCLEtBQUssQ0FBQyxTQUFTLENBQUM7O21EQUFnQjtJQUVLO1FBQXJDLFNBQVMsQ0FBQyxPQUFPLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLENBQUM7a0NBQWdCLFVBQVU7a0RBQUM7SUEzQnJELGVBQWU7UUFQM0IsU0FBUyxDQUFDO1lBQ1QsUUFBUSxFQUFFLFdBQVc7WUFDckIsZ2tDQUFzQztZQUV0QyxTQUFTLEVBQUUsQ0FBQyxvQkFBb0IsQ0FBQyxHQUFHLENBQUMsaUJBQWUsQ0FBQyxFQUFFLFNBQVMsQ0FBQyxHQUFHLENBQUMsaUJBQWUsQ0FBQyxDQUFDO1lBQ3RGLGFBQWEsRUFBRSxpQkFBaUIsQ0FBQyxJQUFJOztTQUN0QyxDQUFDO09BQ1csZUFBZSxDQTJGM0I7SUFBRCxzQkFBQztDQUFBLEFBM0ZELENBQXFDLFdBQVcsR0EyRi9DO1NBM0ZZLGVBQWUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0NvbXBvbmVudCwgRWxlbWVudFJlZiwgSW5wdXQsIFZpZXdDaGlsZCwgVmlld0VuY2Fwc3VsYXRpb259IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQge0NvbnRyb2xCYXNlfSBmcm9tICcuLi9jb250cm9sLWJhc2UnO1xyXG5pbXBvcnQge0RlZmF1bHRWYWx1ZUFjY2Vzc29yfSBmcm9tICcuLi8uLi9oZWxwZXIvZGVmYXVsdC12YWx1ZS1hY2Nlc3Nvcic7XHJcbmltcG9ydCB7VHlwZUFsaWFzfSBmcm9tICcuLi8uLi9oZWxwZXIvdHlwZS1hbGlhcyc7XHJcbmltcG9ydCB7YXNhcFNjaGVkdWxlcn0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7UG9zaXRpb25CYXNlVHlwZSwgVGhpblR5cGV9IGZyb20gJy4uLy4uL2hlbHBlci90eXBlcyc7XHJcbmltcG9ydCB7T2JqZWN0SGVscGVyfSBmcm9tICcuLi8uLi9oZWxwZXIvb2JqZWN0LWhlbHBlcic7XHJcblxyXG5kZWNsYXJlIHZhciAkOiBhbnk7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ200LXNsaWRlcicsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL3NsaWRlci5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vc2xpZGVyLmNvbXBvbmVudC5sZXNzJ10sXHJcbiAgcHJvdmlkZXJzOiBbRGVmYXVsdFZhbHVlQWNjZXNzb3IuZ2V0KFNsaWRlckNvbXBvbmVudCksIFR5cGVBbGlhcy5nZXQoU2xpZGVyQ29tcG9uZW50KV0sXHJcbiAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZVxyXG59KVxyXG5leHBvcnQgY2xhc3MgU2xpZGVyQ29tcG9uZW50IGV4dGVuZHMgQ29udHJvbEJhc2U8bnVtYmVyPiB7XHJcblxyXG4gIEBJbnB1dCgnbWluJykgbWluOiBudW1iZXI7XHJcbiAgQElucHV0KCdtYXgnKSBtYXg6IG51bWJlcjtcclxuICBASW5wdXQoJ3Nob3ctbWluLW1heCcpIHNob3dNaW5NYXg6IGJvb2xlYW47XHJcbiAgQElucHV0KCdhY2N1cmFjeScpIGFjY3VyYWN5OiBudW1iZXI7XHJcbiAgQElucHV0KCdidWZmZXInKSBidWZmZXI6IG51bWJlcjtcclxuICBASW5wdXQoJ2hpbnQnKSBoaW50OiBib29sZWFuO1xyXG4gIEBJbnB1dCgnaGludC1hbHdheXMnKSBoaW50QWx3YXlzOiBib29sZWFuO1xyXG4gIEBJbnB1dCgnaGludC1wb3NpdGlvbicpIGhpbnRQb3NpdGlvbjogUG9zaXRpb25CYXNlVHlwZTtcclxuICBASW5wdXQoJ2hpbnQtbWFzaycpIGhpbnRNYXNrOiBzdHJpbmc7XHJcbiAgQElucHV0KCd2ZXJ0aWNhbCcpIHZlcnRpY2FsOiBib29sZWFuO1xyXG4gIEBJbnB1dCgnc2l6ZScpIHNpemU6IG51bWJlcjtcclxuXHJcbiAgQElucHV0KCd0aGluJykgdGhpbjogVGhpblR5cGU7XHJcbiAgQElucHV0KCdjeWNsZS1tYXJrZXInKSBjeWNsZU1hcmtlcjogYm9vbGVhbjtcclxuXHJcbiAgQElucHV0KCdjbHMtc2xpZGVyJykgY2xzU2xpZGVyOiBzdHJpbmc7XHJcbiAgQElucHV0KCdjbHMtYmFja3NpZGUnKSBjbHNCYWNrc2lkZTogc3RyaW5nO1xyXG4gIEBJbnB1dCgnY2xzLWNvbXBsZXRlJykgY2xzQ29tcGxldGU6IHN0cmluZztcclxuICBASW5wdXQoJ2Nscy1idWZmZXInKSBjbHNCdWZmZXI6IHN0cmluZztcclxuICBASW5wdXQoJ2Nscy1tYXJrZXInKSBjbHNNYXJrZXI6IHN0cmluZztcclxuICBASW5wdXQoJ2Nscy1oaW50JykgY2xzSGludDogc3RyaW5nO1xyXG4gIEBJbnB1dCgnY2xzLW1pbi1tYXgnKSBjbHNNaW5NYXg6IHN0cmluZztcclxuICBASW5wdXQoJ2Nscy1taW4nKSBjbHNNaW46IHN0cmluZztcclxuICBASW5wdXQoJ2Nscy1tYXgnKSBjbHNNYXg6IHN0cmluZztcclxuXHJcbiAgQFZpZXdDaGlsZCgnaW5wdXQnLCB7IHN0YXRpYzogdHJ1ZSB9KSBwcml2YXRlIGlucHV0OiBFbGVtZW50UmVmO1xyXG4gIHByaXZhdGUgc2xpZGVyOiBhbnk7XHJcbiAgcHJpdmF0ZSBjbG9uZWRFbGVtZW50OiBhbnk7XHJcblxyXG4gIGNyZWF0ZUNvbnRyb2woKSB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2U8dm9pZD4oKGNvbXBsZXRlKSA9PiB7XHJcbiAgICAgIGNvbnN0IG9yaWdpbmFsRWxlbWVudCA9ICQodGhpcy5pbnB1dC5uYXRpdmVFbGVtZW50KTtcclxuICAgICAgT2JqZWN0SGVscGVyLmhpZGUob3JpZ2luYWxFbGVtZW50KTtcclxuXHJcbiAgICAgIGlmICh0aGlzLmNsb25lZEVsZW1lbnQpIHtcclxuICAgICAgICB0aGlzLmNsb25lZEVsZW1lbnQucGFyZW50KCkucGFyZW50KCkuZmluZCgnLnNsaWRlci1taW4tbWF4JykucmVtb3ZlKCk7XHJcbiAgICAgICAgdGhpcy5jbG9uZWRFbGVtZW50LnBhcmVudCgpLnJlbW92ZSgpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICB0aGlzLmNsb25lZEVsZW1lbnQgPSBvcmlnaW5hbEVsZW1lbnQuY2xvbmUoKTtcclxuICAgICAgT2JqZWN0SGVscGVyLnNob3codGhpcy5jbG9uZWRFbGVtZW50KTtcclxuICAgICAgb3JpZ2luYWxFbGVtZW50LnBhcmVudCgpLmFwcGVuZCh0aGlzLmNsb25lZEVsZW1lbnQpO1xyXG5cclxuICAgICAgdGhpcy5zbGlkZXIgPSB0aGlzLmNsb25lZEVsZW1lbnQuc2xpZGVyKCkuZGF0YSgnc2xpZGVyJyk7XHJcblxyXG4gICAgICB0aGlzLmNsb25lZEVsZW1lbnQucGFyZW50KCkuZmluZCgnYnV0dG9uLm1hcmtlcicpLm9uZSgnYmx1cicsICgpID0+IHtcclxuICAgICAgICB0aGlzLnRvdWNoQ2FsbGJhY2soKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICB0aGlzLmNsb25lZEVsZW1lbnQub24oJ2NoYW5nZScsICgpID0+IHtcclxuICAgICAgICBhc2FwU2NoZWR1bGVyLnNjaGVkdWxlKCgpID0+IHtcclxuICAgICAgICAgIHRoaXMuY2hhbmdlVmFsdWUoK3RoaXMuY2xvbmVkRWxlbWVudC52YWwoKSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgY29tcGxldGUoKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZGlzYWJsZShkaXNhYmxlZDogYm9vbGVhbik6IHZvaWQge1xyXG4gICAgaWYgKGRpc2FibGVkKSB7XHJcbiAgICAgIHRoaXMuY2xvbmVkRWxlbWVudC5wYXJlbnQoKS5hZGRDbGFzcygnZGlzYWJsZWQnKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuY2xvbmVkRWxlbWVudC5wYXJlbnQoKS5yZW1vdmVDbGFzcygnZGlzYWJsZWQnKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIG5ld1ZhbHVlKCk6IHZvaWQge1xyXG4gICAgaWYgKCF0aGlzLnNsaWRlcikge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5zbGlkZXIudmFsKHRoaXMuaW5uZXJWYWx1ZSk7XHJcbiAgfVxyXG5cclxuICBuZXdDbGFzc1ZhbHVlKG5ld0NsYXNzZXM6IHN0cmluZ1tdLCBvbGRDbGFzc2VzOiBzdHJpbmdbXSkge1xyXG4gICAgaWYgKHRoaXMuY2xvbmVkRWxlbWVudCkge1xyXG4gICAgICBjb25zdCB0YXJnZXQgPSB0aGlzLmNsb25lZEVsZW1lbnQucGFyZW50KCk7XHJcblxyXG4gICAgICBvbGRDbGFzc2VzLmZvckVhY2goKGNsczogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgdGFyZ2V0LnJlbW92ZUNsYXNzKGNscyk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgbmV3Q2xhc3Nlcy5mb3JFYWNoKChjbHM6IHN0cmluZykgPT4ge1xyXG4gICAgICAgIHRhcmdldC5hZGRDbGFzcyhjbHMpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG59XHJcbiJdfQ==