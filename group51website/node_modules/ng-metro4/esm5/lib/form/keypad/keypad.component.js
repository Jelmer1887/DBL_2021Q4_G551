import { __decorate, __extends, __metadata } from "tslib";
import { ChangeDetectionStrategy, Component, ElementRef, Input, ViewChild } from '@angular/core';
import { DefaultValueAccessor } from '../../helper/default-value-accessor';
import { ControlBase } from '../control-base';
import { TypeAlias } from '../../helper/type-alias';
import { asapScheduler } from 'rxjs';
import { ObjectHelper } from '../../helper/object-helper';
var KeypadComponent = /** @class */ (function (_super) {
    __extends(KeypadComponent, _super);
    function KeypadComponent() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.type = 'text';
        return _this;
    }
    KeypadComponent_1 = KeypadComponent;
    KeypadComponent.prototype.createControl = function () {
        var _this = this;
        return new Promise(function (complete) {
            var originalElement = $(_this.input.nativeElement);
            ObjectHelper.hide(originalElement);
            if (_this.clonedElement) {
                _this.clonedElement.parent().remove();
            }
            _this.clonedElement = originalElement.clone();
            ObjectHelper.show(_this.clonedElement);
            originalElement.parent().append(_this.clonedElement);
            _this.keypad = _this.clonedElement.keypad().data('keypad');
            _this.clonedElement.one('blur', function () {
                _this.touchCallback();
            });
            _this.clonedElement.on('change', function () {
                asapScheduler.schedule(function () {
                    var newValue = _this.clonedElement.val();
                    if (_this.type === 'number') {
                        newValue = +newValue;
                    }
                    _this.changeValue(newValue);
                });
            });
            complete();
        });
    };
    KeypadComponent.prototype.disable = function (disabled) {
        if (disabled) {
            this.keypad.disable();
        }
        else {
            this.keypad.enable();
        }
    };
    KeypadComponent.prototype.newValue = function () {
        if (!this.keypad) {
            return;
        }
        this.keypad.val(this.innerValue ? this.innerValue.toString() : '');
    };
    KeypadComponent.prototype.newClassValue = function (newClasses, oldClasses) {
        if (this.clonedElement) {
            var target_1 = this.clonedElement.parent();
            oldClasses.forEach(function (cls) {
                target_1.removeClass(cls);
            });
            newClasses.forEach(function (cls) {
                target_1.addClass(cls);
            });
        }
    };
    var KeypadComponent_1;
    __decorate([
        Input('type'),
        __metadata("design:type", String)
    ], KeypadComponent.prototype, "type", void 0);
    __decorate([
        Input('key-size'),
        __metadata("design:type", Number)
    ], KeypadComponent.prototype, "keySize", void 0);
    __decorate([
        Input('keys'),
        __metadata("design:type", Array)
    ], KeypadComponent.prototype, "keys", void 0);
    __decorate([
        Input('key-length'),
        __metadata("design:type", Number)
    ], KeypadComponent.prototype, "keyLength", void 0);
    __decorate([
        Input('shuffle'),
        __metadata("design:type", Boolean)
    ], KeypadComponent.prototype, "shuffle", void 0);
    __decorate([
        Input('shuffle-count'),
        __metadata("design:type", Number)
    ], KeypadComponent.prototype, "shuffleCount", void 0);
    __decorate([
        Input('position'),
        __metadata("design:type", String)
    ], KeypadComponent.prototype, "position", void 0);
    __decorate([
        Input('dynamic-position'),
        __metadata("design:type", Boolean)
    ], KeypadComponent.prototype, "dynamicPosition", void 0);
    __decorate([
        Input('service-buttons'),
        __metadata("design:type", Boolean)
    ], KeypadComponent.prototype, "serviceButtons", void 0);
    __decorate([
        Input('show-value'),
        __metadata("design:type", Boolean)
    ], KeypadComponent.prototype, "showValue", void 0);
    __decorate([
        Input('open'),
        __metadata("design:type", Boolean)
    ], KeypadComponent.prototype, "open", void 0);
    __decorate([
        Input('size-as-keys'),
        __metadata("design:type", Boolean)
    ], KeypadComponent.prototype, "sizeAsKeys", void 0);
    __decorate([
        Input('cls-keypad'),
        __metadata("design:type", String)
    ], KeypadComponent.prototype, "clsKeypad", void 0);
    __decorate([
        Input('cls-input'),
        __metadata("design:type", String)
    ], KeypadComponent.prototype, "clsInput", void 0);
    __decorate([
        Input('cls-keys'),
        __metadata("design:type", String)
    ], KeypadComponent.prototype, "clsKeys", void 0);
    __decorate([
        Input('cls-key'),
        __metadata("design:type", String)
    ], KeypadComponent.prototype, "clsKey", void 0);
    __decorate([
        Input('cls-service-key'),
        __metadata("design:type", String)
    ], KeypadComponent.prototype, "clsServiceKey", void 0);
    __decorate([
        Input('cls-backspace'),
        __metadata("design:type", String)
    ], KeypadComponent.prototype, "clsBackspace", void 0);
    __decorate([
        Input('cls-clear'),
        __metadata("design:type", String)
    ], KeypadComponent.prototype, "clsClear", void 0);
    __decorate([
        ViewChild('input', { static: true }),
        __metadata("design:type", ElementRef)
    ], KeypadComponent.prototype, "input", void 0);
    KeypadComponent = KeypadComponent_1 = __decorate([
        Component({
            selector: 'm4-keypad',
            template: "<input [type]=\"type\" #input\r\n\r\n\r\n       [attr.data-key-size]=\"keySize\"\r\n       [attr.data-keys]=\"keys?.join(',')\"\r\n       [attr.data-key-length]=\"keyLength\"\r\n       [attr.data-shuffle]=\"shuffle\"\r\n       [attr.data-shuffle-count]=\"shuffleCount\"\r\n       [attr.data-position]=\"position\"\r\n       [attr.data-dynamic-position]=\"dynamicPosition\"\r\n       [attr.data-service-buttons]=\"serviceButtons\"\r\n       [attr.data-show-value]=\"showValue\"\r\n       [attr.data-open]=\"open\"\r\n       [attr.data-size-as-keys]=\"sizeAsKeys\"\r\n\r\n       [attr.data-cls-keypad]=\"clsKeypad\"\r\n       [attr.data-cls-input]=\"clsInput\"\r\n       [attr.data-cls-keys]=\"clsKeys\"\r\n       [attr.data-cls-key]=\"clsKey\"\r\n       [attr.data-cls-service-key]=\"clsServiceKey\"\r\n       [attr.data-cls-backspace]=\"clsBackspace\"\r\n       [attr.data-cls-clear]=\"clsClear\">\r\n",
            providers: [DefaultValueAccessor.get(KeypadComponent_1), TypeAlias.get(KeypadComponent_1)],
            changeDetection: ChangeDetectionStrategy.OnPush,
            styles: [""]
        })
    ], KeypadComponent);
    return KeypadComponent;
}(ControlBase));
export { KeypadComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoia2V5cGFkLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25nLW1ldHJvNC8iLCJzb3VyY2VzIjpbImxpYi9mb3JtL2tleXBhZC9rZXlwYWQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUMsdUJBQXVCLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFDLE1BQU0sZUFBZSxDQUFDO0FBQy9GLE9BQU8sRUFBQyxvQkFBb0IsRUFBQyxNQUFNLHFDQUFxQyxDQUFDO0FBQ3pFLE9BQU8sRUFBQyxXQUFXLEVBQUMsTUFBTSxpQkFBaUIsQ0FBQztBQUU1QyxPQUFPLEVBQUMsU0FBUyxFQUFDLE1BQU0seUJBQXlCLENBQUM7QUFDbEQsT0FBTyxFQUFDLGFBQWEsRUFBQyxNQUFNLE1BQU0sQ0FBQztBQUNuQyxPQUFPLEVBQUMsWUFBWSxFQUFDLE1BQU0sNEJBQTRCLENBQUM7QUFXeEQ7SUFBcUMsbUNBQTBCO0lBQS9EO1FBQUEscUVBOEZDO1FBNUZnQixVQUFJLEdBQWMsTUFBTSxDQUFDOztJQTRGMUMsQ0FBQzt3QkE5RlksZUFBZTtJQTJCMUIsdUNBQWEsR0FBYjtRQUFBLGlCQW1DQztRQWxDQyxPQUFPLElBQUksT0FBTyxDQUFPLFVBQUMsUUFBUTtZQUNoQyxJQUFNLGVBQWUsR0FBRyxDQUFDLENBQUMsS0FBSSxDQUFDLEtBQUssQ0FBQyxhQUFhLENBQUMsQ0FBQztZQUNwRCxZQUFZLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDO1lBRW5DLElBQUksS0FBSSxDQUFDLGFBQWEsRUFBRTtnQkFDdEIsS0FBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxNQUFNLEVBQUUsQ0FBQzthQUN0QztZQUVELEtBQUksQ0FBQyxhQUFhLEdBQUcsZUFBZSxDQUFDLEtBQUssRUFBRSxDQUFDO1lBQzdDLFlBQVksQ0FBQyxJQUFJLENBQUMsS0FBSSxDQUFDLGFBQWEsQ0FBQyxDQUFD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c0RBQW1CO0lBQ25CO1FBQW5CLEtBQUssQ0FBQyxXQUFXLENBQUM7O3FEQUFrQjtJQUNsQjtRQUFsQixLQUFLLENBQUMsVUFBVSxDQUFDOztvREFBaUI7SUFDakI7UUFBakIsS0FBSyxDQUFDLFNBQVMsQ0FBQzs7bURBQWdCO0lBQ1A7UUFBekIsS0FBSyxDQUFDLGlCQUFpQixDQUFDOzswREFBdUI7SUFDeEI7UUFBdkIsS0FBSyxDQUFDLGVBQWUsQ0FBQzs7eURBQXNCO0lBQ3pCO1FBQW5CLEtBQUssQ0FBQyxXQUFXLENBQUM7O3FEQUFrQjtJQUVDO1FBQXJDLFNBQVMsQ0FBQyxPQUFPLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLENBQUM7a0NBQWdCLFVBQVU7a0RBQUM7SUF2QnJELGVBQWU7UUFQM0IsU0FBUyxDQUFDO1lBQ1QsUUFBUSxFQUFFLFdBQVc7WUFDckIsaTVCQUFzQztZQUV0QyxTQUFTLEVBQUUsQ0FBQyxvQkFBb0IsQ0FBQyxHQUFHLENBQUMsaUJBQWUsQ0FBQyxFQUFFLFNBQVMsQ0FBQyxHQUFHLENBQUMsaUJBQWUsQ0FBQyxDQUFDO1lBQ3RGLGVBQWUsRUFBRSx1QkFBdUIsQ0FBQyxNQUFNOztTQUNoRCxDQUFDO09BQ1csZUFBZSxDQThGM0I7SUFBRCxzQkFBQztDQUFBLEFBOUZELENBQXFDLFdBQVcsR0E4Ri9DO1NBOUZZLGVBQWUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0NoYW5nZURldGVjdGlvblN0cmF0ZWd5LCBDb21wb25lbnQsIEVsZW1lbnRSZWYsIElucHV0LCBWaWV3Q2hpbGR9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQge0RlZmF1bHRWYWx1ZUFjY2Vzc29yfSBmcm9tICcuLi8uLi9oZWxwZXIvZGVmYXVsdC12YWx1ZS1hY2Nlc3Nvcic7XHJcbmltcG9ydCB7Q29udHJvbEJhc2V9IGZyb20gJy4uL2NvbnRyb2wtYmFzZSc7XHJcbmltcG9ydCB7SW5wdXRUeXBlLCBQb3NpdGlvblR5cGV9IGZyb20gJy4uLy4uL2hlbHBlci90eXBlcyc7XHJcbmltcG9ydCB7VHlwZUFsaWFzfSBmcm9tICcuLi8uLi9oZWxwZXIvdHlwZS1hbGlhcyc7XHJcbmltcG9ydCB7YXNhcFNjaGVkdWxlcn0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7T2JqZWN0SGVscGVyfSBmcm9tICcuLi8uLi9oZWxwZXIvb2JqZWN0LWhlbHBlcic7XHJcblxyXG5kZWNsYXJlIHZhciAkOiBhbnk7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ200LWtleXBhZCcsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL2tleXBhZC5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4va2V5cGFkLmNvbXBvbmVudC5jc3MnXSxcclxuICBwcm92aWRlcnM6IFtEZWZhdWx0VmFsdWVBY2Nlc3Nvci5nZXQoS2V5cGFkQ29tcG9uZW50KSwgVHlwZUFsaWFzLmdldChLZXlwYWRDb21wb25lbnQpXSxcclxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaFxyXG59KVxyXG5leHBvcnQgY2xhc3MgS2V5cGFkQ29tcG9uZW50IGV4dGVuZHMgQ29udHJvbEJhc2U8c3RyaW5nfG51bWJlcj4ge1xyXG5cclxuICBASW5wdXQoJ3R5cGUnKSB0eXBlOiBJbnB1dFR5cGUgPSAndGV4dCc7XHJcbiAgQElucHV0KCdrZXktc2l6ZScpIGtleVNpemU6IG51bWJlcjtcclxuICBASW5wdXQoJ2tleXMnKSBrZXlzOiBzdHJpbmdbXTtcclxuICBASW5wdXQoJ2tleS1sZW5ndGgnKSBrZXlMZW5ndGg6IG51bWJlcjtcclxuICBASW5wdXQoJ3NodWZmbGUnKSBzaHVmZmxlOiBib29sZWFuO1xyXG4gIEBJbnB1dCgnc2h1ZmZsZS1jb3VudCcpIHNodWZmbGVDb3VudDogbnVtYmVyO1xyXG4gIEBJbnB1dCgncG9zaXRpb24nKSBwb3NpdGlvbjogUG9zaXRpb25UeXBlO1xyXG4gIEBJbnB1dCgnZHluYW1pYy1wb3NpdGlvbicpIGR5bmFtaWNQb3NpdGlvbjogYm9vbGVhbjtcclxuICBASW5wdXQoJ3NlcnZpY2UtYnV0dG9ucycpIHNlcnZpY2VCdXR0b25zOiBib29sZWFuO1xyXG4gIEBJbnB1dCgnc2hvdy12YWx1ZScpIHNob3dWYWx1ZTogYm9vbGVhbjtcclxuICBASW5wdXQoJ29wZW4nKSBvcGVuOiBib29sZWFuO1xyXG4gIEBJbnB1dCgnc2l6ZS1hcy1rZXlzJykgc2l6ZUFzS2V5czogYm9vbGVhbjtcclxuXHJcbiAgQElucHV0KCdjbHMta2V5cGFkJykgY2xzS2V5cGFkOiBzdHJpbmc7XHJcbiAgQElucHV0KCdjbHMtaW5wdXQnKSBjbHNJbnB1dDogc3RyaW5nO1xyXG4gIEBJbnB1dCgnY2xzLWtleXMnKSBjbHNLZXlzOiBzdHJpbmc7XHJcbiAgQElucHV0KCdjbHMta2V5JykgY2xzS2V5OiBzdHJpbmc7XHJcbiAgQElucHV0KCdjbHMtc2VydmljZS1rZXknKSBjbHNTZXJ2aWNlS2V5OiBzdHJpbmc7XHJcbiAgQElucHV0KCdjbHMtYmFja3NwYWNlJykgY2xzQmFja3NwYWNlOiBzdHJpbmc7XHJcbiAgQElucHV0KCdjbHMtY2xlYXInKSBjbHNDbGVhcjogc3RyaW5nO1xyXG5cclxuICBAVmlld0NoaWxkKCdpbnB1dCcsIHsgc3RhdGljOiB0cnVlIH0pIHByaXZhdGUgaW5wdXQ6IEVsZW1lbnRSZWY7XHJcbiAgcHJpdmF0ZSBrZXlwYWQ6IGFueTtcclxuICBwcml2YXRlIGNsb25lZEVsZW1lbnQ6IGFueTtcclxuXHJcbiAgY3JlYXRlQ29udHJvbCgpIHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZTx2b2lkPigoY29tcGxldGUpID0+IHtcclxuICAgICAgY29uc3Qgb3JpZ2luYWxFbGVtZW50ID0gJCh0aGlzLmlucHV0Lm5hdGl2ZUVsZW1lbnQpO1xyXG4gICAgICBPYmplY3RIZWxwZXIuaGlkZShvcmlnaW5hbEVsZW1lbnQpO1xyXG5cclxuICAgICAgaWYgKHRoaXMuY2xvbmVkRWxlbWVudCkge1xyXG4gICAgICAgIHRoaXMuY2xvbmVkRWxlbWVudC5wYXJlbnQoKS5yZW1vdmUoKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgdGhpcy5jbG9uZWRFbGVtZW50ID0gb3JpZ2luYWxFbGVtZW50LmNsb25lKCk7XHJcbiAgICAgIE9iamVjdEhlbHBlci5zaG93KHRoaXMuY2xvbmVkRWxlbWVudCk7XHJcbiAgICAgIG9yaWdpbmFsRWxlbWVudC5wYXJlbnQoKS5hcHBlbmQodGhpcy5jbG9uZWRFbGVtZW50KTtcclxuXHJcbiAgICAgIHRoaXMua2V5cGFkID0gdGhpcy5jbG9uZWRFbGVtZW50LmtleXBhZCgpLmRhdGEoJ2tleXBhZCcpO1xyXG5cclxuICAgICAgdGhpcy5jbG9uZWRFbGVtZW50Lm9uZSgnYmx1cicsICgpID0+IHtcclxuICAgICAgICB0aGlzLnRvdWNoQ2FsbGJhY2soKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICB0aGlzLmNsb25lZEVsZW1lbnQub24oJ2NoYW5nZScsICgpID0+IHtcclxuICAgICAgICBhc2FwU2NoZWR1bGVyLnNjaGVkdWxlKCgpID0+IHtcclxuICAgICAgICAgIGxldCBuZXdWYWx1ZSA9IHRoaXMuY2xvbmVkRWxlbWVudC52YWwoKTtcclxuXHJcbiAgICAgICAgICBpZiAodGhpcy50eXBlID09PSAnbnVtYmVyJykge1xyXG4gICAgICAgICAgICBuZXdWYWx1ZSA9ICtuZXdWYWx1ZTtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICB0aGlzLmNoYW5nZVZhbHVlKG5ld1ZhbHVlKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb21wbGV0ZSgpO1xyXG4gICAgfSk7XHJcblxyXG5cclxuICB9XHJcblxyXG4gIGRpc2FibGUoZGlzYWJsZWQ6IGJvb2xlYW4pOiB2b2lkIHtcclxuICAgIGlmIChkaXNhYmxlZCkge1xyXG4gICAgICB0aGlzLmtleXBhZC5kaXNhYmxlKCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLmtleXBhZC5lbmFibGUoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIG5ld1ZhbHVlKCk6IHZvaWQge1xyXG4gICAgaWYgKCF0aGlzLmtleXBhZCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5rZXlwYWQudmFsKHRoaXMuaW5uZXJWYWx1ZSA/IHRoaXMuaW5uZXJWYWx1ZS50b1N0cmluZygpIDogJycpO1xyXG4gIH1cclxuXHJcbiAgbmV3Q2xhc3NWYWx1ZShuZXdDbGFzc2VzOiBzdHJpbmdbXSwgb2xkQ2xhc3Nlczogc3RyaW5nW10pIHtcclxuICAgIGlmICh0aGlzLmNsb25lZEVsZW1lbnQpIHtcclxuICAgICAgY29uc3QgdGFyZ2V0ID0gdGhpcy5jbG9uZWRFbGVtZW50LnBhcmVudCgpO1xyXG5cclxuICAgICAgb2xkQ2xhc3Nlcy5mb3JFYWNoKChjbHM6IHN0cmluZykgPT4ge1xyXG4gICAgICAgIHRhcmdldC5yZW1vdmVDbGFzcyhjbHMpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIG5ld0NsYXNzZXMuZm9yRWFjaCgoY2xzOiBzdHJpbmcpID0+IHtcclxuICAgICAgICB0YXJnZXQuYWRkQ2xhc3MoY2xzKTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxufVxyXG4iXX0=