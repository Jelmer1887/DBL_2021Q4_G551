import { __decorate, __extends, __metadata } from "tslib";
import { ChangeDetectionStrategy, Component, ElementRef, Input, ViewChild } from '@angular/core';
import { DefaultValueAccessor } from '../../helper/default-value-accessor';
import { ControlBase } from '../control-base';
import * as moment from 'moment';
import { TypeAlias } from '../../helper/type-alias';
import { asapScheduler } from 'rxjs';
import { ObjectHelper } from '../../helper/object-helper';
var _moment = moment;
var CalendarPickerComponent = /** @class */ (function (_super) {
    __extends(CalendarPickerComponent, _super);
    function CalendarPickerComponent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    CalendarPickerComponent_1 = CalendarPickerComponent;
    CalendarPickerComponent.prototype.createControl = function () {
        var _this = this;
        return new Promise(function (complete) {
            var originalElement = $(_this.input.nativeElement);
            ObjectHelper.hide(originalElement);
            if (_this.clonedElement) {
                _this.clonedElement.parent().remove();
            }
            _this.clonedElement = originalElement.clone();
            ObjectHelper.show(_this.clonedElement);
            originalElement.parent().append(_this.clonedElement);
            _this.calendarPicker = _this.clonedElement.calendarpicker().data('calendarpicker');
            _this.clonedElement.one('blur', function () {
                _this.touchCallback();
            });
            _this.calendarPicker.options.onChange = function () {
                asapScheduler.schedule(function () {
                    var val = _this.calendarPicker.value;
                    _this.changeValue(val ? _moment(val.toLocaleDateString('en'), 'MM/DD/YYYY') : null);
                });
            };
            complete();
        });
    };
    CalendarPickerComponent.prototype.disable = function (disabled) {
        var _this = this;
        asapScheduler.schedule(function () {
            if (disabled) {
                _this.calendarPicker.disable();
            }
            else {
                _this.calendarPicker.enable();
            }
        });
    };
    CalendarPickerComponent.prototype.newValue = function () {
        var _this = this;
        if (!this.calendarPicker) {
            return;
        }
        asapScheduler.schedule(function () {
            _this.calendarPicker.val(_this.innerValue ? _this.innerValue.format('MM/DD/YYYY') : '01/01/0000');
        });
    };
    CalendarPickerComponent.prototype.convertMomentArray = function (arr) {
        return arr ? arr.map(function (v) { return v.format('MM/DD/YYYY'); }).join(',') : null;
    };
    CalendarPickerComponent.prototype.newClassValue = function (newClasses, oldClasses) {
        var _this = this;
        asapScheduler.schedule(function () {
            if (_this.clonedElement) {
                var target_1 = _this.clonedElement.parent();
                oldClasses.forEach(function (cls) {
                    target_1.removeClass(cls);
                });
                newClasses.forEach(function (cls) {
                    target_1.addClass(cls);
                });
            }
        });
    };
    var CalendarPickerComponent_1;
    __decorate([
        Input('calendar-wide'),
        __metadata("design:type", Boolean)
    ], CalendarPickerComponent.prototype, "calendarWide", void 0);
    __decorate([
        Input('calendar-wide-point'),
        __metadata("design:type", String)
    ], CalendarPickerComponent.prototype, "calendarWidePoint", void 0);
    __decorate([
        Input('dialog-mode'),
        __metadata("design:type", Boolean)
    ], CalendarPickerComponent.prototype, "dialogMode", void 0);
    __decorate([
        Input('dialog-point'),
        __metadata("design:type", Number)
    ], CalendarPickerComponent.prototype, "dialogPoint", void 0);
    __decorate([
        Input('dialog-overlay'),
        __metadata("design:type", Boolean)
    ], CalendarPickerComponent.prototype, "dialogOverlay", void 0);
    __decorate([
        Input('overlay-color'),
        __metadata("design:type", String)
    ], CalendarPickerComponent.prototype, "overlayColor", void 0);
    __decorate([
        Input('overlay-alpha'),
        __metadata("design:type", Number)
    ], CalendarPickerComponent.prototype, "overlayAlpha", void 0);
    __decorate([
        Input('locale'),
        __metadata("design:type", String)
    ], CalendarPickerComponent.prototype, "locale", void 0);
    __decorate([
        Input('size'),
        __metadata("design:type", String)
    ], CalendarPickerComponent.prototype, "size", void 0);
    __decorate([
        Input('format'),
        __metadata("design:type", String)
    ], CalendarPickerComponent.prototype, "format", void 0);
    __decorate([
        Input('clear-button'),
        __metadata("design:type", Boolean)
    ], CalendarPickerComponent.prototype, "clearButton", void 0);
    __decorate([
        Input('clear-button-icon'),
        __metadata("design:type", String)
    ], CalendarPickerComponent.prototype, "clearButtonIcon", void 0);
    __decorate([
        Input('calendar-button-icon'),
        __metadata("design:type", String)
    ], CalendarPickerComponent.prototype, "calendarButtonIcon", void 0);
    __decorate([
        Input('years-before'),
        __metadata("design:type", Number)
    ], CalendarPickerComponent.prototype, "yearsBefore", void 0);
    __decorate([
        Input('years-after'),
        __metadata("design:type", Number)
    ], CalendarPickerComponent.prototype, "yearsAfter", void 0);
    __decorate([
        Input('week-start'),
        __metadata("design:type", Number)
    ], CalendarPickerComponent.prototype, "weekStart", void 0);
    __decorate([
        Input('outside'),
        __metadata("design:type", Boolean)
    ], CalendarPickerComponent.prototype, "outside", void 0);
    __decorate([
        Input('ripple'),
        __metadata("design:type", Boolean)
    ], CalendarPickerComponent.prototype, "ripple", void 0);
    __decorate([
        Input('ripple-color'),
        __metadata("design:type", String)
    ], CalendarPickerComponent.prototype, "rippleColor", void 0);
    __decorate([
        Input('exclude'),
        __metadata("design:type", Array)
    ], CalendarPickerComponent.prototype, "exclude", void 0);
    __decorate([
        Input('include'),
        __metadata("design:type", Array)
    ], CalendarPickerComponent.prototype, "include", void 0);
    __decorate([
        Input('min-date'),
        __metadata("design:type", Object)
    ], CalendarPickerComponent.prototype, "minDate", void 0);
    __decorate([
        Input('max-date'),
        __metadata("design:type", Object)
    ], CalendarPickerComponent.prototype, "maxDate", void 0);
    __decorate([
        Input('show-header'),
        __metadata("design:type", Boolean)
    ], CalendarPickerComponent.prototype, "showHeader", void 0);
    __decorate([
        Input('cls-picker'),
        __metadata("design:type", String)
    ], CalendarPickerComponent.prototype, "clsPicker", void 0);
    __decorate([
        Input('cls-today'),
        __metadata("design:type", String)
    ], CalendarPickerComponent.prototype, "clsToday", void 0);
    __decorate([
        Input('cls-selected'),
        __metadata("design:type", String)
    ], CalendarPickerComponent.prototype, "clsSelected", void 0);
    __decorate([
        Input('cls-exclude'),
        __metadata("design:type", String)
    ], CalendarPickerComponent.prototype, "clsExclude", void 0);
    __decorate([
        Input('cls-calendar'),
        __metadata("design:type", String)
    ], CalendarPickerComponent.prototype, "clsCalendar", void 0);
    __decorate([
        Input('cls-calendar-header'),
        __metadata("design:type", String)
    ], CalendarPickerComponent.prototype, "clsCalendarHeader", void 0);
    __decorate([
        Input('cls-calendar-content'),
        __metadata("design:type", String)
    ], CalendarPickerComponent.prototype, "clsCalendarContent", void 0);
    __decorate([
        Input('cls-calendar-months'),
        __metadata("design:type", String)
    ], CalendarPickerComponent.prototype, "clsCalendarMonths", void 0);
    __decorate([
        Input('cls-calendar-years'),
        __metadata("design:type", String)
    ], CalendarPickerComponent.prototype, "clsCalendarYears", void 0);
    __decorate([
        ViewChild('input', { static: true }),
        __metadata("design:type", ElementRef)
    ], CalendarPickerComponent.prototype, "input", void 0);
    CalendarPickerComponent = CalendarPickerComponent_1 = __decorate([
        Component({
            selector: 'm4-calendar-picker',
            template: "<input type=\"text\" #input\r\n\r\n       data-input-format=\"%m/%d/%Y\"\r\n\r\n       [attr.data-calendar-wide]=\"calendarWide\"\r\n       [attr.data-calendar-wide-point]=\"calendarWidePoint\"\r\n       [attr.data-dialog-mode]=\"dialogMode\"\r\n       [attr.data-dialog-point]=\"dialogPoint\"\r\n       [attr.data-dialog-overlay]=\"dialogOverlay\"\r\n       [attr.data-overlay-color]=\"overlayColor\"\r\n       [attr.data-overlay-alpha]=\"overlayAlpha\"\r\n       [attr.data-locale]=\"locale\"\r\n       [attr.data-size]=\"size\"\r\n       [attr.data-format]=\"format\"\r\n       [attr.data-clear-button]=\"clearButton\"\r\n       [attr.data-clear-button-icon]=\"clearButtonIcon\"\r\n       [attr.data-calendar-button-icon]=\"calendarButtonIcon\"\r\n       [attr.data-years-before]=\"yearsBefore\"\r\n       [attr.data-years-after]=\"yearsAfter\"\r\n       [attr.data-week-start]=\"weekStart\"\r\n       [attr.data-outside]=\"outside\"\r\n       [attr.data-ripple]=\"ripple\"\r\n       [attr.data-ripple-color]=\"rippleColor\"\r\n       [attr.data-exclude]=\"convertMomentArray(exclude)\"\r\n       [attr.data-special]=\"convertMomentArray(include)\"\r\n       [attr.data-min-date]=\"minDate?.format('MM/DD/YYYY')\"\r\n       [attr.data-max-date]=\"maxDate?.format('MM/DD/YYYY')\"\r\n       [attr.data-show-header]=\"showHeader\"\r\n\r\n       [attr.data-cls-picker]=\"clsPicker\"\r\n       [attr.data-cls-today]=\"clsToday\"\r\n       [attr.data-cls-selected]=\"clsSelected\"\r\n       [attr.data-cls-exclude]=\"clsExclude\"\r\n       [attr.data-cls-calendar]=\"clsCalendar\"\r\n       [attr.data-cls-calendar-header]=\"clsCalendarHeader\"\r\n       [attr.data-cls-calendar-content]=\"clsCalendarContent\"\r\n       [attr.data-cls-calendar-months]=\"clsCalendarMonths\"\r\n       [attr.data-cls-calendar-years]=\"clsCalendarYears\">\r\n",
            providers: [DefaultValueAccessor.get(CalendarPickerComponent_1), TypeAlias.get(CalendarPickerComponent_1)],
            changeDetection: ChangeDetectionStrategy.OnPush,
            styles: [""]
        })
    ], CalendarPickerComponent);
    return CalendarPickerComponent;
}(ControlBase));
export { CalendarPickerComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FsZW5kYXItcGlja2VyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25nLW1ldHJvNC8iLCJzb3VyY2VzIjpbImxpYi9mb3JtL2NhbGVuZGFyLXBpY2tlci9jYWxlbmRhci1waWNrZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUMsdUJBQXVCLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFDLE1BQU0sZUFBZSxDQUFDO0FBQy9GLE9BQU8sRUFBQyxvQkFBb0IsRUFBQyxNQUFNLHFDQUFxQyxDQUFDO0FBQ3pFLE9BQU8sRUFBQyxXQUFXLEVBQUMsTUFBTSxpQkFBaUIsQ0FBQztBQUM1QyxPQUFPLEtBQUssTUFBTSxNQUFNLFFBQVEsQ0FBQztBQUVqQyxPQUFPLEVBQUMsU0FBUyxFQUFDLE1BQU0seUJBQXlCLENBQUM7QUFDbEQsT0FBTyxFQUFDLGFBQWEsRUFBQyxNQUFNLE1BQU0sQ0FBQztBQUNuQyxPQUFPLEVBQUMsWUFBWSxFQUFDLE1BQU0sNEJBQTRCLENBQUM7QUFFeEQsSUFBTSxPQUFPLEdBQUcsTUFBTSxDQUFDO0FBVXZCO0lBQTZDLDJDQUEwQjtJQUF2RTs7SUErR0EsQ0FBQztnQ0EvR1ksdUJBQXVCO0lBeUNsQywrQ0FBYSxHQUFiO1FBQUEsaUJBNkJDO1FBNUJDLE9BQU8sSUFBSSxPQUFPLENBQU8sVUFBQyxRQUFRO1lBQ2hDLElBQU0sZUFBZSxHQUFHLENBQUMsQ0FBQyxLQUFJLENBQUMsS0FBSyxDQUFDLGFBQWEsQ0FBQyxDQUFDO1lBQ3BELFlBQVksQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLENBQUM7WUFFbkMsSUFBSSxLQUFJLENBQUMsYUFBYSxFQUFFO2dCQUN0QixLQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sRUFBRSxDQUFDLE1BQU0sRUFBRSxDQUFDO2FBQ3RDO1lBRUQsS0FBSSxDQUFDLGFBQWEsR0FBRyxlQUFlLENBQUMsS0FBSyxFQUFF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Q0FBQzs7K0RBQXFCO0lBRXJCO1FBQXBCLEtBQUssQ0FBQyxZQUFZLENBQUM7OzhEQUFtQjtJQUNuQjtRQUFuQixLQUFLLENBQUMsV0FBVyxDQUFDOzs2REFBa0I7SUFDZDtRQUF0QixLQUFLLENBQUMsY0FBYyxDQUFDOztnRUFBcUI7SUFDckI7UUFBckIsS0FBSyxDQUFDLGFBQWEsQ0FBQzs7K0RBQW9CO0lBQ2xCO1FBQXRCLEtBQUssQ0FBQyxjQUFjLENBQUM7O2dFQUFxQjtJQUNiO1FBQTdCLEtBQUssQ0FBQyxxQkFBcUIsQ0FBQzs7c0VBQTJCO0lBQ3pCO1FBQTlCLEtBQUssQ0FBQyxzQkFBc0IsQ0FBQzs7dUVBQTRCO0lBQzVCO1FBQTdCLEtBQUssQ0FBQyxxQkFBcUIsQ0FBQzs7c0VBQTJCO0lBQzNCO1FBQTVCLEtBQUssQ0FBQyxvQkFBb0IsQ0FBQzs7cUVBQTBCO0lBRWhCO1FBQXJDLFNBQVMsQ0FBQyxPQUFPLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLENBQUM7a0NBQWdCLFVBQVU7MERBQUM7SUFyQ3JELHVCQUF1QjtRQVBuQyxTQUFTLENBQUM7WUFDVCxRQUFRLEVBQUUsb0JBQW9CO1lBQzlCLDB6REFBK0M7WUFFL0MsU0FBUyxFQUFFLENBQUMsb0JBQW9CLENBQUMsR0FBRyxDQUFDLHlCQUF1QixDQUFDLEVBQUUsU0FBUyxDQUFDLEdBQUcsQ0FBQyx5QkFBdUIsQ0FBQyxDQUFDO1lBQ3RHLGVBQWUsRUFBRSx1QkFBdUIsQ0FBQyxNQUFNOztTQUNoRCxDQUFDO09BQ1csdUJBQXVCLENBK0duQztJQUFELDhCQUFDO0NBQUEsQUEvR0QsQ0FBNkMsV0FBVyxHQStHdkQ7U0EvR1ksdUJBQXVCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSwgQ29tcG9uZW50LCBFbGVtZW50UmVmLCBJbnB1dCwgVmlld0NoaWxkfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHtEZWZhdWx0VmFsdWVBY2Nlc3Nvcn0gZnJvbSAnLi4vLi4vaGVscGVyL2RlZmF1bHQtdmFsdWUtYWNjZXNzb3InO1xyXG5pbXBvcnQge0NvbnRyb2xCYXNlfSBmcm9tICcuLi9jb250cm9sLWJhc2UnO1xyXG5pbXBvcnQgKiBhcyBtb21lbnQgZnJvbSAnbW9tZW50JztcclxuaW1wb3J0IHtXaWRlUG9pbnRUeXBlfSBmcm9tICcuLi8uLi9oZWxwZXIvdHlwZXMnO1xyXG5pbXBvcnQge1R5cGVBbGlhc30gZnJvbSAnLi4vLi4vaGVscGVyL3R5cGUtYWxpYXMnO1xyXG5pbXBvcnQge2FzYXBTY2hlZHVsZXJ9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQge09iamVjdEhlbHBlcn0gZnJvbSAnLi4vLi4vaGVscGVyL29iamVjdC1oZWxwZXInO1xyXG5cclxuY29uc3QgX21vbWVudCA9IG1vbWVudDtcclxuZGVjbGFyZSB2YXIgJDogYW55O1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdtNC1jYWxlbmRhci1waWNrZXInLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9jYWxlbmRhci1waWNrZXIuY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsczogWycuL2NhbGVuZGFyLXBpY2tlci5jb21wb25lbnQuY3NzJ10sXHJcbiAgcHJvdmlkZXJzOiBbRGVmYXVsdFZhbHVlQWNjZXNzb3IuZ2V0KENhbGVuZGFyUGlja2VyQ29tcG9uZW50KSwgVHlwZUFsaWFzLmdldChDYWxlbmRhclBpY2tlckNvbXBvbmVudCldLFxyXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBDYWxlbmRhclBpY2tlckNvbXBvbmVudCBleHRlbmRzIENvbnRyb2xCYXNlPG1vbWVudC5Nb21lbnQ+IHtcclxuXHJcbiAgQElucHV0KCdjYWxlbmRhci13aWRlJykgY2FsZW5kYXJXaWRlOiBib29sZWFuO1xyXG4gIEBJbnB1dCgnY2FsZW5kYXItd2lkZS1wb2ludCcpIGNhbGVuZGFyV2lkZVBvaW50OiBXaWRlUG9pbnRUeXBlO1xyXG4gIEBJbnB1dCgnZGlhbG9nLW1vZGUnKSBkaWFsb2dNb2RlOiBib29sZWFuO1xyXG4gIEBJbnB1dCgnZGlhbG9nLXBvaW50JykgZGlhbG9nUG9pbnQ6IG51bWJlcjtcclxuICBASW5wdXQoJ2RpYWxvZy1vdmVybGF5JykgZGlhbG9nT3ZlcmxheTogYm9vbGVhbjtcclxuICBASW5wdXQoJ292ZXJsYXktY29sb3InKSBvdmVybGF5Q29sb3I6IHN0cmluZztcclxuICBASW5wdXQoJ292ZXJsYXktYWxwaGEnKSBvdmVybGF5QWxwaGE6IG51bWJlcjtcclxuICBASW5wdXQoJ2xvY2FsZScpIGxvY2FsZTogc3RyaW5nO1xyXG4gIEBJbnB1dCgnc2l6ZScpIHNpemU6IHN0cmluZztcclxuICBASW5wdXQoJ2Zvcm1hdCcpIGZvcm1hdDogc3RyaW5nO1xyXG4gIEBJbnB1dCgnY2xlYXItYnV0dG9uJykgY2xlYXJCdXR0b246IGJvb2xlYW47XHJcbiAgQElucHV0KCdjbGVhci1idXR0b24taWNvbicpIGNsZWFyQnV0dG9uSWNvbjogc3RyaW5nO1xyXG4gIEBJbnB1dCgnY2FsZW5kYXItYnV0dG9uLWljb24nKSBjYWxlbmRhckJ1dHRvbkljb246IHN0cmluZztcclxuICBASW5wdXQoJ3llYXJzLWJlZm9yZScpIHllYXJzQmVmb3JlOiBudW1iZXI7XHJcbiAgQElucHV0KCd5ZWFycy1hZnRlcicpIHllYXJzQWZ0ZXI6IG51bWJlcjtcclxuICBASW5wdXQoJ3dlZWstc3RhcnQnKSB3ZWVrU3RhcnQ6IDB8MTtcclxuICBASW5wdXQoJ291dHNpZGUnKSBvdXRzaWRlOiBib29sZWFuO1xyXG4gIEBJbnB1dCgncmlwcGxlJykgcmlwcGxlOiBib29sZWFuO1xyXG4gIEBJbnB1dCgncmlwcGxlLWNvbG9yJykgcmlwcGxlQ29sb3I6IHN0cmluZztcclxuICBASW5wdXQoJ2V4Y2x1ZGUnKSBleGNsdWRlOiBtb21lbnQuTW9tZW50W107XHJcbiAgQElucHV0KCdpbmNsdWRlJykgaW5jbHVkZTogbW9tZW50Lk1vbWVudFtdO1xyXG4gIEBJbnB1dCgnbWluLWRhdGUnKSBtaW5EYXRlOiBtb21lbnQuTW9tZW50O1xyXG4gIEBJbnB1dCgnbWF4LWRhdGUnKSBtYXhEYXRlOiBtb21lbnQuTW9tZW50O1xyXG4gIEBJbnB1dCgnc2hvdy1oZWFkZXInKSBzaG93SGVhZGVyOiBib29sZWFuO1xyXG5cclxuICBASW5wdXQoJ2Nscy1waWNrZXInKSBjbHNQaWNrZXI6IHN0cmluZztcclxuICBASW5wdXQoJ2Nscy10b2RheScpIGNsc1RvZGF5OiBzdHJpbmc7XHJcbiAgQElucHV0KCdjbHMtc2VsZWN0ZWQnKSBjbHNTZWxlY3RlZDogc3RyaW5nO1xyXG4gIEBJbnB1dCgnY2xzLWV4Y2x1ZGUnKSBjbHNFeGNsdWRlOiBzdHJpbmc7XHJcbiAgQElucHV0KCdjbHMtY2FsZW5kYXInKSBjbHNDYWxlbmRhcjogc3RyaW5nO1xyXG4gIEBJbnB1dCgnY2xzLWNhbGVuZGFyLWhlYWRlcicpIGNsc0NhbGVuZGFySGVhZGVyOiBzdHJpbmc7XHJcbiAgQElucHV0KCdjbHMtY2FsZW5kYXItY29udGVudCcpIGNsc0NhbGVuZGFyQ29udGVudDogc3RyaW5nO1xyXG4gIEBJbnB1dCgnY2xzLWNhbGVuZGFyLW1vbnRocycpIGNsc0NhbGVuZGFyTW9udGhzOiBzdHJpbmc7XHJcbiAgQElucHV0KCdjbHMtY2FsZW5kYXIteWVhcnMnKSBjbHNDYWxlbmRhclllYXJzOiBzdHJpbmc7XHJcblxyXG4gIEBWaWV3Q2hpbGQoJ2lucHV0JywgeyBzdGF0aWM6IHRydWUgfSkgcHJpdmF0ZSBpbnB1dDogRWxlbWVudFJlZjtcclxuICBwcml2YXRlIGNhbGVuZGFyUGlja2VyOiBhbnk7XHJcbiAgcHJpdmF0ZSBjbG9uZWRFbGVtZW50OiBhbnk7XHJcblxyXG4gIGNyZWF0ZUNvbnRyb2woKSB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2U8dm9pZD4oKGNvbXBsZXRlKSA9PiB7XHJcbiAgICAgIGNvbnN0IG9yaWdpbmFsRWxlbWVudCA9ICQodGhpcy5pbnB1dC5uYXRpdmVFbGVtZW50KTtcclxuICAgICAgT2JqZWN0SGVscGVyLmhpZGUob3JpZ2luYWxFbGVtZW50KTtcclxuXHJcbiAgICAgIGlmICh0aGlzLmNsb25lZEVsZW1lbnQpIHtcclxuICAgICAgICB0aGlzLmNsb25lZEVsZW1lbnQucGFyZW50KCkucmVtb3ZlKCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHRoaXMuY2xvbmVkRWxlbWVudCA9IG9yaWdpbmFsRWxlbWVudC5jbG9uZSgpO1xyXG4gICAgICBPYmplY3RIZWxwZXIuc2hvdyh0aGlzLmNsb25lZEVsZW1lbnQpO1xyXG4gICAgICBvcmlnaW5hbEVsZW1lbnQucGFyZW50KCkuYXBwZW5kKHRoaXMuY2xvbmVkRWxlbWVudCk7XHJcblxyXG4gICAgICB0aGlzLmNhbGVuZGFyUGlja2VyID0gdGhpcy5jbG9uZWRFbGVtZW50LmNhbGVuZGFycGlja2VyKCkuZGF0YSgnY2FsZW5kYXJwaWNrZXInKTtcclxuXHJcbiAgICAgIHRoaXMuY2xvbmVkRWxlbWVudC5vbmUoJ2JsdXInLCAoKSA9PiB7XHJcbiAgICAgICAgdGhpcy50b3VjaENhbGxiYWNrKCk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgdGhpcy5jYWxlbmRhclBpY2tlci5vcHRpb25zLm9uQ2hhbmdlID0gKCkgPT4ge1xyXG4gICAgICAgIGFzYXBTY2hlZHVsZXIuc2NoZWR1bGUoKCkgPT4ge1xyXG4gICAgICAgICAgY29uc3QgdmFsID0gdGhpcy5jYWxlbmRhclBpY2tlci52YWx1ZTtcclxuICAgICAgICAgIHRoaXMuY2hhbmdlVmFsdWUodmFsID8gX21vbWVudCh2YWwudG9Mb2NhbGVEYXRlU3RyaW5nKCdlbicpLCAnTU0vREQvWVlZWScpIDogbnVsbCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH07XHJcblxyXG4gICAgICBjb21wbGV0ZSgpO1xyXG4gICAgfSk7XHJcblxyXG4gIH1cclxuXHJcbiAgZGlzYWJsZShkaXNhYmxlZDogYm9vbGVhbik6IHZvaWQge1xyXG4gICAgYXNhcFNjaGVkdWxlci5zY2hlZHVsZSgoKSA9PiB7XHJcbiAgICAgIGlmIChkaXNhYmxlZCkge1xyXG4gICAgICAgIHRoaXMuY2FsZW5kYXJQaWNrZXIuZGlzYWJsZSgpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMuY2FsZW5kYXJQaWNrZXIuZW5hYmxlKCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgbmV3VmFsdWUoKTogdm9pZCB7XHJcbiAgICBpZiAoIXRoaXMuY2FsZW5kYXJQaWNrZXIpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGFzYXBTY2hlZHVsZXIuc2NoZWR1bGUoKCkgPT4ge1xyXG4gICAgICB0aGlzLmNhbGVuZGFyUGlja2VyLnZhbCh0aGlzLmlubmVyVmFsdWUgPyB0aGlzLmlubmVyVmFsdWUuZm9ybWF0KCdNTS9ERC9ZWVlZJykgOiAnMDEvMDEvMDAwMCcpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBjb252ZXJ0TW9tZW50QXJyYXkoYXJyOiBtb21lbnQuTW9tZW50W10pIHtcclxuICAgIHJldHVybiBhcnIgPyBhcnIubWFwKHYgPT4gdi5mb3JtYXQoJ01NL0REL1lZWVknKSkuam9pbignLCcpIDogbnVsbDtcclxuICB9XHJcblxyXG4gIG5ld0NsYXNzVmFsdWUobmV3Q2xhc3Nlczogc3RyaW5nW10sIG9sZENsYXNzZXM6IHN0cmluZ1tdKSB7XHJcbiAgICBhc2FwU2NoZWR1bGVyLnNjaGVkdWxlKCgpID0+IHtcclxuICAgICAgaWYgKHRoaXMuY2xvbmVkRWxlbWVudCkge1xyXG4gICAgICAgIGNvbnN0IHRhcmdldCA9IHRoaXMuY2xvbmVkRWxlbWVudC5wYXJlbnQoKTtcclxuXHJcbiAgICAgICAgb2xkQ2xhc3Nlcy5mb3JFYWNoKChjbHM6IHN0cmluZykgPT4ge1xyXG4gICAgICAgICAgdGFyZ2V0LnJlbW92ZUNsYXNzKGNscyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIG5ld0NsYXNzZXMuZm9yRWFjaCgoY2xzOiBzdHJpbmcpID0+IHtcclxuICAgICAgICAgIHRhcmdldC5hZGRDbGFzcyhjbHMpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuIl19