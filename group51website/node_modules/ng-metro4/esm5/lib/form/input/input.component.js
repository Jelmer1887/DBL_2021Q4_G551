import { __decorate, __extends, __metadata } from "tslib";
import { ChangeDetectionStrategy, Component, ElementRef, EventEmitter, Input, Output, ViewChild, ViewEncapsulation } from '@angular/core';
import { ControlBase } from '../control-base';
import { DefaultValueAccessor } from '../../helper/default-value-accessor';
import { TypeAlias } from '../../helper/type-alias';
import { asapScheduler } from 'rxjs';
import { ObjectHelper } from '../../helper/object-helper';
var InputComponent = /** @class */ (function (_super) {
    __extends(InputComponent, _super);
    function InputComponent() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.searchButtonClick = new EventEmitter();
        _this.readonly = false;
        _this.placeholder = '';
        _this.type = 'text';
        _this.customButtons = [];
        return _this;
    }
    InputComponent_1 = InputComponent;
    InputComponent.prototype.createControl = function () {
        var _this = this;
        return new Promise(function (complete) {
            var originalElement = $(_this.input.nativeElement);
            ObjectHelper.hide(originalElement);
            if (_this.clonedElement) {
                _this.clonedElement.parent().remove();
            }
            _this.clonedElement = originalElement.clone();
            ObjectHelper.show(_this.clonedElement);
            originalElement.parent().append(_this.clonedElement);
            _this.inputObj = _this.clonedElement.input({
                customButtons: _this.customButtons,
                onSearchButtonClick: function (val) { return _this.searchButtonClick.emit(val); }
            }).data('input');
            _this.clonedElement.one('blur', function () {
                _this.touchCallback();
            });
            _this.clonedElement.on('keydown change', function (event) {
                asapScheduler.schedule(function () {
                    var newValue = _this.clonedElement.val();
                    if (_this.type === 'number') {
                        newValue = +newValue;
                    }
                    _this.changeValue(newValue);
                }, 1);
            });
            complete();
        });
    };
    InputComponent.prototype.disable = function (disabled) {
        if (disabled) {
            this.inputObj.disable();
        }
        else {
            this.inputObj.enable();
        }
    };
    InputComponent.prototype.newValue = function () {
        if (!this.inputObj) {
            return;
        }
        this.clonedElement.val(this.innerValue);
    };
    InputComponent.prototype.newClassValue = function (newClasses, oldClasses) {
        if (this.clonedElement) {
            var target_1 = this.clonedElement.parent();
            oldClasses.forEach(function (cls) {
                target_1.removeClass(cls);
            });
            newClasses.forEach(function (cls) {
                target_1.addClass(cls);
            });
        }
    };
    var InputComponent_1;
    __decorate([
        Output('search-button-click'),
        __metadata("design:type", Object)
    ], InputComponent.prototype, "searchButtonClick", void 0);
    __decorate([
        Input('readonly'),
        __metadata("design:type", Object)
    ], InputComponent.prototype, "readonly", void 0);
    __decorate([
        Input('placeholder'),
        __metadata("design:type", Object)
    ], InputComponent.prototype, "placeholder", void 0);
    __decorate([
        Input('type'),
        __metadata("design:type", String)
    ], InputComponent.prototype, "type", void 0);
    __decorate([
        Input('default-value'),
        __metadata("design:type", Object)
    ], InputComponent.prototype, "defaultValue", void 0);
    __decorate([
        Input('size'),
        __metadata("design:type", Number)
    ], InputComponent.prototype, "size", void 0);
    __decorate([
        Input('prepend'),
        __metadata("design:type", String)
    ], InputComponent.prototype, "prepend", void 0);
    __decorate([
        Input('append'),
        __metadata("design:type", String)
    ], InputComponent.prototype, "append", void 0);
    __decorate([
        Input('clear-button'),
        __metadata("design:type", Boolean)
    ], InputComponent.prototype, "clearButton", void 0);
    __decorate([
        Input('clear-button-icon'),
        __metadata("design:type", String)
    ], InputComponent.prototype, "clearButtonIcon", void 0);
    __decorate([
        Input('reveal-button'),
        __metadata("design:type", Boolean)
    ], InputComponent.prototype, "revealButton", void 0);
    __decorate([
        Input('reveal-button-icon'),
        __metadata("design:type", String)
    ], InputComponent.prototype, "revealButtonIcon", void 0);
    __decorate([
        Input('custom-buttons'),
        __metadata("design:type", Array)
    ], InputComponent.prototype, "customButtons", void 0);
    __decorate([
        Input('search-button'),
        __metadata("design:type", Boolean)
    ], InputComponent.prototype, "searchButton", void 0);
    __decorate([
        Input('search-button-icon'),
        __metadata("design:type", String)
    ], InputComponent.prototype, "searchButtonIcon", void 0);
    __decorate([
        Input('autocomplete'),
        __metadata("design:type", Array)
    ], InputComponent.prototype, "autocomplete", void 0);
    __decorate([
        Input('autocomplete-list-height'),
        __metadata("design:type", Number)
    ], InputComponent.prototype, "autocompleteListHeight", void 0);
    __decorate([
        Input('cls-component'),
        __metadata("design:type", String)
    ], InputComponent.prototype, "clsComponent", void 0);
    __decorate([
        Input('cls-input'),
        __metadata("design:type", String)
    ], InputComponent.prototype, "clsInput", void 0);
    __decorate([
        Input('cls-prepend'),
        __metadata("design:type", String)
    ], InputComponent.prototype, "clsPrepend", void 0);
    __decorate([
        Input('cls-append'),
        __metadata("design:type", String)
    ], InputComponent.prototype, "clsAppend", void 0);
    __decorate([
        Input('cls-clear-button'),
        __metadata("design:type", String)
    ], InputComponent.prototype, "clsClearButton", void 0);
    __decorate([
        Input('cls-reveal-button'),
        __metadata("design:type", String)
    ], InputComponent.prototype, "clsRevealButton", void 0);
    __decorate([
        Input('cls-custom-button'),
        __metadata("design:type", String)
    ], InputComponent.prototype, "clsCustomButton", void 0);
    __decorate([
        ViewChild('input', { static: true }),
        __metadata("design:type", ElementRef)
    ], InputComponent.prototype, "input", void 0);
    InputComponent = InputComponent_1 = __decorate([
        Component({
            selector: 'm4-input',
            template: "<input [type]=\"type\" #input\r\n\r\n       [readonly]=\"readonly\"\r\n       [placeholder]=\"placeholder\"\r\n\r\n       [attr.data-default-value]=\"defaultValue\"\r\n       [attr.data-size]=\"size\"\r\n       [attr.data-prepend]=\"prepend\"\r\n       [attr.data-append]=\"append\"\r\n       [attr.data-clear-button]=\"clearButton\"\r\n       [attr.data-clear-button-icon]=\"clearButtonIcon\"\r\n       [attr.data-reveal-button]=\"revealButton\"\r\n       [attr.data-reveal-button-icon]=\"revealButtonIcon\"\r\n       [attr.data-search-button]=\"searchButton\"\r\n       [attr.data-search-button-icon]=\"searchButtonIcon\"\r\n       data-search-button-click=\"custom\"\r\n       [attr.data-autocomplete]=\"autocomplete?.join(',')\"\r\n       [attr.data-autocomplete-list-height]=\"autocompleteListHeight\"\r\n\r\n       [attr.data-cls-component]=\"clsComponent\"\r\n       [attr.data-cls-input]=\"clsInput\"\r\n       [attr.data-cls-prepend]=\"clsPrepend\"\r\n       [attr.data-cls-append]=\"clsAppend\"\r\n       [attr.data-cls-clear-button]=\"clsClearButton\"\r\n       [attr.data-cls-reveal-button]=\"clsRevealButton\"\r\n       [attr.data-cls-custom-button]=\"clsCustomButton\">\r\n",
            providers: [DefaultValueAccessor.get(InputComponent_1), TypeAlias.get(InputComponent_1)],
            encapsulation: ViewEncapsulation.None,
            changeDetection: ChangeDetectionStrategy.OnPush,
            styles: ["m4-input .autocomplete-list{z-index:1000}"]
        })
    ], InputComponent);
    return InputComponent;
}(ControlBase));
export { InputComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5wdXQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmctbWV0cm80LyIsInNvdXJjZXMiOlsibGliL2Zvcm0vaW5wdXQvaW5wdXQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQ0wsdUJBQXVCLEVBQ3ZCLFNBQVMsRUFDVCxVQUFVLEVBQ1YsWUFBWSxFQUNaLEtBQUssRUFDTCxNQUFNLEVBQUUsU0FBUyxFQUNqQixpQkFBaUIsRUFDbEIsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFDLFdBQVcsRUFBQyxNQUFNLGlCQUFpQixDQUFDO0FBQzVDLE9BQU8sRUFBQyxvQkFBb0IsRUFBQyxNQUFNLHFDQUFxQyxDQUFDO0FBQ3pFLE9BQU8sRUFBQyxTQUFTLEVBQUMsTUFBTSx5QkFBeUIsQ0FBQztBQUNsRCxPQUFPLEVBQUMsYUFBYSxFQUFDLE1BQU0sTUFBTSxDQUFDO0FBQ25DLE9BQU8sRUFBQyxZQUFZLEVBQUMsTUFBTSw0QkFBNEIsQ0FBQztBQWF4RDtJQUFvQyxrQ0FBMEI7SUFBOUQ7UUFBQSxxRUFtR0M7UUFsR2dDLHVCQUFpQixHQUFHLElBQUksWUFBWSxFQUFpQixDQUFDO1FBRWxFLGNBQVEsR0FBRyxLQUFLLENBQUM7UUFDZCxpQkFBVyxHQUFHLEVBQUUsQ0FBQztRQUN4QixVQUFJLEdBQWMsTUFBTSxDQUFDO1FBU2YsbUJBQWEsR0FBcUQsRUFBRSxDQUFDOztJQXFGaEcsQ0FBQzt1QkFuR1ksY0FBYztJQWdDekIsc0NBQWEsR0FBYjtRQUFBLGlCQW9DQztRQW5DQyxPQUFPLElBQUksT0FBTyxDQUFPLFVBQUMsUUFBUTtZQUNoQyxJQUFNLGVBQWUsR0FBRyxDQUFDLENBQUMsS0FBSSxDQUFDLEtBQUssQ0FBQyxhQUFhLENBQUMsQ0FBQztZQUNwRCxZQUFZLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDO1lBRW5DLElBQUksS0FBSSxDQUFDLGFBQWEsRUFBRTtnQkFDdEIsS0FBSSxD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QUFFLFNBQVMsQ0FBQyxHQUFHLENBQUMsZ0JBQWMsQ0FBQyxDQUFDO1lBQ3BGLGFBQWEsRUFBRSxpQkFBaUIsQ0FBQyxJQUFJO1lBQ3JDLGVBQWUsRUFBRSx1QkFBdUIsQ0FBQyxNQUFNOztTQUNoRCxDQUFDO09BQ1csY0FBYyxDQW1HMUI7SUFBRCxxQkFBQztDQUFBLEFBbkdELENBQW9DLFdBQVcsR0FtRzlDO1NBbkdZLGNBQWMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xyXG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxyXG4gIENvbXBvbmVudCxcclxuICBFbGVtZW50UmVmLFxyXG4gIEV2ZW50RW1pdHRlcixcclxuICBJbnB1dCxcclxuICBPdXRwdXQsIFZpZXdDaGlsZCxcclxuICBWaWV3RW5jYXBzdWxhdGlvblxyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQge0NvbnRyb2xCYXNlfSBmcm9tICcuLi9jb250cm9sLWJhc2UnO1xyXG5pbXBvcnQge0RlZmF1bHRWYWx1ZUFjY2Vzc29yfSBmcm9tICcuLi8uLi9oZWxwZXIvZGVmYXVsdC12YWx1ZS1hY2Nlc3Nvcic7XHJcbmltcG9ydCB7VHlwZUFsaWFzfSBmcm9tICcuLi8uLi9oZWxwZXIvdHlwZS1hbGlhcyc7XHJcbmltcG9ydCB7YXNhcFNjaGVkdWxlcn0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7T2JqZWN0SGVscGVyfSBmcm9tICcuLi8uLi9oZWxwZXIvb2JqZWN0LWhlbHBlcic7XHJcbmltcG9ydCB7SW5wdXRUeXBlfSBmcm9tICcuLi8uLi9oZWxwZXIvdHlwZXMnO1xyXG5cclxuZGVjbGFyZSB2YXIgJDogYW55O1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdtNC1pbnB1dCcsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL2lucHV0LmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi9pbnB1dC5jb21wb25lbnQuY3NzJ10sXHJcbiAgcHJvdmlkZXJzOiBbRGVmYXVsdFZhbHVlQWNjZXNzb3IuZ2V0KElucHV0Q29tcG9uZW50KSwgVHlwZUFsaWFzLmdldChJbnB1dENvbXBvbmVudCldLFxyXG4gIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmUsXHJcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2hcclxufSlcclxuZXhwb3J0IGNsYXNzIElucHV0Q29tcG9uZW50IGV4dGVuZHMgQ29udHJvbEJhc2U8c3RyaW5nfG51bWJlcj4ge1xyXG4gIEBPdXRwdXQoJ3NlYXJjaC1idXR0b24tY2xpY2snKSBzZWFyY2hCdXR0b25DbGljayA9IG5ldyBFdmVudEVtaXR0ZXI8c3RyaW5nfG51bWJlcj4oKTtcclxuXHJcbiAgQElucHV0KCdyZWFkb25seScpIHJlYWRvbmx5ID0gZmFsc2U7XHJcbiAgQElucHV0KCdwbGFjZWhvbGRlcicpIHBsYWNlaG9sZGVyID0gJyc7XHJcbiAgQElucHV0KCd0eXBlJykgdHlwZTogSW5wdXRUeXBlID0gJ3RleHQnO1xyXG4gIEBJbnB1dCgnZGVmYXVsdC12YWx1ZScpIGRlZmF1bHRWYWx1ZTogYW55O1xyXG4gIEBJbnB1dCgnc2l6ZScpIHNpemU6IG51bWJlcjtcclxuICBASW5wdXQoJ3ByZXBlbmQnKSBwcmVwZW5kOiBzdHJpbmc7XHJcbiAgQElucHV0KCdhcHBlbmQnKSBhcHBlbmQ6IHN0cmluZztcclxuICBASW5wdXQoJ2NsZWFyLWJ1dHRvbicpIGNsZWFyQnV0dG9uOiBib29sZWFuO1xyXG4gIEBJbnB1dCgnY2xlYXItYnV0dG9uLWljb24nKSBjbGVhckJ1dHRvbkljb246IHN0cmluZztcclxuICBASW5wdXQoJ3JldmVhbC1idXR0b24nKSByZXZlYWxCdXR0b246IGJvb2xlYW47XHJcbiAgQElucHV0KCdyZXZlYWwtYnV0dG9uLWljb24nKSByZXZlYWxCdXR0b25JY29uOiBzdHJpbmc7XHJcbiAgQElucHV0KCdjdXN0b20tYnV0dG9ucycpIGN1c3RvbUJ1dHRvbnM6IHsgaHRtbDogc3RyaW5nLCBjbHM6IHN0cmluZywgb25jbGljazogc3RyaW5nIH1bXSA9IFtdO1xyXG4gIEBJbnB1dCgnc2VhcmNoLWJ1dHRvbicpIHNlYXJjaEJ1dHRvbjogYm9vbGVhbjtcclxuICBASW5wdXQoJ3NlYXJjaC1idXR0b24taWNvbicpIHNlYXJjaEJ1dHRvbkljb246IHN0cmluZztcclxuICBASW5wdXQoJ2F1dG9jb21wbGV0ZScpIGF1dG9jb21wbGV0ZTogc3RyaW5nW107XHJcbiAgQElucHV0KCdhdXRvY29tcGxldGUtbGlzdC1oZWlnaHQnKSBhdXRvY29tcGxldGVMaXN0SGVpZ2h0OiBudW1iZXI7XHJcblxyXG4gIEBJbnB1dCgnY2xzLWNvbXBvbmVudCcpIGNsc0NvbXBvbmVudDogc3RyaW5nO1xyXG4gIEBJbnB1dCgnY2xzLWlucHV0JykgY2xzSW5wdXQ6IHN0cmluZztcclxuICBASW5wdXQoJ2Nscy1wcmVwZW5kJykgY2xzUHJlcGVuZDogc3RyaW5nO1xyXG4gIEBJbnB1dCgnY2xzLWFwcGVuZCcpIGNsc0FwcGVuZDogc3RyaW5nO1xyXG4gIEBJbnB1dCgnY2xzLWNsZWFyLWJ1dHRvbicpIGNsc0NsZWFyQnV0dG9uOiBzdHJpbmc7XHJcbiAgQElucHV0KCdjbHMtcmV2ZWFsLWJ1dHRvbicpIGNsc1JldmVhbEJ1dHRvbjogc3RyaW5nO1xyXG4gIEBJbnB1dCgnY2xzLWN1c3RvbS1idXR0b24nKSBjbHNDdXN0b21CdXR0b246IHN0cmluZztcclxuXHJcbiAgQFZpZXdDaGlsZCgnaW5wdXQnLCB7IHN0YXRpYzogdHJ1ZSB9KSBwcml2YXRlIGlucHV0OiBFbGVtZW50UmVmO1xyXG4gIHByaXZhdGUgaW5wdXRPYmo6IGFueTtcclxuICBwcml2YXRlIGNsb25lZEVsZW1lbnQ6IGFueTtcclxuXHJcbiAgY3JlYXRlQ29udHJvbCgpIHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZTx2b2lkPigoY29tcGxldGUpID0+IHtcclxuICAgICAgY29uc3Qgb3JpZ2luYWxFbGVtZW50ID0gJCh0aGlzLmlucHV0Lm5hdGl2ZUVsZW1lbnQpO1xyXG4gICAgICBPYmplY3RIZWxwZXIuaGlkZShvcmlnaW5hbEVsZW1lbnQpO1xyXG5cclxuICAgICAgaWYgKHRoaXMuY2xvbmVkRWxlbWVudCkge1xyXG4gICAgICAgIHRoaXMuY2xvbmVkRWxlbWVudC5wYXJlbnQoKS5yZW1vdmUoKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgdGhpcy5jbG9uZWRFbGVtZW50ID0gb3JpZ2luYWxFbGVtZW50LmNsb25lKCk7XHJcbiAgICAgIE9iamVjdEhlbHBlci5zaG93KHRoaXMuY2xvbmVkRWxlbWVudCk7XHJcbiAgICAgIG9yaWdpbmFsRWxlbWVudC5wYXJlbnQoKS5hcHBlbmQodGhpcy5jbG9uZWRFbGVtZW50KTtcclxuXHJcbiAgICAgIHRoaXMuaW5wdXRPYmogPSB0aGlzLmNsb25lZEVsZW1lbnQuaW5wdXQoe1xyXG4gICAgICAgIGN1c3RvbUJ1dHRvbnM6IHRoaXMuY3VzdG9tQnV0dG9ucyxcclxuICAgICAgICBvblNlYXJjaEJ1dHRvbkNsaWNrOiAodmFsKSA9PiB0aGlzLnNlYXJjaEJ1dHRvbkNsaWNrLmVtaXQodmFsKVxyXG4gICAgICB9KS5kYXRhKCdpbnB1dCcpO1xyXG5cclxuICAgICAgdGhpcy5jbG9uZWRFbGVtZW50Lm9uZSgnYmx1cicsICgpID0+IHtcclxuICAgICAgICB0aGlzLnRvdWNoQ2FsbGJhY2soKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICB0aGlzLmNsb25lZEVsZW1lbnQub24oJ2tleWRvd24gY2hhbmdlJywgKGV2ZW50KSA9PiB7XHJcbiAgICAgICAgYXNhcFNjaGVkdWxlci5zY2hlZHVsZSgoKSA9PiB7XHJcbiAgICAgICAgICBsZXQgbmV3VmFsdWUgPSB0aGlzLmNsb25lZEVsZW1lbnQudmFsKCk7XHJcblxyXG4gICAgICAgICAgaWYgKHRoaXMudHlwZSA9PT0gJ251bWJlcicpIHtcclxuICAgICAgICAgICAgbmV3VmFsdWUgPSArbmV3VmFsdWU7XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgdGhpcy5jaGFuZ2VWYWx1ZShuZXdWYWx1ZSk7XHJcbiAgICAgICAgfSwgMSk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgY29tcGxldGUoKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZGlzYWJsZShkaXNhYmxlZDogYm9vbGVhbik6IHZvaWQge1xyXG4gICAgaWYgKGRpc2FibGVkKSB7XHJcbiAgICAgIHRoaXMuaW5wdXRPYmouZGlzYWJsZSgpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5pbnB1dE9iai5lbmFibGUoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIG5ld1ZhbHVlKCk6IHZvaWQge1xyXG4gICAgaWYgKCF0aGlzLmlucHV0T2JqKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmNsb25lZEVsZW1lbnQudmFsKHRoaXMuaW5uZXJWYWx1ZSk7XHJcbiAgfVxyXG5cclxuICBuZXdDbGFzc1ZhbHVlKG5ld0NsYXNzZXM6IHN0cmluZ1tdLCBvbGRDbGFzc2VzOiBzdHJpbmdbXSkge1xyXG4gICAgaWYgKHRoaXMuY2xvbmVkRWxlbWVudCkge1xyXG4gICAgICBjb25zdCB0YXJnZXQgPSB0aGlzLmNsb25lZEVsZW1lbnQucGFyZW50KCk7XHJcblxyXG4gICAgICBvbGRDbGFzc2VzLmZvckVhY2goKGNsczogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgdGFyZ2V0LnJlbW92ZUNsYXNzKGNscyk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgbmV3Q2xhc3Nlcy5mb3JFYWNoKChjbHM6IHN0cmluZykgPT4ge1xyXG4gICAgICAgIHRhcmdldC5hZGRDbGFzcyhjbHMpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuIl19