import { __decorate, __extends, __metadata } from "tslib";
import { ChangeDetectionStrategy, ChangeDetectorRef, Component, ContentChildren, ElementRef, forwardRef, Input, QueryList, ViewChildren } from '@angular/core';
import { ControlBase } from '../control-base';
import { DefaultValueAccessor } from '../../helper/default-value-accessor';
import { CheckboxComponent } from '../checkbox/checkbox.component';
import { ArrayHelper } from '../../helper/array-helper';
import { TypeAlias } from '../../helper/type-alias';
import { asapScheduler } from 'rxjs';
var CheckboxGroupComponent = /** @class */ (function (_super) {
    __extends(CheckboxGroupComponent, _super);
    function CheckboxGroupComponent(element, cdRef) {
        var _this = _super.call(this, element, cdRef) || this;
        _this.readonly = false;
        return _this;
    }
    CheckboxGroupComponent_1 = CheckboxGroupComponent;
    CheckboxGroupComponent.prototype.createControl = function () {
        var _this = this;
        return new Promise(function (complete) {
            asapScheduler.schedule(function () {
                _this.checkboxes = !!_this.options ? _this.checkboxesView : _this.checkboxesContent;
                var checkboxCreations = _this.checkboxes.map(function (item) {
                    return new Promise(function (checkboxComplete) {
                        item.updateProperty('readonly', _this.readonly);
                        item.registerOnChange(function (v) {
                            _this.computeInnerValue();
                        });
                        item.registerOnTouched(function () {
                            _this.touchCallback();
                        });
                        asapScheduler.schedule(function () {
                            item.createControl().then(function () {
                                checkboxComplete();
                            });
                        });
                    });
                });
                Promise.all(checkboxCreations).then(function () {
                    _this.callNewValue();
                    complete();
                });
            });
        });
    };
    CheckboxGroupComponent.prototype.computeInnerValue = function () {
        var values = this.checkboxes.filter(function (item) { return item.innerValue === true && item.value; }).map(function (item) { return item.value; });
        this.changeValue(values);
    };
    CheckboxGroupComponent.prototype.disable = function (disabled) {
        this.checkboxes.forEach(function (item) {
            asapScheduler.schedule(function () {
                item.disable(disabled);
            });
        });
    };
    CheckboxGroupComponent.prototype.newValue = function () {
        var _this = this;
        if (!this.checkboxes) {
            return;
        }
        this.checkboxes.forEach(function (item) {
            item.writeValue(_this.innerValue && ArrayHelper.contains(_this.innerValue, item.value));
        });
    };
    CheckboxGroupComponent.prototype.newClassValue = function (newClasses, oldClasses) {
        this.checkboxes.forEach(function (item) {
            asapScheduler.schedule(function () {
                item.newClassValue(newClasses, oldClasses);
            }, 1);
        });
    };
    var CheckboxGroupComponent_1;
    CheckboxGroupComponent.ctorParameters = function () { return [
        { type: ElementRef },
        { type: ChangeDetectorRef }
    ]; };
    __decorate([
        Input(),
        __metadata("design:type", Object)
    ], CheckboxGroupComponent.prototype, "readonly", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Object)
    ], CheckboxGroupComponent.prototype, "options", void 0);
    __decorate([
        ContentChildren(forwardRef(function () { return CheckboxComponent; }), { descendants: true }),
        __metadata("design:type", QueryList)
    ], CheckboxGroupComponent.prototype, "checkboxesContent", void 0);
    __decorate([
        ViewChildren(forwardRef(function () { return CheckboxComponent; })),
        __metadata("design:type", QueryList)
    ], CheckboxGroupComponent.prototype, "checkboxesView", void 0);
    CheckboxGroupComponent = CheckboxGroupComponent_1 = __decorate([
        Component({
            selector: 'm4-checkbox-group',
            template: "<ng-container *ngIf=\"options; else noOptions\">\r\n  <m4-checkbox *ngFor=\"let option of options | objectKeys\" [value]=\"options[option]\" [caption]=\"option\"></m4-checkbox>\r\n</ng-container>\r\n<ng-template #noOptions>\r\n  <ng-content></ng-content>\r\n</ng-template>\r\n",
            providers: [DefaultValueAccessor.get(CheckboxGroupComponent_1), TypeAlias.get(CheckboxGroupComponent_1)],
            changeDetection: ChangeDetectionStrategy.OnPush,
            styles: [""]
        }),
        __metadata("design:paramtypes", [ElementRef, ChangeDetectorRef])
    ], CheckboxGroupComponent);
    return CheckboxGroupComponent;
}(ControlBase));
export { CheckboxGroupComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hlY2tib3gtZ3JvdXAuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmctbWV0cm80LyIsInNvdXJjZXMiOlsibGliL2Zvcm0vY2hlY2tib3gtZ3JvdXAvY2hlY2tib3gtZ3JvdXAuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQ0wsdUJBQXVCLEVBQ3ZCLGlCQUFpQixFQUNqQixTQUFTLEVBQ1QsZUFBZSxFQUNmLFVBQVUsRUFDVixVQUFVLEVBQ1YsS0FBSyxFQUNMLFNBQVMsRUFBRSxZQUFZLEVBQ3hCLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBQyxXQUFXLEVBQUMsTUFBTSxpQkFBaUIsQ0FBQztBQUM1QyxPQUFPLEVBQUMsb0JBQW9CLEVBQUMsTUFBTSxxQ0FBcUMsQ0FBQztBQUN6RSxPQUFPLEVBQUMsaUJBQWlCLEVBQUMsTUFBTSxnQ0FBZ0MsQ0FBQztBQUNqRSxPQUFPLEVBQUMsV0FBVyxFQUFDLE1BQU0sMkJBQTJCLENBQUM7QUFDdEQsT0FBTyxFQUFDLFNBQVMsRUFBQyxNQUFNLHlCQUF5QixDQUFDO0FBQ2xELE9BQU8sRUFBQyxhQUFhLEVBQUMsTUFBTSxNQUFNLENBQUM7QUFTbkM7SUFBNEMsMENBQWtCO0lBVTVELGdDQUFZLE9BQW1CLEVBQUUsS0FBd0I7UUFBekQsWUFDRSxrQkFBTSxPQUFPLEVBQUUsS0FBSyxDQUFDLFNBQ3RCO1FBVlEsY0FBUSxHQUFHLEtBQUssQ0FBQzs7SUFVMUIsQ0FBQzsrQkFaVSxzQkFBc0I7SUFjakMsOENBQWEsR0FBYjtRQUFBLGlCQWdDQztRQS9CQyxPQUFPLElBQUksT0FBTyxDQUFPLFVBQUMsUUFBUTtZQUNoQyxhQUFhLENBQUMsUUFBUSxDQUFDO2dCQUNyQixLQUFJLENBQUMsVUFBVSxHQUFHLENBQUMsQ0FBQyxLQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxLQUFJLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQyxLQUFJLENBQUMsaUJB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QUFqQixDQUFpQixDQUFDLEVBQUUsRUFBRSxXQUFXLEVBQUUsSUFBSSxFQUFFLENBQUM7a0NBQW9CLFNBQVM7cUVBQW9CO0lBQzFFO1FBQWxELFlBQVksQ0FBQyxVQUFVLENBQUMsY0FBTSxPQUFBLGlCQUFpQixFQUFqQixDQUFpQixDQUFDLENBQUM7a0NBQWlCLFNBQVM7a0VBQW9CO0lBTnJGLHNCQUFzQjtRQVBsQyxTQUFTLENBQUM7WUFDVCxRQUFRLEVBQUUsbUJBQW1CO1lBQzdCLGdTQUE4QztZQUU5QyxTQUFTLEVBQUUsQ0FBQyxvQkFBb0IsQ0FBQyxHQUFHLENBQUMsd0JBQXNCLENBQUMsRUFBRSxTQUFTLENBQUMsR0FBRyxDQUFDLHdCQUFzQixDQUFDLENBQUM7WUFDcEcsZUFBZSxFQUFFLHVCQUF1QixDQUFDLE1BQU07O1NBQ2hELENBQUM7eUNBV3FCLFVBQVUsRUFBUyxpQkFBaUI7T0FWOUMsc0JBQXNCLENBOEVsQztJQUFELDZCQUFDO0NBQUEsQUE5RUQsQ0FBNEMsV0FBVyxHQThFdEQ7U0E5RVksc0JBQXNCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcclxuICBDaGFuZ2VEZXRlY3RvclJlZixcclxuICBDb21wb25lbnQsXHJcbiAgQ29udGVudENoaWxkcmVuLFxyXG4gIEVsZW1lbnRSZWYsXHJcbiAgZm9yd2FyZFJlZixcclxuICBJbnB1dCxcclxuICBRdWVyeUxpc3QsIFZpZXdDaGlsZHJlblxyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQge0NvbnRyb2xCYXNlfSBmcm9tICcuLi9jb250cm9sLWJhc2UnO1xyXG5pbXBvcnQge0RlZmF1bHRWYWx1ZUFjY2Vzc29yfSBmcm9tICcuLi8uLi9oZWxwZXIvZGVmYXVsdC12YWx1ZS1hY2Nlc3Nvcic7XHJcbmltcG9ydCB7Q2hlY2tib3hDb21wb25lbnR9IGZyb20gJy4uL2NoZWNrYm94L2NoZWNrYm94LmNvbXBvbmVudCc7XHJcbmltcG9ydCB7QXJyYXlIZWxwZXJ9IGZyb20gJy4uLy4uL2hlbHBlci9hcnJheS1oZWxwZXInO1xyXG5pbXBvcnQge1R5cGVBbGlhc30gZnJvbSAnLi4vLi4vaGVscGVyL3R5cGUtYWxpYXMnO1xyXG5pbXBvcnQge2FzYXBTY2hlZHVsZXJ9IGZyb20gJ3J4anMnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdtNC1jaGVja2JveC1ncm91cCcsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL2NoZWNrYm94LWdyb3VwLmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi9jaGVja2JveC1ncm91cC5jb21wb25lbnQuY3NzJ10sXHJcbiAgcHJvdmlkZXJzOiBbRGVmYXVsdFZhbHVlQWNjZXNzb3IuZ2V0KENoZWNrYm94R3JvdXBDb21wb25lbnQpLCBUeXBlQWxpYXMuZ2V0KENoZWNrYm94R3JvdXBDb21wb25lbnQpXSxcclxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaFxyXG59KVxyXG5leHBvcnQgY2xhc3MgQ2hlY2tib3hHcm91cENvbXBvbmVudCBleHRlbmRzIENvbnRyb2xCYXNlPGFueVtdPiB7XHJcblxyXG4gIEBJbnB1dCgpIHJlYWRvbmx5ID0gZmFsc2U7XHJcbiAgQElucHV0KCkgb3B0aW9uczogeyBbdGl0bGU6IHN0cmluZ106IGFueSB9O1xyXG5cclxuICBAQ29udGVudENoaWxkcmVuKGZvcndhcmRSZWYoKCkgPT4gQ2hlY2tib3hDb21wb25lbnQpLCB7IGRlc2NlbmRhbnRzOiB0cnVlIH0pIGNoZWNrYm94ZXNDb250ZW50OiBRdWVyeUxpc3Q8Q2hlY2tib3hDb21wb25lbnQ+O1xyXG4gIEBWaWV3Q2hpbGRyZW4oZm9yd2FyZFJlZigoKSA9PiBDaGVja2JveENvbXBvbmVudCkpIGNoZWNrYm94ZXNWaWV3OiBRdWVyeUxpc3Q8Q2hlY2tib3hDb21wb25lbnQ+O1xyXG5cclxuICBwcml2YXRlIGNoZWNrYm94ZXM6IFF1ZXJ5TGlzdDxDaGVja2JveENvbXBvbmVudD47XHJcblxyXG4gIGNvbnN0cnVjdG9yKGVsZW1lbnQ6IEVsZW1lbnRSZWYsIGNkUmVmOiBDaGFuZ2VEZXRlY3RvclJlZikge1xyXG4gICAgc3VwZXIoZWxlbWVudCwgY2RSZWYpO1xyXG4gIH1cclxuXHJcbiAgY3JlYXRlQ29udHJvbCgpIHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZTx2b2lkPigoY29tcGxldGUpID0+IHtcclxuICAgICAgYXNhcFNjaGVkdWxlci5zY2hlZHVsZSgoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5jaGVja2JveGVzID0gISF0aGlzLm9wdGlvbnMgPyB0aGlzLmNoZWNrYm94ZXNWaWV3IDogdGhpcy5jaGVja2JveGVzQ29udGVudDtcclxuXHJcbiAgICAgICAgY29uc3QgY2hlY2tib3hDcmVhdGlvbnMgPSB0aGlzLmNoZWNrYm94ZXMubWFwKChpdGVtKSA9PiB7XHJcbiAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2U8dm9pZD4oKGNoZWNrYm94Q29tcGxldGUpID0+IHtcclxuICAgICAgICAgICAgaXRlbS51cGRhdGVQcm9wZXJ0eSgncmVhZG9ubHknLCB0aGlzLnJlYWRvbmx5KTtcclxuXHJcbiAgICAgICAgICAgIGl0ZW0ucmVnaXN0ZXJPbkNoYW5nZSgodikgPT4ge1xyXG4gICAgICAgICAgICAgIHRoaXMuY29tcHV0ZUlubmVyVmFsdWUoKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBpdGVtLnJlZ2lzdGVyT25Ub3VjaGVkKCgpID0+IHtcclxuICAgICAgICAgICAgICB0aGlzLnRvdWNoQ2FsbGJhY2soKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBhc2FwU2NoZWR1bGVyLnNjaGVkdWxlKCgpID0+IHtcclxuICAgICAgICAgICAgICBpdGVtLmNyZWF0ZUNvbnRyb2woKS50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIGNoZWNrYm94Q29tcGxldGUoKTtcclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgUHJvbWlzZS5hbGwoY2hlY2tib3hDcmVhdGlvbnMpLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgdGhpcy5jYWxsTmV3VmFsdWUoKTtcclxuICAgICAgICAgIGNvbXBsZXRlKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBjb21wdXRlSW5uZXJWYWx1ZSgpIHtcclxuICAgIGNvbnN0IHZhbHVlcyA9IHRoaXMuY2hlY2tib3hlcy5maWx0ZXIoaXRlbSA9PiBpdGVtLmlubmVyVmFsdWUgPT09IHRydWUgJiYgaXRlbS52YWx1ZSkubWFwKGl0ZW0gPT4gaXRlbS52YWx1ZSk7XHJcbiAgICB0aGlzLmNoYW5nZVZhbHVlKHZhbHVlcyk7XHJcbiAgfVxyXG5cclxuICBkaXNhYmxlKGRpc2FibGVkOiBib29sZWFuKTogdm9pZCB7XHJcbiAgICB0aGlzLmNoZWNrYm94ZXMuZm9yRWFjaCgoaXRlbSkgPT4ge1xyXG4gICAgICBhc2FwU2NoZWR1bGVyLnNjaGVkdWxlKCgpID0+IHtcclxuICAgICAgICBpdGVtLmRpc2FibGUoZGlzYWJsZWQpO1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgbmV3VmFsdWUoKTogdm9pZCB7XHJcbiAgICBpZiAoIXRoaXMuY2hlY2tib3hlcykge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5jaGVja2JveGVzLmZvckVhY2goKGl0ZW0pID0+IHtcclxuICAgICAgaXRlbS53cml0ZVZhbHVlKHRoaXMuaW5uZXJWYWx1ZSAmJiBBcnJheUhlbHBlci5jb250YWlucyh0aGlzLmlubmVyVmFsdWUsIGl0ZW0udmFsdWUpKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgbmV3Q2xhc3NWYWx1ZShuZXdDbGFzc2VzOiBzdHJpbmdbXSwgb2xkQ2xhc3Nlczogc3RyaW5nW10pIHtcclxuICAgIHRoaXMuY2hlY2tib3hlcy5mb3JFYWNoKChpdGVtKSA9PiB7XHJcbiAgICAgIGFzYXBTY2hlZHVsZXIuc2NoZWR1bGUoKCkgPT4ge1xyXG4gICAgICAgIGl0ZW0ubmV3Q2xhc3NWYWx1ZShuZXdDbGFzc2VzLCBvbGRDbGFzc2VzKTtcclxuICAgICAgfSwgMSk7XHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuIl19