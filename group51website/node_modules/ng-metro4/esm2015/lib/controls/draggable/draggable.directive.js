import { __decorate, __metadata } from "tslib";
import { Directive, ElementRef, EventEmitter, Input, OnChanges, OnDestroy, OnInit, Output, Renderer2, SimpleChanges } from '@angular/core';
import { asapScheduler } from 'rxjs';
let DraggableDirective = class DraggableDirective {
    constructor(element, renderer) {
        this.element = element;
        this.renderer = renderer;
        this.dragStart = new EventEmitter();
        this.dragStop = new EventEmitter();
        this.dragMove = new EventEmitter();
    }
    createElement() {
        asapScheduler.schedule(() => {
            if (this.draggableData) {
                if (this.dragArea) {
                    this.draggableData.elem.remove();
                }
                this.draggableData.destroy();
            }
            const draggableOptions = {
                onDragStart: (position) => {
                    this.dragStart.emit(position);
                },
                onDragStop: (position) => {
                    this.dragStop.emit(position);
                },
                onDragMove: (position) => {
                    this.dragMove.emit(position);
                }
            };
            if (this.dragElement) {
                draggableOptions.dragElement = this.dragElement;
            }
            if (this.dragArea) {
                draggableOptions.dragArea = this.dragArea;
            }
            this.draggableData = $(this.element.nativeElement).draggable(draggableOptions).data('draggable');
        });
    }
    setPosition(position) {
        if (this.draggableData) {
            $(this.draggableData.elem).css({
                left: position.x + 'px',
                top: position.y + 'px'
            });
        }
    }
    ngOnInit() {
        this.createElement();
    }
    ngOnChanges(changes) {
        this.createElement();
    }
    ngOnDestroy() {
        $(this.element.nativeElement).remove();
    }
};
DraggableDirective.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 }
];
__decorate([
    Input('m4-draggable'),
    __metadata("design:type", String)
], DraggableDirective.prototype, "dragElement", void 0);
__decorate([
    Input('drag-area'),
    __metadata("design:type", String)
], DraggableDirective.prototype, "dragArea", void 0);
__decorate([
    Output(),
    __metadata("design:type", Object)
], DraggableDirective.prototype, "dragStart", void 0);
__decorate([
    Output(),
    __metadata("design:type", Object)
], DraggableDirective.prototype, "dragStop", void 0);
__decorate([
    Output(),
    __metadata("design:type", Object)
], DraggableDirective.prototype, "dragMove", void 0);
DraggableDirective = __decorate([
    Directive({
        selector: '[m4-draggable]'
    }),
    __metadata("design:paramtypes", [ElementRef, Renderer2])
], DraggableDirective);
export { DraggableDirective };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJhZ2dhYmxlLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25nLW1ldHJvNC8iLCJzb3VyY2VzIjpbImxpYi9jb250cm9scy9kcmFnZ2FibGUvZHJhZ2dhYmxlLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFDLFNBQVMsRUFBRSxVQUFVLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLGFBQWEsRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUN6SSxPQUFPLEVBQUMsYUFBYSxFQUFDLE1BQU0sTUFBTSxDQUFDO0FBWW5DLElBQWEsa0JBQWtCLEdBQS9CLE1BQWEsa0JBQWtCO0lBVTdCLFlBQW9CLE9BQW1CLEVBQVUsUUFBbUI7UUFBaEQsWUFBTyxHQUFQLE9BQU8sQ0FBWTtRQUFVLGFBQVEsR0FBUixRQUFRLENBQVc7UUFOMUQsY0FBUyxHQUFHLElBQUksWUFBWSxFQUFnQixDQUFDO1FBQzdDLGFBQVEsR0FBRyxJQUFJLFlBQVksRUFBZ0IsQ0FBQztRQUM1QyxhQUFRLEdBQUcsSUFBSSxZQUFZLEVBQWdCLENBQUM7SUFJaUIsQ0FBQztJQUVoRSxhQUFhO1FBQ25CLGFBQWEsQ0FBQyxRQUFRLENBQUMsR0FBRyxFQUFFO1lBQzFCLElBQUksSUFBSSxDQUFDLGFBQWEsRUFBRTtnQkFDdEIsSUFBSSxJQUFJLENBQUMsUUFBUSxFQUFFO29CQUNqQixJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztpQkFDbEM7Z0JBRUQsSUFBSSxDQUFDLGFBQWEsQ0FBQyxPQUFPLEVBQUUsQ0FBQzthQUM5QjtZQUVELE1BQU0sZ0JBQWdCLEdBQVE7Z0JBQzVCLFdBQVcsRUFBRSxDQUFDLFFBQXNCLEVBQUUsRUFBRTtvQkFDdEMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7Z0JBQ2hDLENBQUM7Z0JBQ0QsVUFBVSxFQUFFLENBQUMsUUFBc0IsRUFBRSxFQUFFO29CQUNyQyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztnQkFDL0IsQ0FBQztnQkFDRCxVQUFVLEVBQUUsQ0FBQyxRQUFzQixFQUFFLEVBQUU7b0JBQ3JDLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO2dCQUMvQixDQUFDO2FBQ0YsQ0FBQztZQUVGLElBQUksSUFBSSxDQUFDLFdBQVcsRUFBRTtnQkFDcEIsZ0JBQWdCLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUM7YUFDakQ7WUFFRCxJQUFJLElBQUksQ0FBQyxRQUFRLEVBQUU7Z0JBQ2pCLGdCQUFnQixDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDO2FBQzNDO1lBRUQsSUFBSSxDQUFDLGFBQWEsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUMsQ0FBQyxTQUFTLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDbkcsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRU0sV0FBVyxDQUFDLFFBQXNCO1FBQ3ZDLElBQUksSUFBSSxDQUFDLGFBQWEsRUFBRTtZQUN0QixDQUFDLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUM7Z0JBQzdCLElBQUksRUFBRSxRQUFRLENBQUMsQ0FBQyxHQUFHLElBQUk7Z0JBQ3ZCLEdBQUcsRUFBRSxRQUFRLENBQUMsQ0FBQyxHQUFHLElBQUk7YUFDdkIsQ0FBQyxDQUFDO1NBQ0o7SUFDSCxDQUFDO0lBRUQsUUFBUTtRQUNOLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUN2QixDQUFDO0lBRUQsV0FBVyxDQUFDLE9BQXNCO1FBQ2hDLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUN2QixDQUFDO0lBRUQsV0FBVztRQUNULENBQUMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDO0lBQ3pDLENBQUM7Q0FDRixDQUFBOztZQXhEOEIsVUFBVTtZQUFvQixTQUFTOztBQVQ3QztJQUF0QixLQUFLLENBQUMsY0FBYyxDQUFDOzt1REFBcUI7QUFDdkI7SUFBbkIsS0FBSyxDQUFDLFdBQVcsQ0FBQzs7b0RBQWtCO0FBRTNCO0lBQVQsTUFBTSxFQUFFOztxREFBOEM7QUFDN0M7SUFBVCxNQUFNLEVBQUU7O29EQUE2QztBQUM1QztJQUFULE1BQU0sRUFBRTs7b0RBQTZDO0FBTjNDLGtCQUFrQjtJQUg5QixTQUFTLENBQUM7UUFDVCxRQUFRLEVBQUUsZ0JBQWdCO0tBQzNCLENBQUM7cUNBVzZCLFVBQVUsRUFBb0IsU0FBUztHQVZ6RCxrQkFBa0IsQ0FrRTlCO1NBbEVZLGtCQUFrQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7RGlyZWN0aXZlLCBFbGVtZW50UmVmLCBFdmVudEVtaXR0ZXIsIElucHV0LCBPbkNoYW5nZXMsIE9uRGVzdHJveSwgT25Jbml0LCBPdXRwdXQsIFJlbmRlcmVyMiwgU2ltcGxlQ2hhbmdlc30gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7YXNhcFNjaGVkdWxlcn0gZnJvbSAncnhqcyc7XHJcblxyXG5kZWNsYXJlIHZhciAkOiBhbnk7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIERyYWdQb3NpdGlvbiB7XHJcbiAgeDogbnVtYmVyO1xyXG4gIHk6IG51bWJlcjtcclxufVxyXG5cclxuQERpcmVjdGl2ZSh7XHJcbiAgc2VsZWN0b3I6ICdbbTQtZHJhZ2dhYmxlXSdcclxufSlcclxuZXhwb3J0IGNsYXNzIERyYWdnYWJsZURpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzLCBPbkRlc3Ryb3kge1xyXG4gIEBJbnB1dCgnbTQtZHJhZ2dhYmxlJykgZHJhZ0VsZW1lbnQ6IHN0cmluZztcclxuICBASW5wdXQoJ2RyYWctYXJlYScpIGRyYWdBcmVhOiBzdHJpbmc7XHJcblxyXG4gIEBPdXRwdXQoKSBkcmFnU3RhcnQgPSBuZXcgRXZlbnRFbWl0dGVyPERyYWdQb3NpdGlvbj4oKTtcclxuICBAT3V0cHV0KCkgZHJhZ1N0b3AgPSBuZXcgRXZlbnRFbWl0dGVyPERyYWdQb3NpdGlvbj4oKTtcclxuICBAT3V0cHV0KCkgZHJhZ01vdmUgPSBuZXcgRXZlbnRFbWl0dGVyPERyYWdQb3NpdGlvbj4oKTtcclxuXHJcbiAgcHJpdmF0ZSBkcmFnZ2FibGVEYXRhO1xyXG5cclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGVsZW1lbnQ6IEVsZW1lbnRSZWYsIHByaXZhdGUgcmVuZGVyZXI6IFJlbmRlcmVyMikge31cclxuXHJcbiAgcHJpdmF0ZSBjcmVhdGVFbGVtZW50KCkge1xyXG4gICAgYXNhcFNjaGVkdWxlci5zY2hlZHVsZSgoKSA9PiB7XHJcbiAgICAgIGlmICh0aGlzLmRyYWdnYWJsZURhdGEpIHtcclxuICAgICAgICBpZiAodGhpcy5kcmFnQXJlYSkge1xyXG4gICAgICAgICAgdGhpcy5kcmFnZ2FibGVEYXRhLmVsZW0ucmVtb3ZlKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmRyYWdnYWJsZURhdGEuZGVzdHJveSgpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCBkcmFnZ2FibGVPcHRpb25zOiBhbnkgPSB7XHJcbiAgICAgICAgb25EcmFnU3RhcnQ6IChwb3NpdGlvbjogRHJhZ1Bvc2l0aW9uKSA9PiB7XHJcbiAgICAgICAgICB0aGlzLmRyYWdTdGFydC5lbWl0KHBvc2l0aW9uKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIG9uRHJhZ1N0b3A6IChwb3NpdGlvbjogRHJhZ1Bvc2l0aW9uKSA9PiB7XHJcbiAgICAgICAgICB0aGlzLmRyYWdTdG9wLmVtaXQocG9zaXRpb24pO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgb25EcmFnTW92ZTogKHBvc2l0aW9uOiBEcmFnUG9zaXRpb24pID0+IHtcclxuICAgICAgICAgIHRoaXMuZHJhZ01vdmUuZW1pdChwb3NpdGlvbik7XHJcbiAgICAgICAgfVxyXG4gICAgICB9O1xyXG5cclxuICAgICAgaWYgKHRoaXMuZHJhZ0VsZW1lbnQpIHtcclxuICAgICAgICBkcmFnZ2FibGVPcHRpb25zLmRyYWdFbGVtZW50ID0gdGhpcy5kcmFnRWxlbWVudDtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKHRoaXMuZHJhZ0FyZWEpIHtcclxuICAgICAgICBkcmFnZ2FibGVPcHRpb25zLmRyYWdBcmVhID0gdGhpcy5kcmFnQXJlYTtcclxuICAgICAgfVxyXG5cclxuICAgICAgdGhpcy5kcmFnZ2FibGVEYXRhID0gJCh0aGlzLmVsZW1lbnQubmF0aXZlRWxlbWVudCkuZHJhZ2dhYmxlKGRyYWdnYWJsZU9wdGlvbnMpLmRhdGEoJ2RyYWdnYWJsZScpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc2V0UG9zaXRpb24ocG9zaXRpb246IERyYWdQb3NpdGlvbikge1xyXG4gICAgaWYgKHRoaXMuZHJhZ2dhYmxlRGF0YSkge1xyXG4gICAgICAkKHRoaXMuZHJhZ2dhYmxlRGF0YS5lbGVtKS5jc3Moe1xyXG4gICAgICAgIGxlZnQ6IHBvc2l0aW9uLnggKyAncHgnLFxyXG4gICAgICAgIHRvcDogcG9zaXRpb24ueSArICdweCdcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgIHRoaXMuY3JlYXRlRWxlbWVudCgpO1xyXG4gIH1cclxuXHJcbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xyXG4gICAgdGhpcy5jcmVhdGVFbGVtZW50KCk7XHJcbiAgfVxyXG5cclxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcclxuICAgICQodGhpcy5lbGVtZW50Lm5hdGl2ZUVsZW1lbnQpLnJlbW92ZSgpO1xyXG4gIH1cclxufVxyXG4iXX0=