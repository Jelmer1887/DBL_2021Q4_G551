import { __decorate, __metadata } from "tslib";
import { ApplicationRef, ComponentFactoryResolver, ComponentRef, EmbeddedViewRef, Injectable, Injector } from '@angular/core';
import { Subject } from 'rxjs';
import { finalize, startWith } from 'rxjs/operators';
import { FormBuilderComponent } from '../../form/form-builder/form-builder.component';
let DialogService = class DialogService {
    constructor(componentFactoryResolver, appRef, injector) {
        this.componentFactoryResolver = componentFactoryResolver;
        this.appRef = appRef;
        this.injector = injector;
    }
    /**
     * Create a custom dialog
     * @param options The options of the dialog
     */
    create(options) {
        return window.Metro.dialog.create(options);
    }
    /**
     * Close a created dialog
     * @param dialogObj The object returned by the create method
     */
    close(dialogObj) {
        return window.Metro.dialog.close(dialogObj);
    }
    /**
     * Shows an alert dialog
     * @param title The title of the dialog
     * @param message The message of the dialog
     * @param cls Optional css classes
     * @param okBtnText The text of the OK-Button
     * @param okBtnCls An optional css class for the OK-Button
     */
    alert(title, message, cls, okBtnText, okBtnCls) {
        const subject$ = new Subject();
        const options = {
            title: title,
            content: message,
            clsDialog: cls,
            overlayClickClose: true
        };
        if (okBtnText) {
            options.actions = [{
                    caption: okBtnText,
                    cls: (okBtnCls ? okBtnCls : '') + ' js-dialog-close',
                    onclick: () => {
                        subject$.next();
                        subject$.complete();
                    }
                }];
        }
        const alertObj = this.create(options);
        return subject$.asObservable().pipe(finalize(() => {
            this.close(alertObj);
        }));
    }
    /**
     * Shows a confirm dialog
     * @param title The title of the confirm
     * @param message The message of the confirm
     * @param yesBtnText The text for the Yes-Button
     * @param noBtnText The text for the No-Button
     * @param cls An optional css class for the dialog
     * @param yesBtnCls An optional css class for the Yes-Button
     * @param noBtnCls An optional css class for the No-Button
     */
    confirm(title, message, yesBtnText, noBtnText, cls, yesBtnCls, noBtnCls) {
        const subject$ = new Subject();
        const options = {
            title: title,
            content: message,
            actions: [
                {
                    caption: yesBtnText ? yesBtnText : 'Yes',
                    cls: (yesBtnCls ? yesBtnCls : 'success') + ' js-dialog-close',
                    onclick: () => {
                        subject$.next(true);
                        subject$.complete();
                    }
                },
                {
                    caption: noBtnText ? noBtnText : 'No',
                    cls: (noBtnCls ? noBtnCls : 'alert') + ' js-dialog-close',
                    onclick: () => {
                        subject$.next(false);
                        subject$.complete();
                    }
                }
            ],
            clsDialog: cls
        };
        const confirmObj = this.create(options);
        return subject$.asObservable().pipe(finalize(() => {
            this.close(confirmObj);
        }));
    }
    /**
     * Show a prompt dialog
     * @param title The title of the prompt
     * @param message The message of the prompt
     * @param submitBtnText The text of the Submit-Button
     * @param placeholder The placeholder of the input
     * @param cls An optional css class for the dialog
     * @param submitBtnCls An optional css class for Submit-Button
     * @param inputCls An optional css class for the input
     */
    prompt(title, message, submitBtnText, placeholder, cls, submitBtnCls, inputCls) {
        const subject$ = new Subject();
        const options = {
            title: title,
            content: (message ? message : '') +
                `<br><input data-role="input" type="text" class="${inputCls}" placeholder="${placeholder ? placeholder : ''}" />`,
            actions: [
                {
                    caption: submitBtnText ? submitBtnText : 'Submit',
                    cls: (submitBtnCls ? submitBtnCls : 'success') + ' js-dialog-close',
                    onclick: () => {
                        subject$.next(value);
                        subject$.complete();
                    }
                }
            ],
            clsDialog: cls
        };
        const promptObj = this.create(options);
        const input = promptObj.find('input');
        let value = '';
        input.on('change', () => {
            value = input.val();
        });
        return subject$.asObservable().pipe(finalize(() => {
            this.close(promptObj);
        }));
    }
    /**
     * Show a prompt dialog that contains a form
     * @param title The title of the prompt
     * @param form The form group
     * @param submitBtnText The text of the Submit-Button
     * @param abortBtnText The text of the Abort-Button
     * @param placeholder The placeholder of the input
     * @param cls An optional css class for the dialog
     * @param submitBtnCls An optional css class for Submit-Button
     * @param abortBtnCls An optional css class for Abort-Button
     */
    formPrompt(title, form, submitBtnText, abortBtnText, placeholder, cls, submitBtnCls, abortBtnCls) {
        const componentRef = this.componentFactoryResolver.resolveComponentFactory(FormBuilderComponent).create(this.injector);
        componentRef.instance.formGroup = form;
        this.appRef.attachView(componentRef.hostView);
        const domElement = componentRef.hostView.rootNodes[0];
        const subject$ = new Subject();
        const options = {
            title: title,
            content: 'content',
            actions: [
                {
                    caption: abortBtnText ? abortBtnText : 'Abort',
                    cls: abortBtnCls ? abortBtnCls : 'warning',
                    onclick: () => {
                        subject$.next(null);
                        subject$.complete();
                    }
                },
                {
                    caption: submitBtnText ? submitBtnText : 'Submit',
                    cls: (submitBtnCls ? submitBtnCls : 'success') + ' submit-btn',
                    onclick: () => {
                        subject$.next(form.value);
                        subject$.complete();
                    }
                }
            ],
            clsDialog: cls
        };
        const promptObj = this.create(options);
        promptObj.find('.dialog-content').empty().append(domElement);
        const formStateSubscription = form.statusChanges.pipe(startWith(form.status)).subscribe((valid) => {
            const submitBtn = promptObj.find('.dialog-actions button.submit-btn');
            if (valid === 'VALID') {
                submitBtn.removeAttr('disabled');
            }
            else {
                submitBtn.attr('disabled', 'disabled');
            }
        });
        return subject$.asObservable().pipe(finalize(() => {
            this.close(promptObj);
            componentRef.destroy();
            formStateSubscription.unsubscribe();
        }));
    }
    /**
     * Show a dialog that contains a component
     * @param component The component class to render
     * @param dialogData Data to pass to the new component instance
     * @param title The title of the dialog
     * @param closeBtnText Custom text for the close button
     * @param cls Custom dialog class (accent, size etc.)
     * @param closeBtnCls Custom close button class
     */
    show(component, dialogData, title, closeBtnText, cls, closeBtnCls) {
        const componentRef = this.componentFactoryResolver.resolveComponentFactory(component).create(this.injector);
        if (!!dialogData) {
            componentRef.instance.dialogDataInput = dialogData;
        }
        this.appRef.attachView(componentRef.hostView);
        const domElement = componentRef.hostView.rootNodes[0];
        const subject$ = new Subject();
        let dialogDataSubscription;
        if (!!componentRef.instance.dialogDataEmitter) {
            dialogDataSubscription = componentRef.instance.dialogDataEmitter
                .pipe(finalize(() => {
                subject$.complete();
            })).subscribe((data) => {
                subject$.next(data);
            });
        }
        const options = {
            title: title,
            content: $(domElement),
            actions: [
                {
                    caption: closeBtnText ? closeBtnText : 'Submit',
                    cls: (closeBtnCls ? closeBtnCls : 'success') + ' submit-btn',
                    onclick: () => {
                        subject$.complete();
                    }
                }
            ],
            clsDialog: cls
        };
        const dialogObj = this.create(options);
        return subject$.asObservable().pipe(finalize(() => {
            if (dialogDataSubscription) {
                dialogDataSubscription.unsubscribe();
            }
            this.close(dialogObj);
            componentRef.destroy();
        }));
    }
    /**
     * Show an info dialog
     * @param content The content of the info
     * @param options Options for info
     */
    info(content, options) {
        return window.Metro.infobox.create(content, '', options).data('infobox');
    }
};
DialogService.ctorParameters = () => [
    { type: ComponentFactoryResolver },
    { type: ApplicationRef },
    { type: Injector }
];
DialogService = __decorate([
    Injectable(),
    __metadata("design:paramtypes", [ComponentFactoryResolver,
        ApplicationRef,
        Injector])
], DialogService);
export { DialogService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGlhbG9nLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZy1tZXRybzQvIiwic291cmNlcyI6WyJsaWIvaW5mb3JtYXRpb24vZGlhbG9nL2RpYWxvZy5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUMsY0FBYyxFQUFFLHdCQUF3QixFQUFFLFlBQVksRUFBRSxlQUFlLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUM1SCxPQUFPLEVBQWEsT0FBTyxFQUFlLE1BQU0sTUFBTSxDQUFDO0FBQ3ZELE9BQU8sRUFBQyxRQUFRLEVBQUUsU0FBUyxFQUFDLE1BQU0sZ0JBQWdCLENBQUM7QUFDbkQsT0FBTyxFQUFDLG9CQUFvQixFQUFDLE1BQU0sZ0RBQWdELENBQUM7QUE0Q3BGLElBQWEsYUFBYSxHQUExQixNQUFhLGFBQWE7SUFFeEIsWUFBb0Isd0JBQWtELEVBQ2xELE1BQXNCLEVBQ3RCLFFBQWtCO1FBRmxCLDZCQUF3QixHQUF4Qix3QkFBd0IsQ0FBMEI7UUFDbEQsV0FBTSxHQUFOLE1BQU0sQ0FBZ0I7UUFDdEIsYUFBUSxHQUFSLFFBQVEsQ0FBVTtJQUFJLENBQUM7SUFFM0M7OztPQUdHO0lBQ0ksTUFBTSxDQUFDLE9BQXNCO1FBQ2xDLE9BQWEsTUFBTyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ3BELENBQUM7SUFFRDs7O09BR0c7SUFDSSxLQUFLLENBQUMsU0FBYztRQUN6QixPQUFhLE1BQU8sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUNyRCxDQUFDO0lBRUQ7Ozs7Ozs7T0FPRztJQUNJLEtBQUssQ0FBQyxLQUFhLEVBQUUsT0FBZSxFQUFFLEdBQVksRUFBRSxTQUFrQixFQUFFLFFBQWlCO1FBQzlGLE1BQU0sUUFBUSxHQUFHLElBQUksT0FBTyxFQUFRLENBQUM7UUFFckMsTUFB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QzVELE9BQU8sRUFBRSxHQUFHLEVBQUU7d0JBQ1osUUFBUSxDQUFDLFFBQVEsRUFBRSxDQUFDO29CQUN0QixDQUFDO2lCQUNGO2FBQ0Y7WUFDRCxTQUFTLEVBQUUsR0FBRztTQUNmLENBQUM7UUFFRixNQUFNLFNBQVMsR0FBUSxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBRTVDLE9BQU8sUUFBUSxDQUFDLFlBQVksRUFBRSxDQUFDLElBQUksQ0FDakMsUUFBUSxDQUFDLEdBQUcsRUFBRTtZQUNaLElBQUksc0JBQXNCLEVBQUU7Z0JBQzFCLHNCQUFzQixDQUFDLFdBQVcsRUFBRSxDQUFDO2FBQ3RDO1lBRUQsSUFBSSxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUN0QixZQUFZLENBQUMsT0FBTyxFQUFFLENBQUM7UUFDekIsQ0FBQyxDQUFDLENBQ0gsQ0FBQztJQUNKLENBQUM7SUFFRDs7OztPQUlHO0lBQ0ksSUFBSSxDQUFDLE9BQWUsRUFBRSxPQUF3QjtRQUVuRCxPQUFhLE1BQU8sQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxPQUFPLEVBQUUsRUFBRSxFQUFFLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUNsRixDQUFDO0NBQ0YsQ0FBQTs7WUFoUytDLHdCQUF3QjtZQUMxQyxjQUFjO1lBQ1osUUFBUTs7QUFKM0IsYUFBYTtJQUR6QixVQUFVLEVBQUU7cUNBR21DLHdCQUF3QjtRQUMxQyxjQUFjO1FBQ1osUUFBUTtHQUozQixhQUFhLENBa1N6QjtTQWxTWSxhQUFhIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtBcHBsaWNhdGlvblJlZiwgQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLCBDb21wb25lbnRSZWYsIEVtYmVkZGVkVmlld1JlZiwgSW5qZWN0YWJsZSwgSW5qZWN0b3J9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQge09ic2VydmFibGUsIFN1YmplY3QsIFN1YnNjcmlwdGlvbn0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7ZmluYWxpemUsIHN0YXJ0V2l0aH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQge0Zvcm1CdWlsZGVyQ29tcG9uZW50fSBmcm9tICcuLi8uLi9mb3JtL2Zvcm0tYnVpbGRlci9mb3JtLWJ1aWxkZXIuY29tcG9uZW50JztcclxuaW1wb3J0IHtNNEZvcm1Hcm91cH0gZnJvbSAnLi4vLi4vZm9ybS9tNC1mb3JtLWdyb3VwJztcclxuaW1wb3J0IHtNNERpYWxvZ0RhdGFFbWl0dGVyLCBNNERpYWxvZ0RhdGFJbnB1dH0gZnJvbSAnLi9kaWFsb2ctaW50ZXJmYWNlcyc7XHJcblxyXG5kZWNsYXJlIHZhciAkOiBhbnk7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIERpYWxvZ09wdGlvbnMge1xyXG4gIHRpdGxlPzogc3RyaW5nO1xyXG4gIGNvbnRlbnQ/OiBzdHJpbmd8YW55O1xyXG4gIGFjdGlvbnM/OiB7IGNhcHRpb246IHN0cmluZywgY2xzOiBzdHJpbmcsIG9uY2xpY2s6ICgpID0+IHZvaWQgfVtdO1xyXG4gIGFjdGlvbnNBbGlnbj86ICdsZWZ0J3wncmlnaHQnO1xyXG4gIGRlZmF1bHRBY3Rpb24/OiBib29sZWFuO1xyXG4gIG92ZXJsYXk/OiBib29sZWFuO1xyXG4gIG92ZXJsYXlDb2xvcj86IHN0cmluZztcclxuICBvdmVybGF5QWxwaGE/OiBudW1iZXI7XHJcbiAgb3ZlcmxheUNsaWNrQ2xvc2U/OiBib29sZWFuO1xyXG4gIHdpZHRoPzogbnVtYmVyO1xyXG4gIGNsb3NlQWN0aW9uPzogYm9vbGVhbjtcclxuICBjbHNEaWFsb2c/OiBzdHJpbmc7XHJcbiAgY2xzVGl0bGU/OiBzdHJpbmc7XHJcbiAgY2xzQ29udGVudD86IHN0cmluZztcclxuICBjbHNBY3Rpb24/OiBzdHJpbmc7XHJcbiAgY2xzRGVmYXVsdEFjdGlvbj86IHN0cmluZztcclxuICBhdXRvSGlkZT86IG51bWJlcjtcclxuICByZW1vdmVPbkNsb3NlPzogYm9vbGVhbjtcclxuICBzaG93PzogYm9vbGVhbjtcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBJbmZvYm94T3B0aW9ucyB7XHJcbiAgdHlwZT86ICdkZWZhdWx0J3wnc3VjY2Vzcyd8J2luZm8nfCdhbGVydCd8J3dhcm5pbmcnO1xyXG4gIHdpZHRoPzogbnVtYmVyO1xyXG4gIGhlaWdodD86IG51bWJlcjtcclxuICBvdmVybGF5PzogYm9vbGVhbjtcclxuICBvdmVybGF5Q29sb3I/OiBzdHJpbmc7XHJcbiAgb3ZlcmxheUFscGhhPzogc3RyaW5nO1xyXG4gIGF1dG9IaWRlPzogbnVtYmVyO1xyXG4gIHJlbW92ZU9uQ2xvc2U/OiBib29sZWFuO1xyXG4gIGNsb3NlQnV0dG9uPzogYm9vbGVhbjtcclxuICBjbHNCb3g/OiBzdHJpbmc7XHJcbiAgY2xzQm94Q29udGVudD86IHN0cmluZztcclxuICBjbHNPdmVybGF5Pzogc3RyaW5nO1xyXG59XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBEaWFsb2dTZXJ2aWNlIHtcclxuXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBjb21wb25lbnRGYWN0b3J5UmVzb2x2ZXI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcclxuICAgICAgICAgICAgICBwcml2YXRlIGFwcFJlZjogQXBwbGljYXRpb25SZWYsXHJcbiAgICAgICAgICAgICAgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IpIHsgfVxyXG5cclxuICAvKipcclxuICAgKiBDcmVhdGUgYSBjdXN0b20gZGlhbG9nXHJcbiAgICogQHBhcmFtIG9wdGlvbnMgVGhlIG9wdGlvbnMgb2YgdGhlIGRpYWxvZ1xyXG4gICAqL1xyXG4gIHB1YmxpYyBjcmVhdGUob3B0aW9uczogRGlhbG9nT3B0aW9ucyk6IGFueSB7XHJcbiAgICByZXR1cm4gKDxhbnk+d2luZG93KS5NZXRyby5kaWFsb2cuY3JlYXRlKG9wdGlvbnMpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ2xvc2UgYSBjcmVhdGVkIGRpYWxvZ1xyXG4gICAqIEBwYXJhbSBkaWFsb2dPYmogVGhlIG9iamVjdCByZXR1cm5lZCBieSB0aGUgY3JlYXRlIG1ldGhvZFxyXG4gICAqL1xyXG4gIHB1YmxpYyBjbG9zZShkaWFsb2dPYmo6IGFueSk6IGFueSB7XHJcbiAgICByZXR1cm4gKDxhbnk+d2luZG93KS5NZXRyby5kaWFsb2cuY2xvc2UoZGlhbG9nT2JqKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNob3dzIGFuIGFsZXJ0IGRpYWxvZ1xyXG4gICAqIEBwYXJhbSB0aXRsZSBUaGUgdGl0bGUgb2YgdGhlIGRpYWxvZ1xyXG4gICAqIEBwYXJhbSBtZXNzYWdlIFRoZSBtZXNzYWdlIG9mIHRoZSBkaWFsb2dcclxuICAgKiBAcGFyYW0gY2xzIE9wdGlvbmFsIGNzcyBjbGFzc2VzXHJcbiAgICogQHBhcmFtIG9rQnRuVGV4dCBUaGUgdGV4dCBvZiB0aGUgT0stQnV0dG9uXHJcbiAgICogQHBhcmFtIG9rQnRuQ2xzIEFuIG9wdGlvbmFsIGNzcyBjbGFzcyBmb3IgdGhlIE9LLUJ1dHRvblxyXG4gICAqL1xyXG4gIHB1YmxpYyBhbGVydCh0aXRsZTogc3RyaW5nLCBtZXNzYWdlOiBzdHJpbmcsIGNscz86IHN0cmluZywgb2tCdG5UZXh0Pzogc3RyaW5nLCBva0J0bkNscz86IHN0cmluZyk6IE9ic2VydmFibGU8dm9pZD4ge1xyXG4gICAgY29uc3Qgc3ViamVjdCQgPSBuZXcgU3ViamVjdDx2b2lkPigpO1xyXG5cclxuICAgIGNvbnN0IG9wdGlvbnM6IERpYWxvZ09wdGlvbnMgPSB7XHJcbiAgICAgIHRpdGxlOiB0aXRsZSxcclxuICAgICAgY29udGVudDogbWVzc2FnZSxcclxuICAgICAgY2xzRGlhbG9nOiBjbHMsXHJcbiAgICAgIG92ZXJsYXlDbGlja0Nsb3NlOiB0cnVlXHJcbiAgICB9O1xyXG5cclxuICAgIGlmIChva0J0blRleHQpIHtcclxuICAgICAgb3B0aW9ucy5hY3Rpb25zID0gW3tcclxuICAgICAgICBjYXB0aW9uOiBva0J0blRleHQsXHJcbiAgICAgICAgY2xzOiAob2tCdG5DbHMgPyBva0J0bkNscyA6ICcnKSArICcganMtZGlhbG9nLWNsb3NlJyxcclxuICAgICAgICBvbmNsaWNrOiAoKSA9PiB7XHJcbiAgICAgICAgICBzdWJqZWN0JC5uZXh0KCk7XHJcbiAgICAgICAgICBzdWJqZWN0JC5jb21wbGV0ZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgfV07XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgYWxlcnRPYmogPSB0aGlzLmNyZWF0ZShvcHRpb25zKTtcclxuXHJcbiAgICByZXR1cm4gc3ViamVjdCQuYXNPYnNlcnZhYmxlKCkucGlwZShcclxuICAgICAgZmluYWxpemUoKCkgPT4ge1xyXG4gICAgICAgIHRoaXMuY2xvc2UoYWxlcnRPYmopO1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNob3dzIGEgY29uZmlybSBkaWFsb2dcclxuICAgKiBAcGFyYW0gdGl0bGUgVGhlIHRpdGxlIG9mIHRoZSBjb25maXJtXHJcbiAgICogQHBhcmFtIG1lc3NhZ2UgVGhlIG1lc3NhZ2Ugb2YgdGhlIGNvbmZpcm1cclxuICAgKiBAcGFyYW0geWVzQnRuVGV4dCBUaGUgdGV4dCBmb3IgdGhlIFllcy1CdXR0b25cclxuICAgKiBAcGFyYW0gbm9CdG5UZXh0IFRoZSB0ZXh0IGZvciB0aGUgTm8tQnV0dG9uXHJcbiAgICogQHBhcmFtIGNscyBBbiBvcHRpb25hbCBjc3MgY2xhc3MgZm9yIHRoZSBkaWFsb2dcclxuICAgKiBAcGFyYW0geWVzQnRuQ2xzIEFuIG9wdGlvbmFsIGNzcyBjbGFzcyBmb3IgdGhlIFllcy1CdXR0b25cclxuICAgKiBAcGFyYW0gbm9CdG5DbHMgQW4gb3B0aW9uYWwgY3NzIGNsYXNzIGZvciB0aGUgTm8tQnV0dG9uXHJcbiAgICovXHJcbiAgcHVibGljIGNvbmZpcm0odGl0bGU6IHN0cmluZywgbWVzc2FnZTogc3RyaW5nLCB5ZXNCdG5UZXh0Pzogc3RyaW5nLCBub0J0blRleHQ/OiBzdHJpbmcsXHJcbiAgICAgICAgICAgICAgICAgY2xzPzogc3RyaW5nLCB5ZXNCdG5DbHM/OiBzdHJpbmcsIG5vQnRuQ2xzPzogc3RyaW5nKTogT2JzZXJ2YWJsZTxib29sZWFuPiB7XHJcbiAgICBjb25zdCBzdWJqZWN0JCA9IG5ldyBTdWJqZWN0PGJvb2xlYW4+KCk7XHJcblxyXG4gICAgY29uc3Qgb3B0aW9uczogRGlhbG9nT3B0aW9ucyA9IHtcclxuICAgICAgdGl0bGU6IHRpdGxlLFxyXG4gICAgICBjb250ZW50OiBtZXNzYWdlLFxyXG4gICAgICBhY3Rpb25zOiBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgY2FwdGlvbjogeWVzQnRuVGV4dCA/IHllc0J0blRleHQgOiAnWWVzJyxcclxuICAgICAgICAgIGNsczogKHllc0J0bkNscyA/IHllc0J0bkNscyA6ICdzdWNjZXNzJykgKyAnIGpzLWRpYWxvZy1jbG9zZScsXHJcbiAgICAgICAgICBvbmNsaWNrOiAoKSA9PiB7XHJcbiAgICAgICAgICAgIHN1YmplY3QkLm5leHQodHJ1ZSk7XHJcbiAgICAgICAgICAgIHN1YmplY3QkLmNvbXBsZXRlKCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICB7XHJcbiAgICAgICAgICBjYXB0aW9uOiBub0J0blRleHQgPyBub0J0blRleHQgOiAnTm8nLFxyXG4gICAgICAgICAgY2xzOiAobm9CdG5DbHMgPyBub0J0bkNscyA6ICdhbGVydCcpICsgJyBqcy1kaWFsb2ctY2xvc2UnLFxyXG4gICAgICAgICAgb25jbGljazogKCkgPT4ge1xyXG4gICAgICAgICAgICBzdWJqZWN0JC5uZXh0KGZhbHNlKTtcclxuICAgICAgICAgICAgc3ViamVjdCQuY29tcGxldGUoKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIF0sXHJcbiAgICAgIGNsc0RpYWxvZzogY2xzXHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IGNvbmZpcm1PYmogPSB0aGlzLmNyZWF0ZShvcHRpb25zKTtcclxuXHJcbiAgICByZXR1cm4gc3ViamVjdCQuYXNPYnNlcnZhYmxlKCkucGlwZShcclxuICAgICAgZmluYWxpemUoKCkgPT4ge1xyXG4gICAgICAgIHRoaXMuY2xvc2UoY29uZmlybU9iaik7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2hvdyBhIHByb21wdCBkaWFsb2dcclxuICAgKiBAcGFyYW0gdGl0bGUgVGhlIHRpdGxlIG9mIHRoZSBwcm9tcHRcclxuICAgKiBAcGFyYW0gbWVzc2FnZSBUaGUgbWVzc2FnZSBvZiB0aGUgcHJvbXB0XHJcbiAgICogQHBhcmFtIHN1Ym1pdEJ0blRleHQgVGhlIHRleHQgb2YgdGhlIFN1Ym1pdC1CdXR0b25cclxuICAgKiBAcGFyYW0gcGxhY2Vob2xkZXIgVGhlIHBsYWNlaG9sZGVyIG9mIHRoZSBpbnB1dFxyXG4gICAqIEBwYXJhbSBjbHMgQW4gb3B0aW9uYWwgY3NzIGNsYXNzIGZvciB0aGUgZGlhbG9nXHJcbiAgICogQHBhcmFtIHN1Ym1pdEJ0bkNscyBBbiBvcHRpb25hbCBjc3MgY2xhc3MgZm9yIFN1Ym1pdC1CdXR0b25cclxuICAgKiBAcGFyYW0gaW5wdXRDbHMgQW4gb3B0aW9uYWwgY3NzIGNsYXNzIGZvciB0aGUgaW5wdXRcclxuICAgKi9cclxuICBwdWJsaWMgcHJvbXB0KHRpdGxlOiBzdHJpbmcsIG1lc3NhZ2U6IHN0cmluZywgc3VibWl0QnRuVGV4dD86IHN0cmluZywgcGxhY2Vob2xkZXI/OiBzdHJpbmcsXHJcbiAgICAgICAgICAgICAgICBjbHM/OiBzdHJpbmcsIHN1Ym1pdEJ0bkNscz86IHN0cmluZywgaW5wdXRDbHM/OiBzdHJpbmcpOiBPYnNlcnZhYmxlPHN0cmluZz4ge1xyXG4gICAgY29uc3Qgc3ViamVjdCQgPSBuZXcgU3ViamVjdDxzdHJpbmc+KCk7XHJcblxyXG4gICAgY29uc3Qgb3B0aW9uczogRGlhbG9nT3B0aW9ucyA9IHtcclxuICAgICAgdGl0bGU6IHRpdGxlLFxyXG4gICAgICBjb250ZW50OiAobWVzc2FnZSA/IG1lc3NhZ2UgOiAnJykgK1xyXG4gICAgICAgICAgICAgICAgYDxicj48aW5wdXQgZGF0YS1yb2xlPVwiaW5wdXRcIiB0eXBlPVwidGV4dFwiIGNsYXNzPVwiJHtpbnB1dENsc31cIiBwbGFjZWhvbGRlcj1cIiR7cGxhY2Vob2xkZXIgPyBwbGFjZWhvbGRlciA6ICcnfVwiIC8+YCxcclxuICAgICAgYWN0aW9uczogW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgIGNhcHRpb246IHN1Ym1pdEJ0blRleHQgPyBzdWJtaXRCdG5UZXh0IDogJ1N1Ym1pdCcsXHJcbiAgICAgICAgICBjbHM6IChzdWJtaXRCdG5DbHMgPyBzdWJtaXRCdG5DbHMgOiAnc3VjY2VzcycpICsgJyBqcy1kaWFsb2ctY2xvc2UnLFxyXG4gICAgICAgICAgb25jbGljazogKCkgPT4ge1xyXG4gICAgICAgICAgICBzdWJqZWN0JC5uZXh0KHZhbHVlKTtcclxuICAgICAgICAgICAgc3ViamVjdCQuY29tcGxldGUoKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIF0sXHJcbiAgICAgIGNsc0RpYWxvZzogY2xzXHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IHByb21wdE9iajogYW55ID0gdGhpcy5jcmVhdGUob3B0aW9ucyk7XHJcbiAgICBjb25zdCBpbnB1dCA9IHByb21wdE9iai5maW5kKCdpbnB1dCcpO1xyXG5cclxuICAgIGxldCB2YWx1ZSA9ICcnO1xyXG4gICAgaW5wdXQub24oJ2NoYW5nZScsICgpID0+IHtcclxuICAgICAgdmFsdWUgPSBpbnB1dC52YWwoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiBzdWJqZWN0JC5hc09ic2VydmFibGUoKS5waXBlKFxyXG4gICAgICBmaW5hbGl6ZSgoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5jbG9zZShwcm9tcHRPYmopO1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNob3cgYSBwcm9tcHQgZGlhbG9nIHRoYXQgY29udGFpbnMgYSBmb3JtXHJcbiAgICogQHBhcmFtIHRpdGxlIFRoZSB0aXRsZSBvZiB0aGUgcHJvbXB0XHJcbiAgICogQHBhcmFtIGZvcm0gVGhlIGZvcm0gZ3JvdXBcclxuICAgKiBAcGFyYW0gc3VibWl0QnRuVGV4dCBUaGUgdGV4dCBvZiB0aGUgU3VibWl0LUJ1dHRvblxyXG4gICAqIEBwYXJhbSBhYm9ydEJ0blRleHQgVGhlIHRleHQgb2YgdGhlIEFib3J0LUJ1dHRvblxyXG4gICAqIEBwYXJhbSBwbGFjZWhvbGRlciBUaGUgcGxhY2Vob2xkZXIgb2YgdGhlIGlucHV0XHJcbiAgICogQHBhcmFtIGNscyBBbiBvcHRpb25hbCBjc3MgY2xhc3MgZm9yIHRoZSBkaWFsb2dcclxuICAgKiBAcGFyYW0gc3VibWl0QnRuQ2xzIEFuIG9wdGlvbmFsIGNzcyBjbGFzcyBmb3IgU3VibWl0LUJ1dHRvblxyXG4gICAqIEBwYXJhbSBhYm9ydEJ0bkNscyBBbiBvcHRpb25hbCBjc3MgY2xhc3MgZm9yIEFib3J0LUJ1dHRvblxyXG4gICAqL1xyXG4gIHB1YmxpYyBmb3JtUHJvbXB0PFQgPSBzdHJpbmc+KHRpdGxlOiBzdHJpbmcsIGZvcm06IE00Rm9ybUdyb3VwLCBzdWJtaXRCdG5UZXh0Pzogc3RyaW5nLCBhYm9ydEJ0blRleHQ/OiBzdHJpbmcsIHBsYWNlaG9sZGVyPzogc3RyaW5nLFxyXG4gICAgICAgICAgICAgICAgY2xzPzogc3RyaW5nLCBzdWJtaXRCdG5DbHM/OiBzdHJpbmcsIGFib3J0QnRuQ2xzPzogc3RyaW5nKTogT2JzZXJ2YWJsZTxUPiB7XHJcbiAgICBjb25zdCBjb21wb25lbnRSZWY6IENvbXBvbmVudFJlZjxGb3JtQnVpbGRlckNvbXBvbmVudD4gPSB0aGlzLmNvbXBvbmVudEZhY3RvcnlSZXNvbHZlci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShGb3JtQnVpbGRlckNvbXBvbmVudCkuY3JlYXRlKHRoaXMuaW5qZWN0b3IpO1xyXG4gICAgY29tcG9uZW50UmVmLmluc3RhbmNlLmZvcm1Hcm91cCA9IGZvcm07XHJcbiAgICB0aGlzLmFwcFJlZi5hdHRhY2hWaWV3KGNvbXBvbmVudFJlZi5ob3N0Vmlldyk7XHJcbiAgICBjb25zdCBkb21FbGVtZW50ID0gKGNvbXBvbmVudFJlZi5ob3N0VmlldyBhcyBFbWJlZGRlZFZpZXdSZWY8YW55Pikucm9vdE5vZGVzWzBdIGFzIEhUTUxFbGVtZW50O1xyXG5cclxuICAgIGNvbnN0IHN1YmplY3QkID0gbmV3IFN1YmplY3Q8VD4oKTtcclxuXHJcbiAgICBjb25zdCBvcHRpb25zOiBEaWFsb2dPcHRpb25zID0ge1xyXG4gICAgICB0aXRsZTogdGl0bGUsXHJcbiAgICAgIGNvbnRlbnQ6ICdjb250ZW50JyxcclxuICAgICAgYWN0aW9uczogW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgIGNhcHRpb246IGFib3J0QnRuVGV4dCA/IGFib3J0QnRuVGV4dCA6ICdBYm9ydCcsXHJcbiAgICAgICAgICBjbHM6IGFib3J0QnRuQ2xzID8gYWJvcnRCdG5DbHMgOiAnd2FybmluZycsXHJcbiAgICAgICAgICBvbmNsaWNrOiAoKSA9PiB7XHJcbiAgICAgICAgICAgIHN1YmplY3QkLm5leHQobnVsbCk7XHJcbiAgICAgICAgICAgIHN1YmplY3QkLmNvbXBsZXRlKCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICB7XHJcbiAgICAgICAgICBjYXB0aW9uOiBzdWJtaXRCdG5UZXh0ID8gc3VibWl0QnRuVGV4dCA6ICdTdWJtaXQnLFxyXG4gICAgICAgICAgY2xzOiAoc3VibWl0QnRuQ2xzID8gc3VibWl0QnRuQ2xzIDogJ3N1Y2Nlc3MnKSArICcgc3VibWl0LWJ0bicsXHJcbiAgICAgICAgICBvbmNsaWNrOiAoKSA9PiB7XHJcbiAgICAgICAgICAgIHN1YmplY3QkLm5leHQoZm9ybS52YWx1ZSk7XHJcbiAgICAgICAgICAgIHN1YmplY3QkLmNvbXBsZXRlKCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICBdLFxyXG4gICAgICBjbHNEaWFsb2c6IGNsc1xyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCBwcm9tcHRPYmo6IGFueSA9IHRoaXMuY3JlYXRlKG9wdGlvbnMpO1xyXG4gICAgcHJvbXB0T2JqLmZpbmQoJy5kaWFsb2ctY29udGVudCcpLmVtcHR5KCkuYXBwZW5kKGRvbUVsZW1lbnQpO1xyXG5cclxuICAgIGNvbnN0IGZvcm1TdGF0ZVN1YnNjcmlwdGlvbiA9IGZvcm0uc3RhdHVzQ2hhbmdlcy5waXBlKHN0YXJ0V2l0aChmb3JtLnN0YXR1cykpLnN1YnNjcmliZSgodmFsaWQ6ICdWQUxJRCd8J0lOVkFMSUQnKSA9PiB7XHJcbiAgICAgIGNvbnN0IHN1Ym1pdEJ0biA9IHByb21wdE9iai5maW5kKCcuZGlhbG9nLWFjdGlvbnMgYnV0dG9uLnN1Ym1pdC1idG4nKTtcclxuXHJcbiAgICAgIGlmICh2YWxpZCA9PT0gJ1ZBTElEJykge1xyXG4gICAgICAgIHN1Ym1pdEJ0bi5yZW1vdmVBdHRyKCdkaXNhYmxlZCcpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHN1Ym1pdEJ0bi5hdHRyKCdkaXNhYmxlZCcsICdkaXNhYmxlZCcpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gc3ViamVjdCQuYXNPYnNlcnZhYmxlKCkucGlwZShcclxuICAgICAgZmluYWxpemUoKCkgPT4ge1xyXG4gICAgICAgIHRoaXMuY2xvc2UocHJvbXB0T2JqKTtcclxuICAgICAgICBjb21wb25lbnRSZWYuZGVzdHJveSgpO1xyXG4gICAgICAgIGZvcm1TdGF0ZVN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNob3cgYSBkaWFsb2cgdGhhdCBjb250YWlucyBhIGNvbXBvbmVudFxyXG4gICAqIEBwYXJhbSBjb21wb25lbnQgVGhlIGNvbXBvbmVudCBjbGFzcyB0byByZW5kZXJcclxuICAgKiBAcGFyYW0gZGlhbG9nRGF0YSBEYXRhIHRvIHBhc3MgdG8gdGhlIG5ldyBjb21wb25lbnQgaW5zdGFuY2VcclxuICAgKiBAcGFyYW0gdGl0bGUgVGhlIHRpdGxlIG9mIHRoZSBkaWFsb2dcclxuICAgKiBAcGFyYW0gY2xvc2VCdG5UZXh0IEN1c3RvbSB0ZXh0IGZvciB0aGUgY2xvc2UgYnV0dG9uXHJcbiAgICogQHBhcmFtIGNscyBDdXN0b20gZGlhbG9nIGNsYXNzIChhY2NlbnQsIHNpemUgZXRjLilcclxuICAgKiBAcGFyYW0gY2xvc2VCdG5DbHMgQ3VzdG9tIGNsb3NlIGJ1dHRvbiBjbGFzc1xyXG4gICAqL1xyXG4gIHB1YmxpYyBzaG93PFRPdXRwdXQgPSBudWxsPihjb21wb25lbnQ6IG5ldyAoLi4uYXJnczogYW55W10pID0+IGFueSwgZGlhbG9nRGF0YT86IGFueSwgdGl0bGU/OiBzdHJpbmcsIGNsb3NlQnRuVGV4dD86IHN0cmluZywgY2xzPzogc3RyaW5nLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbG9zZUJ0bkNscz86IHN0cmluZyk6IE9ic2VydmFibGU8VE91dHB1dD4ge1xyXG4gICAgY29uc3QgY29tcG9uZW50UmVmOiBDb21wb25lbnRSZWY8YW55PiA9IHRoaXMuY29tcG9uZW50RmFjdG9yeVJlc29sdmVyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KGNvbXBvbmVudCkuY3JlYXRlKHRoaXMuaW5qZWN0b3IpO1xyXG5cclxuICAgIGlmICghIWRpYWxvZ0RhdGEpIHtcclxuICAgICAgKDxNNERpYWxvZ0RhdGFJbnB1dDxUT3V0cHV0Pj5jb21wb25lbnRSZWYuaW5zdGFuY2UpLmRpYWxvZ0RhdGFJbnB1dCA9IGRpYWxvZ0RhdGE7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5hcHBSZWYuYXR0YWNoVmlldyhjb21wb25lbnRSZWYuaG9zdFZpZXcpO1xyXG4gICAgY29uc3QgZG9tRWxlbWVudCA9IChjb21wb25lbnRSZWYuaG9zdFZpZXcgYXMgRW1iZWRkZWRWaWV3UmVmPGFueT4pLnJvb3ROb2Rlc1swXSBhcyBIVE1MRWxlbWVudDtcclxuXHJcbiAgICBjb25zdCBzdWJqZWN0JCA9IG5ldyBTdWJqZWN0PFRPdXRwdXQ+KCk7XHJcblxyXG4gICAgbGV0IGRpYWxvZ0RhdGFTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcclxuXHJcbiAgICBpZiAoISEoPE00RGlhbG9nRGF0YUVtaXR0ZXI8VE91dHB1dD4+Y29tcG9uZW50UmVmLmluc3RhbmNlKS5kaWFsb2dEYXRhRW1pdHRlcikge1xyXG4gICAgICBkaWFsb2dEYXRhU3Vic2NyaXB0aW9uID0gKDxNNERpYWxvZ0RhdGFFbWl0dGVyPFRPdXRwdXQ+PmNvbXBvbmVudFJlZi5pbnN0YW5jZSkuZGlhbG9nRGF0YUVtaXR0ZXJcclxuICAgICAgICAucGlwZShmaW5hbGl6ZSgoKSA9PiB7XHJcbiAgICAgICAgICBzdWJqZWN0JC5jb21wbGV0ZSgpO1xyXG4gICAgICAgIH0pKS5zdWJzY3JpYmUoKGRhdGEpID0+IHtcclxuICAgICAgICAgIHN1YmplY3QkLm5leHQoZGF0YSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3Qgb3B0aW9uczogRGlhbG9nT3B0aW9ucyA9IHtcclxuICAgICAgdGl0bGU6IHRpdGxlLFxyXG4gICAgICBjb250ZW50OiAkKGRvbUVsZW1lbnQpLFxyXG4gICAgICBhY3Rpb25zOiBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgY2FwdGlvbjogY2xvc2VCdG5UZXh0ID8gY2xvc2VCdG5UZXh0IDogJ1N1Ym1pdCcsXHJcbiAgICAgICAgICBjbHM6IChjbG9zZUJ0bkNscyA/IGNsb3NlQnRuQ2xzIDogJ3N1Y2Nlc3MnKSArICcgc3VibWl0LWJ0bicsXHJcbiAgICAgICAgICBvbmNsaWNrOiAoKSA9PiB7XHJcbiAgICAgICAgICAgIHN1YmplY3QkLmNvbXBsZXRlKCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICBdLFxyXG4gICAgICBjbHNEaWFsb2c6IGNsc1xyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCBkaWFsb2dPYmo6IGFueSA9IHRoaXMuY3JlYXRlKG9wdGlvbnMpO1xyXG5cclxuICAgIHJldHVybiBzdWJqZWN0JC5hc09ic2VydmFibGUoKS5waXBlKFxyXG4gICAgICBmaW5hbGl6ZSgoKSA9PiB7XHJcbiAgICAgICAgaWYgKGRpYWxvZ0RhdGFTdWJzY3JpcHRpb24pIHtcclxuICAgICAgICAgIGRpYWxvZ0RhdGFTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuY2xvc2UoZGlhbG9nT2JqKTtcclxuICAgICAgICBjb21wb25lbnRSZWYuZGVzdHJveSgpO1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNob3cgYW4gaW5mbyBkaWFsb2dcclxuICAgKiBAcGFyYW0gY29udGVudCBUaGUgY29udGVudCBvZiB0aGUgaW5mb1xyXG4gICAqIEBwYXJhbSBvcHRpb25zIE9wdGlvbnMgZm9yIGluZm9cclxuICAgKi9cclxuICBwdWJsaWMgaW5mbyhjb250ZW50OiBzdHJpbmcsIG9wdGlvbnM/OiBJbmZvYm94T3B0aW9ucyk6IHsgc2V0Q29udGVudDogKGNvbnRlbnQ6IHN0cmluZykgPT4gdm9pZDtcclxuICAgIHNldFR5cGU6ICh0eXBlOiAnZGVmYXVsdCd8J3N1Y2Nlc3MnfCdpbmZvJ3wnYWxlcnQnfCd3YXJuaW5nJykgPT4gdm9pZDsgY2xvc2U6ICgpID0+IHZvaWQgfSB7XHJcbiAgICByZXR1cm4gKDxhbnk+d2luZG93KS5NZXRyby5pbmZvYm94LmNyZWF0ZShjb250ZW50LCAnJywgb3B0aW9ucykuZGF0YSgnaW5mb2JveCcpO1xyXG4gIH1cclxufVxyXG4iXX0=