import { __decorate, __metadata } from "tslib";
import { AfterViewInit, ChangeDetectionStrategy, Component, ElementRef, EventEmitter, Input, OnChanges, OnDestroy, Output, SimpleChanges, ViewChild } from '@angular/core';
import { Subject } from 'rxjs';
import { finalize, take } from 'rxjs/operators';
let DialogComponent = class DialogComponent {
    constructor(element) {
        this.element = element;
        this.isOpen = false;
        this.closeEvent = new EventEmitter();
        this.closeSubject$ = new Subject();
    }
    open() {
        this.dialogObj.open();
        return this.closeSubject$.pipe(take(1), finalize(() => this.close()));
    }
    close() {
        if (this.dialogObj) {
            this.dialogObj.close();
        }
    }
    ngAfterViewInit() {
        const dialogOptions = {
            width: this.width,
            show: this.isOpen,
            overlay: this.overlay,
            overlayClickClose: this.overlayClickClose
        };
        if (this.overlayColor) {
            dialogOptions.overlayColor = this.overlayColor;
        }
        if (this.overlayAlpha) {
            dialogOptions.overlayAlpha = this.overlayAlpha;
        }
        this.dialogObj = $(this.dialog.nativeElement).dialog(dialogOptions).data('dialog');
        this.dialogObj.options.onClose = () => {
            this.closeEvent.emit();
            this.closeSubject$.next(this.data);
        };
        this.observeClassValue();
    }
    observeClassValue() {
        const classValueCallback = () => {
            const classValue = this.element.nativeElement.getAttribute('class');
            this.dialogObj.element.attr('class', `${classValue ? classValue + ' ' : ''}dialog`);
        };
        this.classObserver = new MutationObserver(classValueCallback);
        this.classObserver.observe(this.element.nativeElement, {
            attributeFilter: ['class'],
            attributes: true
        });
        classValueCallback();
    }
    ngOnChanges(changes) {
        if (this.dialogObj) {
            if (changes['isOpen']) {
                if (this.isOpen) {
                    this.open();
                }
                else {
                    this.close();
                }
            }
            if (changes['width']) {
                this.dialogObj.element.css('width', `${this.width}px`);
            }
            if (changes['overlay'] || changes['overlayColor'] || changes['overlayAlpha'] || changes['overlayClickClose']) {
                this.dialogObj.options.overlay = this.overlay;
                this.dialogObj.options.overlayColor = this.overlayColor;
                this.dialogObj.options.overlayAlpha = this.overlayAlpha;
                this.dialogObj.options.overlayClickClose = this.overlayClickClose;
            }
        }
    }
    ngOnDestroy() {
        if (this.dialogObj) {
            this.close();
            this.dialogObj.element.remove();
        }
        if (this.classObserver) {
            this.classObserver.disconnect();
        }
    }
};
DialogComponent.ctorParameters = () => [
    { type: ElementRef }
];
__decorate([
    Input('open'),
    __metadata("design:type", Object)
], DialogComponent.prototype, "isOpen", void 0);
__decorate([
    Input('width'),
    __metadata("design:type", String)
], DialogComponent.prototype, "width", void 0);
__decorate([
    Input('overlay'),
    __metadata("design:type", Boolean)
], DialogComponent.prototype, "overlay", void 0);
__decorate([
    Input('overlay-color'),
    __metadata("design:type", String)
], DialogComponent.prototype, "overlayColor", void 0);
__decorate([
    Input('overlay-alpha'),
    __metadata("design:type", String)
], DialogComponent.prototype, "overlayAlpha", void 0);
__decorate([
    Input('overlay-click-close'),
    __metadata("design:type", Boolean)
], DialogComponent.prototype, "overlayClickClose", void 0);
__decorate([
    Input('data'),
    __metadata("design:type", Object)
], DialogComponent.prototype, "data", void 0);
__decorate([
    ViewChild('dialog', { static: true }),
    __metadata("design:type", ElementRef)
], DialogComponent.prototype, "dialog", void 0);
__decorate([
    Output('close-event'),
    __metadata("design:type", Object)
], DialogComponent.prototype, "closeEvent", void 0);
DialogComponent = __decorate([
    Component({
        selector: 'm4-dialog',
        template: "<div #dialog>\r\n  <div class=\"dialog-title\">\r\n    <ng-content select=\"[dialog-title]\"></ng-content>\r\n  </div>\r\n  <div class=\"dialog-content\">\r\n    <ng-content select=\"[dialog-content]\"></ng-content>\r\n  </div>\r\n  <div class=\"dialog-actions\">\r\n    <ng-content select=\"[dialog-actions]\"></ng-content>\r\n  </div>\r\n</div>\r\n",
        changeDetection: ChangeDetectionStrategy.OnPush,
        styles: [""]
    }),
    __metadata("design:paramtypes", [ElementRef])
], DialogComponent);
export { DialogComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGlhbG9nLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25nLW1ldHJvNC8iLCJzb3VyY2VzIjpbImxpYi9pbmZvcm1hdGlvbi9kaWFsb2cvZGlhbG9nLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUNMLGFBQWEsRUFDYix1QkFBdUIsRUFDdkIsU0FBUyxFQUNULFVBQVUsRUFBRSxZQUFZLEVBQ3hCLEtBQUssRUFDTCxTQUFTLEVBQ1QsU0FBUyxFQUFFLE1BQU0sRUFDakIsYUFBYSxFQUNiLFNBQVMsRUFDVixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQWEsT0FBTyxFQUFDLE1BQU0sTUFBTSxDQUFDO0FBQ3pDLE9BQU8sRUFBQyxRQUFRLEVBQUUsSUFBSSxFQUFDLE1BQU0sZ0JBQWdCLENBQUM7QUFVOUMsSUFBYSxlQUFlLEdBQTVCLE1BQWEsZUFBZTtJQW1CMUIsWUFBb0IsT0FBbUI7UUFBbkIsWUFBTyxHQUFQLE9BQU8sQ0FBWTtRQWxCeEIsV0FBTSxHQUFHLEtBQUssQ0FBQztRQVVQLGVBQVUsR0FBRyxJQUFJLFlBQVksRUFBUSxDQUFDO1FBS3JELGtCQUFhLEdBQUcsSUFBSSxPQUFPLEVBQU8sQ0FBQztJQUdELENBQUM7SUFFcEMsSUFBSTtRQUNULElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDdEIsT0FBTyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsUUFBUSxDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDeEUsQ0FBQztJQUVNLEtBQUs7UUFDVixJQUFJLElBQUksQ0FBQyxTQUFTLEVBQUU7WUFDbEIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLEVBQUUsQ0FBQztTQUN4QjtJQUNILENBQUM7SUFFRCxlQUFlO1FBQ2IsTUFBTSxhQUFhLEdBQVE7WUFDekIs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XG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxyXG4gIENvbXBvbmVudCxcclxuICBFbGVtZW50UmVmLCBFdmVudEVtaXR0ZXIsXHJcbiAgSW5wdXQsXHJcbiAgT25DaGFuZ2VzLFxyXG4gIE9uRGVzdHJveSwgT3V0cHV0LFxyXG4gIFNpbXBsZUNoYW5nZXMsXHJcbiAgVmlld0NoaWxkXHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7T2JzZXJ2YWJsZSwgU3ViamVjdH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7ZmluYWxpemUsIHRha2V9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuXHJcbmRlY2xhcmUgdmFyICQ6IGFueTtcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAnbTQtZGlhbG9nJyxcclxuICB0ZW1wbGF0ZVVybDogJy4vZGlhbG9nLmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi9kaWFsb2cuY29tcG9uZW50LmNzcyddLFxyXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBEaWFsb2dDb21wb25lbnQgaW1wbGVtZW50cyBPbkNoYW5nZXMsIEFmdGVyVmlld0luaXQsIE9uRGVzdHJveSB7XHJcbiAgQElucHV0KCdvcGVuJykgaXNPcGVuID0gZmFsc2U7XHJcbiAgQElucHV0KCd3aWR0aCcpIHdpZHRoOiBzdHJpbmc7XHJcbiAgQElucHV0KCdvdmVybGF5Jykgb3ZlcmxheTogYm9vbGVhbjtcclxuICBASW5wdXQoJ292ZXJsYXktY29sb3InKSBvdmVybGF5Q29sb3I6IHN0cmluZztcclxuICBASW5wdXQoJ292ZXJsYXktYWxwaGEnKSBvdmVybGF5QWxwaGE6IHN0cmluZztcclxuICBASW5wdXQoJ292ZXJsYXktY2xpY2stY2xvc2UnKSBvdmVybGF5Q2xpY2tDbG9zZTogYm9vbGVhbjtcclxuXHJcbiAgQElucHV0KCdkYXRhJykgZGF0YTogYW55O1xyXG5cclxuICBAVmlld0NoaWxkKCdkaWFsb2cnLCB7IHN0YXRpYzogdHJ1ZSB9KSBwcml2YXRlIGRpYWxvZzogRWxlbWVudFJlZjtcclxuICBAT3V0cHV0KCdjbG9zZS1ldmVudCcpIGNsb3NlRXZlbnQgPSBuZXcgRXZlbnRFbWl0dGVyPHZvaWQ+KCk7XHJcblxyXG5cclxuICBkaWFsb2dPYmo6IGFueTtcclxuXHJcbiAgcHJpdmF0ZSBjbG9zZVN1YmplY3QkID0gbmV3IFN1YmplY3Q8YW55PigpO1xyXG4gIHByaXZhdGUgY2xhc3NPYnNlcnZlcjogTXV0YXRpb25PYnNlcnZlcjtcclxuXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBlbGVtZW50OiBFbGVtZW50UmVmKSB7fVxyXG5cclxuICBwdWJsaWMgb3BlbigpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgdGhpcy5kaWFsb2dPYmoub3BlbigpO1xyXG4gICAgcmV0dXJuIHRoaXMuY2xvc2VTdWJqZWN0JC5waXBlKHRha2UoMSksIGZpbmFsaXplKCgpID0+IHRoaXMuY2xvc2UoKSkpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGNsb3NlKCkge1xyXG4gICAgaWYgKHRoaXMuZGlhbG9nT2JqKSB7XHJcbiAgICAgIHRoaXMuZGlhbG9nT2JqLmNsb3NlKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBuZ0FmdGVyVmlld0luaXQoKTogdm9pZCB7XHJcbiAgICBjb25zdCBkaWFsb2dPcHRpb25zOiBhbnkgPSB7XHJcbiAgICAgIHdpZHRoOiB0aGlzLndpZHRoLFxyXG4gICAgICBzaG93OiB0aGlzLmlzT3BlbixcclxuICAgICAgb3ZlcmxheTogdGhpcy5vdmVybGF5LFxyXG4gICAgICBvdmVybGF5Q2xpY2tDbG9zZTogdGhpcy5vdmVybGF5Q2xpY2tDbG9zZVxyXG4gICAgfTtcclxuXHJcbiAgICBpZiAodGhpcy5vdmVybGF5Q29sb3IpIHtcclxuICAgICAgZGlhbG9nT3B0aW9ucy5vdmVybGF5Q29sb3IgPSB0aGlzLm92ZXJsYXlDb2xvcjtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodGhpcy5vdmVybGF5QWxwaGEpIHtcclxuICAgICAgZGlhbG9nT3B0aW9ucy5vdmVybGF5QWxwaGEgPSB0aGlzLm92ZXJsYXlBbHBoYTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmRpYWxvZ09iaiA9ICQodGhpcy5kaWFsb2cubmF0aXZlRWxlbWVudCkuZGlhbG9nKGRpYWxvZ09wdGlvbnMpLmRhdGEoJ2RpYWxvZycpO1xyXG4gICAgdGhpcy5kaWFsb2dPYmoub3B0aW9ucy5vbkNsb3NlID0gKCkgPT4ge1xyXG4gICAgICB0aGlzLmNsb3NlRXZlbnQuZW1pdCgpO1xyXG4gICAgICB0aGlzLmNsb3NlU3ViamVjdCQubmV4dCh0aGlzLmRhdGEpO1xyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLm9ic2VydmVDbGFzc1ZhbHVlKCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIG9ic2VydmVDbGFzc1ZhbHVlKCkge1xyXG4gICAgY29uc3QgY2xhc3NWYWx1ZUNhbGxiYWNrID0gKCkgPT4ge1xyXG4gICAgICBjb25zdCBjbGFzc1ZhbHVlID0gdGhpcy5lbGVtZW50Lm5hdGl2ZUVsZW1lbnQuZ2V0QXR0cmlidXRlKCdjbGFzcycpO1xyXG4gICAgICB0aGlzLmRpYWxvZ09iai5lbGVtZW50LmF0dHIoJ2NsYXNzJywgYCR7Y2xhc3NWYWx1ZSA/IGNsYXNzVmFsdWUgKyAnICcgOiAnJ31kaWFsb2dgKTtcclxuICAgIH07XHJcbiAgICB0aGlzLmNsYXNzT2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcihjbGFzc1ZhbHVlQ2FsbGJhY2spO1xyXG5cclxuICAgIHRoaXMuY2xhc3NPYnNlcnZlci5vYnNlcnZlKHRoaXMuZWxlbWVudC5uYXRpdmVFbGVtZW50LCB7XHJcbiAgICAgIGF0dHJpYnV0ZUZpbHRlcjogWydjbGFzcyddLFxyXG4gICAgICBhdHRyaWJ1dGVzOiB0cnVlXHJcbiAgICB9KTtcclxuXHJcbiAgICBjbGFzc1ZhbHVlQ2FsbGJhY2soKTtcclxuICB9XHJcblxyXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpOiB2b2lkIHtcclxuICAgIGlmICh0aGlzLmRpYWxvZ09iaikge1xyXG4gICAgICBpZiAoY2hhbmdlc1snaXNPcGVuJ10pIHtcclxuICAgICAgICBpZiAodGhpcy5pc09wZW4pIHtcclxuICAgICAgICAgIHRoaXMub3BlbigpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoY2hhbmdlc1snd2lkdGgnXSkge1xyXG4gICAgICAgIHRoaXMuZGlhbG9nT2JqLmVsZW1lbnQuY3NzKCd3aWR0aCcsIGAke3RoaXMud2lkdGh9cHhgKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKGNoYW5nZXNbJ292ZXJsYXknXSB8fCBjaGFuZ2VzWydvdmVybGF5Q29sb3InXSB8fCBjaGFuZ2VzWydvdmVybGF5QWxwaGEnXSB8fCBjaGFuZ2VzWydvdmVybGF5Q2xpY2tDbG9zZSddKSB7XHJcbiAgICAgICAgdGhpcy5kaWFsb2dPYmoub3B0aW9ucy5vdmVybGF5ID0gdGhpcy5vdmVybGF5O1xyXG4gICAgICAgIHRoaXMuZGlhbG9nT2JqLm9wdGlvbnMub3ZlcmxheUNvbG9yID0gdGhpcy5vdmVybGF5Q29sb3I7XHJcbiAgICAgICAgdGhpcy5kaWFsb2dPYmoub3B0aW9ucy5vdmVybGF5QWxwaGEgPSB0aGlzLm92ZXJsYXlBbHBoYTtcclxuICAgICAgICB0aGlzLmRpYWxvZ09iai5vcHRpb25zLm92ZXJsYXlDbGlja0Nsb3NlID0gdGhpcy5vdmVybGF5Q2xpY2tDbG9zZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XHJcbiAgICBpZiAodGhpcy5kaWFsb2dPYmopIHtcclxuICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgICB0aGlzLmRpYWxvZ09iai5lbGVtZW50LnJlbW92ZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0aGlzLmNsYXNzT2JzZXJ2ZXIpIHtcclxuICAgICAgdGhpcy5jbGFzc09ic2VydmVyLmRpc2Nvbm5lY3QoKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuIl19