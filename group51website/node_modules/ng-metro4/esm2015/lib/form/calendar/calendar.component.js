var CalendarComponent_1;
import { __decorate, __metadata } from "tslib";
import { ChangeDetectionStrategy, Component, ElementRef, Input, ViewChild, ViewEncapsulation } from '@angular/core';
import { ControlBase } from '../control-base';
import * as moment from 'moment';
import { DefaultValueAccessor } from '../../helper/default-value-accessor';
import { TypeAlias } from '../../helper/type-alias';
import { asapScheduler } from 'rxjs';
import { ObjectHelper } from '../../helper/object-helper';
const _moment = moment;
let CalendarComponent = CalendarComponent_1 = class CalendarComponent extends ControlBase {
    createControl() {
        return new Promise((complete) => {
            const originalElement = $(this.object.nativeElement);
            ObjectHelper.hide(originalElement);
            if (this.clonedElement) {
                this.clonedElement.remove();
            }
            this.clonedElement = originalElement.clone();
            ObjectHelper.show(this.clonedElement);
            originalElement.parent().append(this.clonedElement);
            this.calendar = this.clonedElement.calendar().data('calendar');
            asapScheduler.schedule(() => {
                this.clonedElement.find('.calendar-content .day, .calendar-content span, .calendar-footer button').on('click', () => {
                    this.touchCallback();
                    this.clonedElement.find('.calendar-content .day, .calendar-content span, .calendar-footer button').unbind('click');
                });
            });
            const selectDays = (selection) => {
                const dates = selection.map(s => _moment(s));
                if (this.multiSelect) {
                    this.changeValue(dates);
                }
                else {
                    this.changeValue(dates.length > 0 ? dates[0] : null);
                }
            };
            this.calendar.options.onDayClick = (selection) => {
                if (this.pickerMode) {
                    selectDays(selection);
                }
            };
            this.calendar.options.onDone = (selection) => {
                selectDays(selection);
            };
            complete();
        });
    }
    disable(disabled) {
        asapScheduler.schedule(() => {
            if (disabled) {
                this.clonedElement.addClass('disabled');
            }
            else {
                this.clonedElement.removeClass('disabled');
            }
        });
    }
    newValue() {
        if (!this.calendar) {
            return;
        }
        this.calendar.selected = [];
        asapScheduler.schedule(() => {
            if (this.innerValue) {
                if (this.multiSelect) {
                    this.calendar.setPreset(this.innerValue.map(v => v.format('MM/DD/YYYY')).join(','));
                }
                else {
                    this.calendar.setPreset(this.innerValue.format('MM/DD/YYYY'));
                }
            }
            else {
                this.calendar.setPreset('');
            }
        });
    }
    convertMomentArray(arr) {
        return arr ? arr.map(v => v.format('MM/DD/YYYY')).join(',') : null;
    }
    newClassValue(newClasses, oldClasses) {
        asapScheduler.schedule(() => {
            if (this.clonedElement) {
                const target = this.clonedElement;
                oldClasses.forEach((cls) => {
                    target.removeClass(cls);
                });
                newClasses.forEach((cls) => {
                    target.addClass(cls);
                });
            }
        });
    }
};
__decorate([
    Input('years-before'),
    __metadata("design:type", Number)
], CalendarComponent.prototype, "yearsBefore", void 0);
__decorate([
    Input('years-after'),
    __metadata("design:type", Number)
], CalendarComponent.prototype, "yearsAfter", void 0);
__decorate([
    Input('show'),
    __metadata("design:type", Object)
], CalendarComponent.prototype, "show", void 0);
__decorate([
    Input('picker-mode'),
    __metadata("design:type", Boolean)
], CalendarComponent.prototype, "pickerMode", void 0);
__decorate([
    Input('locale'),
    __metadata("design:type", String)
], CalendarComponent.prototype, "locale", void 0);
__decorate([
    Input('week-start'),
    __metadata("design:type", Number)
], CalendarComponent.prototype, "weekStart", void 0);
__decorate([
    Input('outside'),
    __metadata("design:type", Boolean)
], CalendarComponent.prototype, "outside", void 0);
__decorate([
    Input('buttons'),
    __metadata("design:type", Array)
], CalendarComponent.prototype, "buttons", void 0);
__decorate([
    Input('ripple'),
    __metadata("design:type", Boolean)
], CalendarComponent.prototype, "ripple", void 0);
__decorate([
    Input('ripple-color'),
    __metadata("design:type", String)
], CalendarComponent.prototype, "rippleColor", void 0);
__decorate([
    Input('exclude'),
    __metadata("design:type", Array)
], CalendarComponent.prototype, "exclude", void 0);
__decorate([
    Input('include'),
    __metadata("design:type", Array)
], CalendarComponent.prototype, "include", void 0);
__decorate([
    Input('min-date'),
    __metadata("design:type", Object)
], CalendarComponent.prototype, "minDate", void 0);
__decorate([
    Input('max-date'),
    __metadata("design:type", Object)
], CalendarComponent.prototype, "maxDate", void 0);
__decorate([
    Input('week-day-click'),
    __metadata("design:type", Boolean)
], CalendarComponent.prototype, "weekDayClick", void 0);
__decorate([
    Input('multi-select'),
    __metadata("design:type", Boolean)
], CalendarComponent.prototype, "multiSelect", void 0);
__decorate([
    Input('show-header'),
    __metadata("design:type", Boolean)
], CalendarComponent.prototype, "showHeader", void 0);
__decorate([
    Input('show-footer'),
    __metadata("design:type", Boolean)
], CalendarComponent.prototype, "showFooter", void 0);
__decorate([
    Input('wide-point'),
    __metadata("design:type", String)
], CalendarComponent.prototype, "widePoint", void 0);
__decorate([
    Input('wide'),
    __metadata("design:type", Boolean)
], CalendarComponent.prototype, "wide", void 0);
__decorate([
    Input('cls-today'),
    __metadata("design:type", String)
], CalendarComponent.prototype, "clsToday", void 0);
__decorate([
    Input('cls-selected'),
    __metadata("design:type", String)
], CalendarComponent.prototype, "clsSelected", void 0);
__decorate([
    Input('cls-exclude'),
    __metadata("design:type", String)
], CalendarComponent.prototype, "clsExclude", void 0);
__decorate([
    Input('cls-cancel-button'),
    __metadata("design:type", String)
], CalendarComponent.prototype, "clsCancelButton", void 0);
__decorate([
    Input('cls-today-button'),
    __metadata("design:type", String)
], CalendarComponent.prototype, "clsTodayButton", void 0);
__decorate([
    Input('cls-clear-button'),
    __metadata("design:type", String)
], CalendarComponent.prototype, "clsClearButton", void 0);
__decorate([
    Input('cls-done-button'),
    __metadata("design:type", String)
], CalendarComponent.prototype, "clsDoneButton", void 0);
__decorate([
    Input('cls-calendar'),
    __metadata("design:type", String)
], CalendarComponent.prototype, "clsCalendar", void 0);
__decorate([
    Input('cls-calendar-header'),
    __metadata("design:type", String)
], CalendarComponent.prototype, "clsCalendarHeader", void 0);
__decorate([
    Input('cls-calendar-content'),
    __metadata("design:type", String)
], CalendarComponent.prototype, "clsCalendarContent", void 0);
__decorate([
    Input('cls-calendar-footer'),
    __metadata("design:type", String)
], CalendarComponent.prototype, "clsCalendarFooter", void 0);
__decorate([
    Input('cls-calendar-months'),
    __metadata("design:type", String)
], CalendarComponent.prototype, "clsCalendarMonths", void 0);
__decorate([
    Input('cls-calendar-years'),
    __metadata("design:type", String)
], CalendarComponent.prototype, "clsCalendarYears", void 0);
__decorate([
    ViewChild('object', { static: true }),
    __metadata("design:type", ElementRef)
], CalendarComponent.prototype, "object", void 0);
CalendarComponent = CalendarComponent_1 = __decorate([
    Component({
        selector: 'm4-calendar',
        template: "<div #object\r\n\r\n\r\n     [attr.data-years-before]=\"yearsBefore\"\r\n     [attr.data-years-after]=\"yearsAfter\"\r\n     [attr.data-show]=\"show?.format('MM/DD/YYYY')\"\r\n     [attr.data-picker-mode]=\"pickerMode && !multiSelect\"\r\n     [attr.data-locale]=\"locale\"\r\n     [attr.data-week-start]=\"weekStart\"\r\n     [attr.data-outside]=\"outside\"\r\n     [attr.data-buttons]=\"buttons\"\r\n     [attr.data-ripple]=\"ripple\"\r\n     [attr.data-ripple-color]=\"rippleColor\"\r\n     [attr.data-exclude]=\"convertMomentArray(exclude)\"\r\n     [attr.data-special]=\"convertMomentArray(include)\"\r\n     [attr.data-min-date]=\"minDate?.format('MM/DD/YYYY')\"\r\n     [attr.data-max-date]=\"maxDate?.format('MM/DD/YYYY')\"\r\n     [attr.data-week-day-click]=\"weekDayClick\"\r\n     [attr.data-multi-select]=\"multiSelect\"\r\n     [attr.data-show-header]=\"showHeader\"\r\n     [attr.data-show-footer]=\"showFooter\"\r\n     [attr.data-wide-point]=\"widePoint\"\r\n     [attr.data-wide]=\"wide\"\r\n\r\n     [attr.data-cls-today]=\"clsToday\"\r\n     [attr.data-cls-selected]=\"clsSelected\"\r\n     [attr.data-cls-exclude]=\"clsExclude\"\r\n     [attr.data-cls-cancel-button]=\"clsCancelButton\"\r\n     [attr.data-cls-today-button]=\"clsTodayButton\"\r\n     [attr.data-cls-clear-button]=\"clsClearButton\"\r\n     [attr.data-cls-done-button]=\"clsDoneButton\"\r\n     [attr.data-cls-calendar]=\"clsCalendar\"\r\n     [attr.data-cls-calendar-header]=\"clsCalendarHeader\"\r\n     [attr.data-cls-calendar-content]=\"clsCalendarContent\"\r\n     [attr.data-cls-calendar-footer]=\"clsCalendarFooter\"\r\n     [attr.data-cls-calendar-months]=\"clsCalendarMonths\"\r\n     [attr.data-cls-calendar-years]=\"clsCalendarYears\">\r\n</div>\r\n",
        providers: [DefaultValueAccessor.get(CalendarComponent_1), TypeAlias.get(CalendarComponent_1)],
        encapsulation: ViewEncapsulation.None,
        changeDetection: ChangeDetectionStrategy.OnPush,
        styles: [".calendar.primary{border-color:#0366d6}.calendar.primary .calendar-content .day.selected{box-shadow:inset 0 0 0 1px #0366d6!important}.calendar.primary .calendar-content .day.selected::after{border-top-color:#0366d6}.calendar.primary .calendar-content .day.today,.calendar.primary .calendar-header{background-color:#0372ef}.calendar.secondary{border-color:#607d8b}.calendar.secondary .calendar-content .day.selected{box-shadow:inset 0 0 0 1px #607d8b!important}.calendar.secondary .calendar-content .day.selected::after{border-top-color:#607d8b}.calendar.secondary .calendar-content .day.today,.calendar.secondary .calendar-header{background-color:#6b8a99}.calendar.success{border-color:#60a917}.calendar.success .calendar-content .day.selected{box-shadow:inset 0 0 0 1px #60a917!important}.calendar.success .calendar-content .day.selected::after{border-top-color:#60a917}.calendar.success .calendar-content .day.today,.calendar.success .calendar-header{background-color:#6dbf1a}.calendar.alert{border-color:#ce352c}.calendar.alert .calendar-content .day.selected{box-shadow:inset 0 0 0 1px #ce352c!important}.calendar.alert .calendar-content .day.selected::after{border-top-color:#ce352c}.calendar.alert .calendar-content .day.today,.calendar.alert .calendar-header{background-color:#d6463e}.calendar.warning{border-color:#ff9447}.calendar.warning .calendar-content .day.selected{box-shadow:inset 0 0 0 1px #ff9447!important}.calendar.warning .calendar-content .day.selected::after{border-top-color:#ff9447}.calendar.warning .calendar-content .day.today,.calendar.warning .calendar-header{background-color:#ffa361}.calendar.yellow{border-color:#ffe484}.calendar.yellow .calendar-content .day.selected{box-shadow:inset 0 0 0 1px #ffe484!important}.calendar.yellow .calendar-content .day.selected::after{border-top-color:#ffe484}.calendar.yellow .calendar-content .day.today,.calendar.yellow .calendar-header{background-color:#ffea9e}.calendar.info{border-color:#5ebdec}.calendar.info .calendar-content .day.selected{box-shadow:inset 0 0 0 1px #5ebdec!important}.calendar.info .calendar-content .day.selected::after{border-top-color:#5ebdec}.calendar.info .calendar-content .day.today,.calendar.info .calendar-header{background-color:#75c7ee}.calendar.dark{border-color:#505050}.calendar.dark .calendar-content .day.selected{box-shadow:inset 0 0 0 1px #505050!important}.calendar.dark .calendar-content .day.selected::after{border-top-color:#505050}.calendar.dark .calendar-content .day.today,.calendar.dark .calendar-header{background-color:#5d5d5d}.calendar.light{border-color:#f8f8f8}.calendar.light .calendar-content .day.selected{box-shadow:inset 0 0 0 1px #f8f8f8!important}.calendar.light .calendar-content .day.selected::after{border-top-color:#f8f8f8}.calendar.light .calendar-content .day.today,.calendar.light .calendar-header{background-color:#fff}.calendar.disabled .calendar-content{color:#e4e4e4!important}.calendar.disabled .calendar-footer button{color:#e4e4e4!important;opacity:.65}"]
    })
], CalendarComponent);
export { CalendarComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FsZW5kYXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmctbWV0cm80LyIsInNvdXJjZXMiOlsibGliL2Zvcm0vY2FsZW5kYXIvY2FsZW5kYXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsT0FBTyxFQUFDLHVCQUF1QixFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxpQkFBaUIsRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUNsSCxPQUFPLEVBQUMsV0FBVyxFQUFDLE1BQU0saUJBQWlCLENBQUM7QUFDNUMsT0FBTyxLQUFLLE1BQU0sTUFBTSxRQUFRLENBQUM7QUFDakMsT0FBTyxFQUFDLG9CQUFvQixFQUFDLE1BQU0scUNBQXFDLENBQUM7QUFFekUsT0FBTyxFQUFDLFNBQVMsRUFBQyxNQUFNLHlCQUF5QixDQUFDO0FBQ2xELE9BQU8sRUFBQyxhQUFhLEVBQUMsTUFBTSxNQUFNLENBQUM7QUFDbkMsT0FBTyxFQUFDLFlBQVksRUFBQyxNQUFNLDRCQUE0QixDQUFDO0FBRXhELE1BQU0sT0FBTyxHQUFHLE1BQU0sQ0FBQztBQVd2QixJQUFhLGlCQUFpQix5QkFBOUIsTUFBYSxpQkFBa0IsU0FBUSxXQUEwQztJQXlDL0UsYUFBYTtRQUNYLE9BQU8sSUFBSSxPQUFPLENBQU8sQ0FBQyxRQUFRLEVBQUUsRUFBRTtZQUNwQyxNQUFNLGVBQWUsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsQ0FBQztZQUNyRCxZQUFZLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDO1lBRW5DLElBQUksSUFBSSxDQUFDLGFBQWEsRUFBRTtnQkFDdEIsSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLEVBQUUsQ0FBQzthQUM3QjtZQUVELElBQUksQ0FBQyxhQUFhLEdBQUcsZUFBZSxDQUFDLEtBQUssRUFBRSxDQUFDO1lBQzdDLFlBQVksQ0FBQyxJQUFJLENBQUMsSUFB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QUF0QixLQUFLLENBQUMsY0FBYyxDQUFDOztzREFBcUI7QUFDYjtJQUE3QixLQUFLLENBQUMscUJBQXFCLENBQUM7OzREQUEyQjtBQUN6QjtJQUE5QixLQUFLLENBQUMsc0JBQXNCLENBQUM7OzZEQUE0QjtBQUM1QjtJQUE3QixLQUFLLENBQUMscUJBQXFCLENBQUM7OzREQUEyQjtBQUMxQjtJQUE3QixLQUFLLENBQUMscUJBQXFCLENBQUM7OzREQUEyQjtBQUMzQjtJQUE1QixLQUFLLENBQUMsb0JBQW9CLENBQUM7OzJEQUEwQjtBQUVmO0lBQXRDLFNBQVMsQ0FBQyxRQUFRLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLENBQUM7OEJBQWlCLFVBQVU7aURBQUM7QUFyQ3ZELGlCQUFpQjtJQVI3QixTQUFTLENBQUM7UUFDVCxRQUFRLEVBQUUsYUFBYTtRQUN2Qiw4dERBQXdDO1FBRXhDLFNBQVMsRUFBRSxDQUFDLG9CQUFvQixDQUFDLEdBQUcsQ0FBQyxtQkFBaUIsQ0FBQyxFQUFFLFNBQVMsQ0FBQyxHQUFHLENBQUMsbUJBQWlCLENBQUMsQ0FBQztRQUMxRixhQUFhLEVBQUUsaUJBQWlCLENBQUMsSUFBSTtRQUNyQyxlQUFlLEVBQUUsdUJBQXVCLENBQUMsTUFBTTs7S0FDaEQsQ0FBQztHQUNXLGlCQUFpQixDQXdJN0I7U0F4SVksaUJBQWlCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSwgQ29tcG9uZW50LCBFbGVtZW50UmVmLCBJbnB1dCwgVmlld0NoaWxkLCBWaWV3RW5jYXBzdWxhdGlvbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7Q29udHJvbEJhc2V9IGZyb20gJy4uL2NvbnRyb2wtYmFzZSc7XHJcbmltcG9ydCAqIGFzIG1vbWVudCBmcm9tICdtb21lbnQnO1xyXG5pbXBvcnQge0RlZmF1bHRWYWx1ZUFjY2Vzc29yfSBmcm9tICcuLi8uLi9oZWxwZXIvZGVmYXVsdC12YWx1ZS1hY2Nlc3Nvcic7XHJcbmltcG9ydCB7Q2FsZW5kYXJCdXR0b25UeXBlLCBXaWRlUG9pbnRUeXBlfSBmcm9tICcuLi8uLi9oZWxwZXIvdHlwZXMnO1xyXG5pbXBvcnQge1R5cGVBbGlhc30gZnJvbSAnLi4vLi4vaGVscGVyL3R5cGUtYWxpYXMnO1xyXG5pbXBvcnQge2FzYXBTY2hlZHVsZXJ9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQge09iamVjdEhlbHBlcn0gZnJvbSAnLi4vLi4vaGVscGVyL29iamVjdC1oZWxwZXInO1xyXG5cclxuY29uc3QgX21vbWVudCA9IG1vbWVudDtcclxuZGVjbGFyZSB2YXIgJDogYW55O1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdtNC1jYWxlbmRhcicsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL2NhbGVuZGFyLmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi9jYWxlbmRhci5jb21wb25lbnQubGVzcyddLFxyXG4gIHByb3ZpZGVyczogW0RlZmF1bHRWYWx1ZUFjY2Vzc29yLmdldChDYWxlbmRhckNvbXBvbmVudCksIFR5cGVBbGlhcy5nZXQoQ2FsZW5kYXJDb21wb25lbnQpXSxcclxuICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lLFxyXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBDYWxlbmRhckNvbXBvbmVudCBleHRlbmRzIENvbnRyb2xCYXNlPG1vbWVudC5Nb21lbnR8bW9tZW50Lk1vbWVudFtdPiB7XHJcblxyXG4gIEBJbnB1dCgneWVhcnMtYmVmb3JlJykgeWVhcnNCZWZvcmU6IG51bWJlcjtcclxuICBASW5wdXQoJ3llYXJzLWFmdGVyJykgeWVhcnNBZnRlcjogbnVtYmVyO1xyXG4gIEBJbnB1dCgnc2hvdycpIHNob3c6IG1vbWVudC5Nb21lbnQ7XHJcbiAgQElucHV0KCdwaWNrZXItbW9kZScpIHBpY2tlck1vZGU6IGJvb2xlYW47XHJcbiAgQElucHV0KCdsb2NhbGUnKSBsb2NhbGU6IHN0cmluZztcclxuICBASW5wdXQoJ3dlZWstc3RhcnQnKSB3ZWVrU3RhcnQ6IDB8MTtcclxuICBASW5wdXQoJ291dHNpZGUnKSBvdXRzaWRlOiBib29sZWFuO1xyXG4gIEBJbnB1dCgnYnV0dG9ucycpIGJ1dHRvbnM6IENhbGVuZGFyQnV0dG9uVHlwZVtdO1xyXG4gIEBJbnB1dCgncmlwcGxlJykgcmlwcGxlOiBib29sZWFuO1xyXG4gIEBJbnB1dCgncmlwcGxlLWNvbG9yJykgcmlwcGxlQ29sb3I6IHN0cmluZztcclxuICBASW5wdXQoJ2V4Y2x1ZGUnKSBleGNsdWRlOiBtb21lbnQuTW9tZW50W107XHJcbiAgQElucHV0KCdpbmNsdWRlJykgaW5jbHVkZTogbW9tZW50Lk1vbWVudFtdO1xyXG4gIEBJbnB1dCgnbWluLWRhdGUnKSBtaW5EYXRlOiBtb21lbnQuTW9tZW50O1xyXG4gIEBJbnB1dCgnbWF4LWRhdGUnKSBtYXhEYXRlOiBtb21lbnQuTW9tZW50O1xyXG4gIEBJbnB1dCgnd2Vlay1kYXktY2xpY2snKSB3ZWVrRGF5Q2xpY2s6IGJvb2xlYW47XHJcbiAgQElucHV0KCdtdWx0aS1zZWxlY3QnKSBtdWx0aVNlbGVjdDogYm9vbGVhbjtcclxuICBASW5wdXQoJ3Nob3ctaGVhZGVyJykgc2hvd0hlYWRlcjogYm9vbGVhbjtcclxuICBASW5wdXQoJ3Nob3ctZm9vdGVyJykgc2hvd0Zvb3RlcjogYm9vbGVhbjtcclxuICBASW5wdXQoJ3dpZGUtcG9pbnQnKSB3aWRlUG9pbnQ6IFdpZGVQb2ludFR5cGU7XHJcbiAgQElucHV0KCd3aWRlJykgd2lkZTogYm9vbGVhbjtcclxuXHJcbiAgQElucHV0KCdjbHMtdG9kYXknKSBjbHNUb2RheTogc3RyaW5nO1xyXG4gIEBJbnB1dCgnY2xzLXNlbGVjdGVkJykgY2xzU2VsZWN0ZWQ6IHN0cmluZztcclxuICBASW5wdXQoJ2Nscy1leGNsdWRlJykgY2xzRXhjbHVkZTogc3RyaW5nO1xyXG4gIEBJbnB1dCgnY2xzLWNhbmNlbC1idXR0b24nKSBjbHNDYW5jZWxCdXR0b246IHN0cmluZztcclxuICBASW5wdXQoJ2Nscy10b2RheS1idXR0b24nKSBjbHNUb2RheUJ1dHRvbjogc3RyaW5nO1xyXG4gIEBJbnB1dCgnY2xzLWNsZWFyLWJ1dHRvbicpIGNsc0NsZWFyQnV0dG9uOiBzdHJpbmc7XHJcbiAgQElucHV0KCdjbHMtZG9uZS1idXR0b24nKSBjbHNEb25lQnV0dG9uOiBzdHJpbmc7XHJcbiAgQElucHV0KCdjbHMtY2FsZW5kYXInKSBjbHNDYWxlbmRhcjogc3RyaW5nO1xyXG4gIEBJbnB1dCgnY2xzLWNhbGVuZGFyLWhlYWRlcicpIGNsc0NhbGVuZGFySGVhZGVyOiBzdHJpbmc7XHJcbiAgQElucHV0KCdjbHMtY2FsZW5kYXItY29udGVudCcpIGNsc0NhbGVuZGFyQ29udGVudDogc3RyaW5nO1xyXG4gIEBJbnB1dCgnY2xzLWNhbGVuZGFyLWZvb3RlcicpIGNsc0NhbGVuZGFyRm9vdGVyOiBzdHJpbmc7XHJcbiAgQElucHV0KCdjbHMtY2FsZW5kYXItbW9udGhzJykgY2xzQ2FsZW5kYXJNb250aHM6IHN0cmluZztcclxuICBASW5wdXQoJ2Nscy1jYWxlbmRhci15ZWFycycpIGNsc0NhbGVuZGFyWWVhcnM6IHN0cmluZztcclxuXHJcbiAgQFZpZXdDaGlsZCgnb2JqZWN0JywgeyBzdGF0aWM6IHRydWUgfSkgcHJpdmF0ZSBvYmplY3Q6IEVsZW1lbnRSZWY7XHJcbiAgcHJpdmF0ZSBjYWxlbmRhcjogYW55O1xyXG4gIHByaXZhdGUgY2xvbmVkRWxlbWVudDogYW55O1xyXG5cclxuICBjcmVhdGVDb250cm9sKCkge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlPHZvaWQ+KChjb21wbGV0ZSkgPT4ge1xyXG4gICAgICBjb25zdCBvcmlnaW5hbEVsZW1lbnQgPSAkKHRoaXMub2JqZWN0Lm5hdGl2ZUVsZW1lbnQpO1xyXG4gICAgICBPYmplY3RIZWxwZXIuaGlkZShvcmlnaW5hbEVsZW1lbnQpO1xyXG5cclxuICAgICAgaWYgKHRoaXMuY2xvbmVkRWxlbWVudCkge1xyXG4gICAgICAgIHRoaXMuY2xvbmVkRWxlbWVudC5yZW1vdmUoKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgdGhpcy5jbG9uZWRFbGVtZW50ID0gb3JpZ2luYWxFbGVtZW50LmNsb25lKCk7XHJcbiAgICAgIE9iamVjdEhlbHBlci5zaG93KHRoaXMuY2xvbmVkRWxlbWVudCk7XHJcbiAgICAgIG9yaWdpbmFsRWxlbWVudC5wYXJlbnQoKS5hcHBlbmQodGhpcy5jbG9uZWRFbGVtZW50KTtcclxuXHJcbiAgICAgIHRoaXMuY2FsZW5kYXIgPSB0aGlzLmNsb25lZEVsZW1lbnQuY2FsZW5kYXIoKS5kYXRhKCdjYWxlbmRhcicpO1xyXG5cclxuICAgICAgYXNhcFNjaGVkdWxlci5zY2hlZHVsZSgoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5jbG9uZWRFbGVtZW50LmZpbmQoJy5jYWxlbmRhci1jb250ZW50IC5kYXksIC5jYWxlbmRhci1jb250ZW50IHNwYW4sIC5jYWxlbmRhci1mb290ZXIgYnV0dG9uJykub24oJ2NsaWNrJywgKCkgPT4ge1xyXG4gICAgICAgICAgdGhpcy50b3VjaENhbGxiYWNrKCk7XHJcbiAgICAgICAgICB0aGlzLmNsb25lZEVsZW1lbnQuZmluZCgnLmNhbGVuZGFyLWNvbnRlbnQgLmRheSwgLmNhbGVuZGFyLWNvbnRlbnQgc3BhbiwgLmNhbGVuZGFyLWZvb3RlciBidXR0b24nKS51bmJpbmQoJ2NsaWNrJyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgY29uc3Qgc2VsZWN0RGF5cyA9IChzZWxlY3Rpb24pID0+IHtcclxuICAgICAgICBjb25zdCBkYXRlcyA9IHNlbGVjdGlvbi5tYXAocyA9PiBfbW9tZW50KHMpKTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMubXVsdGlTZWxlY3QpIHtcclxuICAgICAgICAgIHRoaXMuY2hhbmdlVmFsdWUoZGF0ZXMpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0aGlzLmNoYW5nZVZhbHVlKGRhdGVzLmxlbmd0aCA+IDAgPyBkYXRlc1swXSA6IG51bGwpO1xyXG4gICAgICAgIH1cclxuICAgICAgfTtcclxuXHJcbiAgICAgIHRoaXMuY2FsZW5kYXIub3B0aW9ucy5vbkRheUNsaWNrID0gKHNlbGVjdGlvbikgPT4ge1xyXG4gICAgICAgIGlmICh0aGlzLnBpY2tlck1vZGUpIHtcclxuICAgICAgICAgIHNlbGVjdERheXMoc2VsZWN0aW9uKTtcclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcblxyXG4gICAgICB0aGlzLmNhbGVuZGFyLm9wdGlvbnMub25Eb25lID0gKHNlbGVjdGlvbikgPT4ge1xyXG4gICAgICAgIHNlbGVjdERheXMoc2VsZWN0aW9uKTtcclxuICAgICAgfTtcclxuXHJcbiAgICAgIGNvbXBsZXRlKCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGRpc2FibGUoZGlzYWJsZWQ6IGJvb2xlYW4pOiB2b2lkIHtcclxuICAgIGFzYXBTY2hlZHVsZXIuc2NoZWR1bGUoKCkgPT4ge1xyXG4gICAgICBpZiAoZGlzYWJsZWQpIHtcclxuICAgICAgICB0aGlzLmNsb25lZEVsZW1lbnQuYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5jbG9uZWRFbGVtZW50LnJlbW92ZUNsYXNzKCdkaXNhYmxlZCcpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIG5ld1ZhbHVlKCk6IHZvaWQge1xyXG4gICAgaWYgKCF0aGlzLmNhbGVuZGFyKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmNhbGVuZGFyLnNlbGVjdGVkID0gW107XHJcblxyXG4gICAgYXNhcFNjaGVkdWxlci5zY2hlZHVsZSgoKSA9PiB7XHJcbiAgICAgIGlmICh0aGlzLmlubmVyVmFsdWUpIHtcclxuICAgICAgICBpZiAodGhpcy5tdWx0aVNlbGVjdCkge1xyXG4gICAgICAgICAgdGhpcy5jYWxlbmRhci5zZXRQcmVzZXQoKDxtb21lbnQuTW9tZW50W10+dGhpcy5pbm5lclZhbHVlKS5tYXAodiA9PiB2LmZvcm1hdCgnTU0vREQvWVlZWScpKS5qb2luKCcsJykpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0aGlzLmNhbGVuZGFyLnNldFByZXNldCgoPG1vbWVudC5Nb21lbnQ+dGhpcy5pbm5lclZhbHVlKS5mb3JtYXQoJ01NL0REL1lZWVknKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMuY2FsZW5kYXIuc2V0UHJlc2V0KCcnKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBjb252ZXJ0TW9tZW50QXJyYXkoYXJyOiBtb21lbnQuTW9tZW50W10pIHtcclxuICAgIHJldHVybiBhcnIgPyBhcnIubWFwKHYgPT4gdi5mb3JtYXQoJ01NL0REL1lZWVknKSkuam9pbignLCcpIDogbnVsbDtcclxuICB9XHJcblxyXG4gIG5ld0NsYXNzVmFsdWUobmV3Q2xhc3Nlczogc3RyaW5nW10sIG9sZENsYXNzZXM6IHN0cmluZ1tdKSB7XHJcbiAgICBhc2FwU2NoZWR1bGVyLnNjaGVkdWxlKCgpID0+IHtcclxuICAgICAgaWYgKHRoaXMuY2xvbmVkRWxlbWVudCkge1xyXG4gICAgICAgIGNvbnN0IHRhcmdldCA9IHRoaXMuY2xvbmVkRWxlbWVudDtcclxuXHJcbiAgICAgICAgb2xkQ2xhc3Nlcy5mb3JFYWNoKChjbHM6IHN0cmluZykgPT4ge1xyXG4gICAgICAgICAgdGFyZ2V0LnJlbW92ZUNsYXNzKGNscyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIG5ld0NsYXNzZXMuZm9yRWFjaCgoY2xzOiBzdHJpbmcpID0+IHtcclxuICAgICAgICAgIHRhcmdldC5hZGRDbGFzcyhjbHMpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuIl19