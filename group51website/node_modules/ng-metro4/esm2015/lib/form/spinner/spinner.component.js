var SpinnerComponent_1;
import { __decorate, __metadata } from "tslib";
import { ChangeDetectionStrategy, Component, ElementRef, Input, ViewChild } from '@angular/core';
import { ControlBase } from '../control-base';
import { DefaultValueAccessor } from '../../helper/default-value-accessor';
import { TypeAlias } from '../../helper/type-alias';
import { asapScheduler } from 'rxjs';
import { ObjectHelper } from '../../helper/object-helper';
let SpinnerComponent = SpinnerComponent_1 = class SpinnerComponent extends ControlBase {
    constructor() {
        super(...arguments);
        this.step = 1;
        this.fixed = 0;
        this.hideCursor = false;
    }
    createControl() {
        return new Promise((complete) => {
            const originalElement = $(this.input.nativeElement);
            ObjectHelper.hide(originalElement);
            if (this.clonedElement) {
                this.clonedElement.parent().remove();
            }
            this.clonedElement = originalElement.clone();
            ObjectHelper.show(this.clonedElement);
            originalElement.parent().append(this.clonedElement);
            this.spinner = this.clonedElement.spinner().data('spinner');
            this.clonedElement.parent().off('mousedown mouseup keydown change');
            this.clonedElement.one('blur', () => {
                this.touchCallback();
            });
            this.clonedElement.on('change', () => {
                if (this.disableUpdate) {
                    return;
                }
                const newVal = +this.clonedElement.val();
                this.changeValue(newVal);
                this.setValue(newVal);
            });
            complete();
        });
    }
    disable(disabled) {
        if (disabled) {
            this.spinner.disable();
        }
        else {
            this.spinner.enable();
        }
    }
    setValue(newValue) {
        if (this.minValue !== undefined && this.minValue !== null && newValue < this.minValue) {
            newValue = this.minValue;
            asapScheduler.schedule(() => {
                this.changeValue(newValue);
            });
        }
        if (this.maxValue !== undefined && this.maxValue !== null && newValue > this.maxValue) {
            newValue = this.maxValue;
            asapScheduler.schedule(() => {
                this.changeValue(newValue);
            });
        }
        this.clonedElement.val(newValue.toFixed(this.fixed));
    }
    newValue() {
        if (!this.spinner || !this.innerValue) {
            return;
        }
        this.setValue(this.innerValue);
    }
    newClassValue(newClasses, oldClasses) {
        if (this.clonedElement) {
            const target = this.clonedElement.parent();
            oldClasses.forEach((cls) => {
                target.removeClass(cls);
            });
            newClasses.forEach((cls) => {
                target.addClass(cls);
            });
        }
    }
};
__decorate([
    Input('step'),
    __metadata("design:type", Object)
], SpinnerComponent.prototype, "step", void 0);
__decorate([
    Input('plus-icon'),
    __metadata("design:type", String)
], SpinnerComponent.prototype, "plusIcon", void 0);
__decorate([
    Input('minus-icon'),
    __metadata("design:type", String)
], SpinnerComponent.prototype, "minusIcon", void 0);
__decorate([
    Input('buttons-position'),
    __metadata("design:type", String)
], SpinnerComponent.prototype, "buttonsPosition", void 0);
__decorate([
    Input('min-value'),
    __metadata("design:type", Number)
], SpinnerComponent.prototype, "minValue", void 0);
__decorate([
    Input('max-value'),
    __metadata("design:type", Number)
], SpinnerComponent.prototype, "maxValue", void 0);
__decorate([
    Input('fixed'),
    __metadata("design:type", Object)
], SpinnerComponent.prototype, "fixed", void 0);
__decorate([
    Input('hide-cursor'),
    __metadata("design:type", Object)
], SpinnerComponent.prototype, "hideCursor", void 0);
__decorate([
    Input('cls-spinner'),
    __metadata("design:type", String)
], SpinnerComponent.prototype, "clsSpinner", void 0);
__decorate([
    Input('cls-spinner-input'),
    __metadata("design:type", String)
], SpinnerComponent.prototype, "clsSpinnerInput", void 0);
__decorate([
    Input('cls-spinner-button'),
    __metadata("design:type", String)
], SpinnerComponent.prototype, "clsSpinnerButton", void 0);
__decorate([
    Input('cls-spinner-button-plus'),
    __metadata("design:type", String)
], SpinnerComponent.prototype, "clsSpinnerButtonPlus", void 0);
__decorate([
    Input('cls-spinner-button-minus'),
    __metadata("design:type", String)
], SpinnerComponent.prototype, "clsSpinnerButtonMinus", void 0);
__decorate([
    ViewChild('input', { static: true }),
    __metadata("design:type", ElementRef)
], SpinnerComponent.prototype, "input", void 0);
SpinnerComponent = SpinnerComponent_1 = __decorate([
    Component({
        selector: 'm4-spinner',
        template: "<input type=\"text\" #input\r\n\r\n\r\n       [attr.data-step]=\"step\"\r\n       [attr.data-fixed]=\"fixed\"\r\n       [attr.data-plus-icon]=\"plusIcon\"\r\n       [attr.data-minus-icon]=\"minusIcon\"\r\n       [attr.data-buttons-position]=\"buttonsPosition\"\r\n\r\n       [attr.data-hide-cursor]=\"hideCursor\"\r\n       [style.textShadow]=\"hideCursor ? '0 0 0 #1d1d1d' : null\"\r\n\r\n       [attr.data-cls-spinner]=\"clsSpinner\"\r\n       [attr.data-cls-spinner-input]=\"clsSpinnerInput\"\r\n       [attr.data-cls-spinner-button]=\"clsSpinnerButton\"\r\n       [attr.data-cls-spinner-button-minus]=\"clsSpinnerButtonMinus\"\r\n       [attr.data-cls-spinner-button-plus]=\"clsSpinnerButtonPlus\" >\r\n",
        providers: [DefaultValueAccessor.get(SpinnerComponent_1), TypeAlias.get(SpinnerComponent_1)],
        changeDetection: ChangeDetectionStrategy.OnPush,
        styles: [""]
    })
], SpinnerComponent);
export { SpinnerComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3Bpbm5lci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZy1tZXRybzQvIiwic291cmNlcyI6WyJsaWIvZm9ybS9zcGlubmVyL3NwaW5uZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsT0FBTyxFQUFDLHVCQUF1QixFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUMvRixPQUFPLEVBQUMsV0FBVyxFQUFDLE1BQU0saUJBQWlCLENBQUM7QUFDNUMsT0FBTyxFQUFDLG9CQUFvQixFQUFDLE1BQU0scUNBQXFDLENBQUM7QUFDekUsT0FBTyxFQUFDLFNBQVMsRUFBQyxNQUFNLHlCQUF5QixDQUFDO0FBQ2xELE9BQU8sRUFBQyxhQUFhLEVBQUMsTUFBTSxNQUFNLENBQUM7QUFFbkMsT0FBTyxFQUFDLFlBQVksRUFBQyxNQUFNLDRCQUE0QixDQUFDO0FBV3hELElBQWEsZ0JBQWdCLHdCQUE3QixNQUFhLGdCQUFpQixTQUFRLFdBQW1CO0lBQXpEOztRQUVpQixTQUFJLEdBQUcsQ0FBQyxDQUFDO1FBTVIsVUFBSyxHQUFHLENBQUMsQ0FBQztRQUNKLGVBQVUsR0FBRyxLQUFLLENBQUM7SUFrRzNDLENBQUM7SUF0RkMsYUFBYTtRQUNYLE9BQU8sSUFBSSxPQUFPLENBQU8sQ0FBQyxRQUFRLEVBQUUsRUFBRTtZQUNwQyxNQUFNLGVBQWUsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxhQUFhLENBQUMsQ0FBQztZQUNwRCxZQUFZLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDO1lBRW5DLElBQUksSUFBSSxDQUFDLGFBQWEsRUFBRTtnQkFDdEIsSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxNQUFNLEVBQUUsQ0FBQzthQUN0QztZQUVELElBQUksQ0FBQyxhQUFhLEdBQUcsZUFBZSxDQUFDLEtBQUssRUFBRSxDQUFDO1lB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LGtCQUFnQixDQUFDLENBQUM7UUFDeEYsZUFBZSxFQUFFLHVCQUF1QixDQUFDLE1BQU07O0tBQ2hELENBQUM7R0FDVyxnQkFBZ0IsQ0EyRzVCO1NBM0dZLGdCQUFnQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7Q2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksIENvbXBvbmVudCwgRWxlbWVudFJlZiwgSW5wdXQsIFZpZXdDaGlsZH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7Q29udHJvbEJhc2V9IGZyb20gJy4uL2NvbnRyb2wtYmFzZSc7XHJcbmltcG9ydCB7RGVmYXVsdFZhbHVlQWNjZXNzb3J9IGZyb20gJy4uLy4uL2hlbHBlci9kZWZhdWx0LXZhbHVlLWFjY2Vzc29yJztcclxuaW1wb3J0IHtUeXBlQWxpYXN9IGZyb20gJy4uLy4uL2hlbHBlci90eXBlLWFsaWFzJztcclxuaW1wb3J0IHthc2FwU2NoZWR1bGVyfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHtTcGlubmVyQnV0dG9uUG9zaXRpb25UeXBlfSBmcm9tICcuLi8uLi9oZWxwZXIvdHlwZXMnO1xyXG5pbXBvcnQge09iamVjdEhlbHBlcn0gZnJvbSAnLi4vLi4vaGVscGVyL29iamVjdC1oZWxwZXInO1xyXG5cclxuZGVjbGFyZSB2YXIgJDogYW55O1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdtNC1zcGlubmVyJyxcclxuICB0ZW1wbGF0ZVVybDogJy4vc3Bpbm5lci5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vc3Bpbm5lci5jb21wb25lbnQuY3NzJ10sXHJcbiAgcHJvdmlkZXJzOiBbRGVmYXVsdFZhbHVlQWNjZXNzb3IuZ2V0KFNwaW5uZXJDb21wb25lbnQpLCBUeXBlQWxpYXMuZ2V0KFNwaW5uZXJDb21wb25lbnQpXSxcclxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaFxyXG59KVxyXG5leHBvcnQgY2xhc3MgU3Bpbm5lckNvbXBvbmVudCBleHRlbmRzIENvbnRyb2xCYXNlPG51bWJlcj4ge1xyXG5cclxuICBASW5wdXQoJ3N0ZXAnKSBzdGVwID0gMTtcclxuICBASW5wdXQoJ3BsdXMtaWNvbicpIHBsdXNJY29uOiBzdHJpbmc7XHJcbiAgQElucHV0KCdtaW51cy1pY29uJykgbWludXNJY29uOiBzdHJpbmc7XHJcbiAgQElucHV0KCdidXR0b25zLXBvc2l0aW9uJykgYnV0dG9uc1Bvc2l0aW9uOiBTcGlubmVyQnV0dG9uUG9zaXRpb25UeXBlO1xyXG4gIEBJbnB1dCgnbWluLXZhbHVlJykgbWluVmFsdWU6IG51bWJlcjtcclxuICBASW5wdXQoJ21heC12YWx1ZScpIG1heFZhbHVlOiBudW1iZXI7XHJcbiAgQElucHV0KCdmaXhlZCcpIGZpeGVkID0gMDtcclxuICBASW5wdXQoJ2hpZGUtY3Vyc29yJykgaGlkZUN1cnNvciA9IGZhbHNlO1xyXG5cclxuICBASW5wdXQoJ2Nscy1zcGlubmVyJykgY2xzU3Bpbm5lcjogc3RyaW5nO1xyXG4gIEBJbnB1dCgnY2xzLXNwaW5uZXItaW5wdXQnKSBjbHNTcGlubmVySW5wdXQ6IHN0cmluZztcclxuICBASW5wdXQoJ2Nscy1zcGlubmVyLWJ1dHRvbicpIGNsc1NwaW5uZXJCdXR0b246IHN0cmluZztcclxuICBASW5wdXQoJ2Nscy1zcGlubmVyLWJ1dHRvbi1wbHVzJykgY2xzU3Bpbm5lckJ1dHRvblBsdXM6IHN0cmluZztcclxuICBASW5wdXQoJ2Nscy1zcGlubmVyLWJ1dHRvbi1taW51cycpIGNsc1NwaW5uZXJCdXR0b25NaW51czogc3RyaW5nO1xyXG5cclxuICBAVmlld0NoaWxkKCdpbnB1dCcsIHsgc3RhdGljOiB0cnVlIH0pIHByaXZhdGUgaW5wdXQ6IEVsZW1lbnRSZWY7XHJcbiAgcHJpdmF0ZSBzcGlubmVyOiBhbnk7XHJcbiAgcHJpdmF0ZSBjbG9uZWRFbGVtZW50OiBhbnk7XHJcblxyXG4gIGNyZWF0ZUNvbnRyb2woKSB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2U8dm9pZD4oKGNvbXBsZXRlKSA9PiB7XHJcbiAgICAgIGNvbnN0IG9yaWdpbmFsRWxlbWVudCA9ICQodGhpcy5pbnB1dC5uYXRpdmVFbGVtZW50KTtcclxuICAgICAgT2JqZWN0SGVscGVyLmhpZGUob3JpZ2luYWxFbGVtZW50KTtcclxuXHJcbiAgICAgIGlmICh0aGlzLmNsb25lZEVsZW1lbnQpIHtcclxuICAgICAgICB0aGlzLmNsb25lZEVsZW1lbnQucGFyZW50KCkucmVtb3ZlKCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHRoaXMuY2xvbmVkRWxlbWVudCA9IG9yaWdpbmFsRWxlbWVudC5jbG9uZSgpO1xyXG4gICAgICBPYmplY3RIZWxwZXIuc2hvdyh0aGlzLmNsb25lZEVsZW1lbnQpO1xyXG4gICAgICBvcmlnaW5hbEVsZW1lbnQucGFyZW50KCkuYXBwZW5kKHRoaXMuY2xvbmVkRWxlbWVudCk7XHJcblxyXG4gICAgICB0aGlzLnNwaW5uZXIgPSB0aGlzLmNsb25lZEVsZW1lbnQuc3Bpbm5lcigpLmRhdGEoJ3NwaW5uZXInKTtcclxuXHJcbiAgICAgIHRoaXMuY2xvbmVkRWxlbWVudC5wYXJlbnQoKS5vZmYoJ21vdXNlZG93biBtb3VzZXVwIGtleWRvd24gY2hhbmdlJyk7XHJcblxyXG4gICAgICB0aGlzLmNsb25lZEVsZW1lbnQub25lKCdibHVyJywgKCkgPT4ge1xyXG4gICAgICAgIHRoaXMudG91Y2hDYWxsYmFjaygpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIHRoaXMuY2xvbmVkRWxlbWVudC5vbignY2hhbmdlJywgKCkgPT4ge1xyXG4gICAgICAgIGlmICh0aGlzLmRpc2FibGVVcGRhdGUpIHtcclxuICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IG5ld1ZhbCA9ICt0aGlzLmNsb25lZEVsZW1lbnQudmFsKCk7XHJcblxyXG4gICAgICAgIHRoaXMuY2hhbmdlVmFsdWUobmV3VmFsKTtcclxuICAgICAgICB0aGlzLnNldFZhbHVlKG5ld1ZhbCk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgY29tcGxldGUoKTtcclxuICAgIH0pO1xyXG5cclxuICB9XHJcblxyXG4gIGRpc2FibGUoZGlzYWJsZWQ6IGJvb2xlYW4pOiB2b2lkIHtcclxuICAgIGlmIChkaXNhYmxlZCkge1xyXG4gICAgICB0aGlzLnNwaW5uZXIuZGlzYWJsZSgpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5zcGlubmVyLmVuYWJsZSgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgc2V0VmFsdWUobmV3VmFsdWU6IG51bWJlcikge1xyXG4gICAgaWYgKHRoaXMubWluVmFsdWUgIT09IHVuZGVmaW5lZCAmJiB0aGlzLm1pblZhbHVlICE9PSBudWxsICYmIG5ld1ZhbHVlIDwgdGhpcy5taW5WYWx1ZSkge1xyXG4gICAgICBuZXdWYWx1ZSA9IHRoaXMubWluVmFsdWU7XHJcblxyXG4gICAgICBhc2FwU2NoZWR1bGVyLnNjaGVkdWxlKCgpID0+IHtcclxuICAgICAgICB0aGlzLmNoYW5nZVZhbHVlKG5ld1ZhbHVlKTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMubWF4VmFsdWUgIT09IHVuZGVmaW5lZCAmJiB0aGlzLm1heFZhbHVlICE9PSBudWxsICYmIG5ld1ZhbHVlID4gdGhpcy5tYXhWYWx1ZSkge1xyXG4gICAgICBuZXdWYWx1ZSA9IHRoaXMubWF4VmFsdWU7XHJcblxyXG4gICAgICBhc2FwU2NoZWR1bGVyLnNjaGVkdWxlKCgpID0+IHtcclxuICAgICAgICB0aGlzLmNoYW5nZVZhbHVlKG5ld1ZhbHVlKTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5jbG9uZWRFbGVtZW50LnZhbChuZXdWYWx1ZS50b0ZpeGVkKHRoaXMuZml4ZWQpKTtcclxuICB9XHJcblxyXG4gIG5ld1ZhbHVlKCk6IHZvaWQge1xyXG4gICAgaWYgKCF0aGlzLnNwaW5uZXIgfHwgIXRoaXMuaW5uZXJWYWx1ZSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5zZXRWYWx1ZSh0aGlzLmlubmVyVmFsdWUpO1xyXG4gIH1cclxuXHJcbiAgbmV3Q2xhc3NWYWx1ZShuZXdDbGFzc2VzOiBzdHJpbmdbXSwgb2xkQ2xhc3Nlczogc3RyaW5nW10pIHtcclxuICAgIGlmICh0aGlzLmNsb25lZEVsZW1lbnQpIHtcclxuICAgICAgY29uc3QgdGFyZ2V0ID0gdGhpcy5jbG9uZWRFbGVtZW50LnBhcmVudCgpO1xyXG5cclxuICAgICAgb2xkQ2xhc3Nlcy5mb3JFYWNoKChjbHM6IHN0cmluZykgPT4ge1xyXG4gICAgICAgIHRhcmdldC5yZW1vdmVDbGFzcyhjbHMpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIG5ld0NsYXNzZXMuZm9yRWFjaCgoY2xzOiBzdHJpbmcpID0+IHtcclxuICAgICAgICB0YXJnZXQuYWRkQ2xhc3MoY2xzKTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcbiJdfQ==