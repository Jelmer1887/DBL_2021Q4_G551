var RatingComponent_1;
import { __decorate, __metadata } from "tslib";
import { ChangeDetectionStrategy, Component, ElementRef, Input, ViewChild, ViewEncapsulation } from '@angular/core';
import { ControlBase } from '../control-base';
import { DefaultValueAccessor } from '../../helper/default-value-accessor';
import { TypeAlias } from '../../helper/type-alias';
import { asapScheduler } from 'rxjs';
import { ObjectHelper } from '../../helper/object-helper';
let RatingComponent = RatingComponent_1 = class RatingComponent extends ControlBase {
    createControl() {
        return new Promise((complete) => {
            const originalElement = $(this.input.nativeElement);
            ObjectHelper.hide(originalElement);
            if (this.clonedElement) {
                this.clonedElement.parent().remove();
            }
            this.clonedElement = originalElement.clone();
            ObjectHelper.show(this.clonedElement);
            originalElement.parent().append(this.clonedElement);
            this.rating = this.clonedElement.rating().data('rating');
            this.clonedElement.parent().find('ul li').one('click', () => {
                this.touchCallback();
            });
            this.clonedElement.on('change', () => {
                const newValue = this.clonedElement.val();
                const valueParsed = +newValue;
                if (!Number.isNaN(valueParsed)) {
                    this.changeValue(valueParsed);
                }
                else {
                    this.changeValue(newValue);
                }
            });
            complete();
        });
    }
    disable(disabled) {
        if (disabled) {
            this.clonedElement.parent().parent().addClass('disabled');
        }
        else {
            this.clonedElement.parent().parent().removeClass('disabled');
        }
    }
    newValue() {
        if (!this.rating) {
            return;
        }
        const stars = this.clonedElement.parent().find('ul li');
        stars.removeClass('on');
        if (this.values) {
            const index = this.values.indexOf(this.innerValue);
            if (index !== -1) {
                for (let i = 0; i <= index; i++) {
                    $(stars.get(i)).addClass('on');
                }
            }
        }
        else {
            this.rating.val(this.innerValue);
        }
    }
    newClassValue(newClasses, oldClasses) {
        asapScheduler.schedule(() => {
            if (this.clonedElement) {
                const target = this.clonedElement.parent();
                oldClasses.forEach((cls) => {
                    target.removeClass(cls);
                });
                newClasses.forEach((cls) => {
                    target.addClass(cls);
                });
            }
        });
    }
};
__decorate([
    Input('stars'),
    __metadata("design:type", Number)
], RatingComponent.prototype, "stars", void 0);
__decorate([
    Input('round-func'),
    __metadata("design:type", String)
], RatingComponent.prototype, "roundFunc", void 0);
__decorate([
    Input('values'),
    __metadata("design:type", Array)
], RatingComponent.prototype, "values", void 0);
__decorate([
    Input('message'),
    __metadata("design:type", String)
], RatingComponent.prototype, "message", void 0);
__decorate([
    Input('star-color'),
    __metadata("design:type", String)
], RatingComponent.prototype, "starColor", void 0);
__decorate([
    Input('stared-color'),
    __metadata("design:type", String)
], RatingComponent.prototype, "staredColor", void 0);
__decorate([
    Input('static'),
    __metadata("design:type", Boolean)
], RatingComponent.prototype, "static", void 0);
__decorate([
    Input('cls-rating'),
    __metadata("design:type", String)
], RatingComponent.prototype, "clsRating", void 0);
__decorate([
    Input('cls-stars'),
    __metadata("design:type", String)
], RatingComponent.prototype, "clsStars", void 0);
__decorate([
    Input('cls-result'),
    __metadata("design:type", String)
], RatingComponent.prototype, "clsResult", void 0);
__decorate([
    ViewChild('input', { static: true }),
    __metadata("design:type", ElementRef)
], RatingComponent.prototype, "input", void 0);
RatingComponent = RatingComponent_1 = __decorate([
    Component({
        selector: 'm4-rating',
        template: "<input type=\"text\" #input\r\n\r\n\r\n       [attr.data-stars]=\"values ? values.length : stars\"\r\n       [attr.data-round-func]=\"roundFunc\"\r\n       [attr.data-values]=\"values?.join(',')\"\r\n       [attr.data-message]=\"message\"\r\n       [attr.data-star-color]=\"starColor\"\r\n       [attr.data-stared-color]=\"staredColor\"\r\n       [attr.data-static]=\"static\"\r\n\r\n       [attr.data-cls-rating]=\"clsRating\"\r\n       [attr.data-cls-stars]=\"clsStars\"\r\n       [attr.data-cls-result]=\"clsResult\">\r\n",
        encapsulation: ViewEncapsulation.None,
        providers: [DefaultValueAccessor.get(RatingComponent_1), TypeAlias.get(RatingComponent_1)],
        changeDetection: ChangeDetectionStrategy.OnPush,
        styles: [".rating.primary .stars li{color:#3969a0}.rating.primary .stars li.on{color:#0366d6}.rating.secondary .stars li{color:#767676}.rating.secondary .stars li.on{color:#607d8b}.rating.success .stars li{color:#607947}.rating.success .stars li.on{color:#60a917}.rating.alert .stars li{color:#906d6b}.rating.alert .stars li.on{color:#ce352c}.rating.warning .stars li{color:#d19c75}.rating.warning .stars li.on{color:#ff9447}.rating.yellow .stars li{color:#e0d3a3}.rating.yellow .stars li.on{color:#ffe484}.rating.info .stars li{color:#8baebf}.rating.info .stars li.on{color:#5ebdec}.rating.dark .stars li,.rating.dark .stars li.on{color:#505050}.rating.light .stars li,.rating.light .stars li.on{color:#f8f8f8}.disabled .rating .stars li.on{color:#e4e4e4!important}"]
    })
], RatingComponent);
export { RatingComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmF0aW5nLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25nLW1ldHJvNC8iLCJzb3VyY2VzIjpbImxpYi9mb3JtL3JhdGluZy9yYXRpbmcuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsT0FBTyxFQUFDLHVCQUF1QixFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxpQkFBaUIsRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUNsSCxPQUFPLEVBQUMsV0FBVyxFQUFDLE1BQU0saUJBQWlCLENBQUM7QUFDNUMsT0FBTyxFQUFDLG9CQUFvQixFQUFDLE1BQU0scUNBQXFDLENBQUM7QUFDekUsT0FBTyxFQUFDLFNBQVMsRUFBQyxNQUFNLHlCQUF5QixDQUFDO0FBQ2xELE9BQU8sRUFBQyxhQUFhLEVBQUMsTUFBTSxNQUFNLENBQUM7QUFFbkMsT0FBTyxFQUFDLFlBQVksRUFBQyxNQUFNLDRCQUE0QixDQUFDO0FBWXhELElBQWEsZUFBZSx1QkFBNUIsTUFBYSxlQUFnQixTQUFRLFdBQTBCO0lBa0I3RCxhQUFhO1FBQ1gsT0FBTyxJQUFJLE9BQU8sQ0FBTyxDQUFDLFFBQVEsRUFBRSxFQUFFO1lBQ3BDLE1BQU0sZUFBZSxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLGFBQWEsQ0FBQyxDQUFDO1lBQ3BELFlBQVksQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLENBQUM7WUFFbkMsSUFBSSxJQUFJLENBQUMsYUFBYSxFQUFFO2dCQUN0QixJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sRUFBRSxDQUFDLE1BQU0sRUFBRSxDQUFDO2FBQ3RDO1lBRUQsSUFBSSxDQUFDLGFBQWEsR0FBRyxlQUFlLENBQUMsS0FBSyxFQUFFLENBQUM7WUFDN0MsWUFBWSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUM7WUFDdEMsZUFBZSxDQUFDLE1BQU0sRUFBRSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUM7WUFFcEQsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sRUFBRSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUV6RCxJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sRUFBRSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFFLEdBQUcsRUFBRTtnQkFDMUQsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1lBQ3ZCLENBQUMsQ0FBQyxDQUFDO1lBRUgsSUFBSSxDQUFDLGFBQWEsQ0FBQyxFQUFFLENBQUMsUUFBUSxFQUFFLEdBQUcsRUFBRTtnQkFDbkMsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxHQUFHLEVBQUUsQ0FBQztnQkFDMUMsTUFBTSxXQUFXLEdBQUcsQ0FBQyxRQUFRLENBQUM7Z0JBRTlCLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLFdBQVcsQ0FBQyxFQUFFO29CQUM5QixJQUFJLENBQUMsV0FBVyxDQUFDLFdBQVcsQ0FBQyxDQUFDO2lCQUMvQjtxQkFBTTtvQkFDTCxJQUFJLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxDQUFDO2lCQUM1QjtZQUNILENBQUMsQ0FBQyxDQUFDO1lBRUgsUUFBUSxFQUFFLENBQUM7UUFDYixDQUFDLENBQUMsQ0FBQztJQUVMLENBQUM7SUFFRCxPQUFPLENBQUMsUUFBaUI7UUFDdkIsSUFBSSxRQUFRLEVBQUU7WUFDWixJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sRUFBRSxDQUFDLE1BQU0sRUFBRSxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsQ0FBQztTQUMzRDthQUFNO1lBQ0wsSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFDLENBQUM7U0FDOUQ7SUFDSCxDQUFDO0lBRUQsUUFBUTtRQUNOLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFO1lBQ2hCLE9BQU87U0FDUjtRQUVELE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsTUFBTSxFQUFFLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ3hELEtBQUssQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFeEIsSUFBSSxJQUFJLENBQUMsTUFBTSxFQUFFO1lBQ2YsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBRW5ELElBQUksS0FBSyxLQUFLLENBQUMsQ0FBQyxFQUFFO2dCQUNoQixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLElBQUksS0FBSyxFQUFFLENBQUMsRUFBRSxFQUFFO29CQUMvQixDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztpQkFDaEM7YUFDRjtTQUNGO2FBQU07WUFDTCxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7U0FDbEM7SUFFSCxDQUFDO0lBRUQsYUFBYSxDQUFDLFVBQW9CLEVBQUUsVUFBb0I7UUFDdEQsYUFBYSxDQUFDLFFBQVEsQ0FBQyxHQUFHLEVBQUU7WUFDMUIsSUFBSSxJQUFJLENBQUMsYUFBYSxFQUFFO2dCQUN0QixNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sRUFBRSxDQUFDO2dCQUUzQyxVQUFVLENBQUMsT0FBTyxDQUFDLENBQUMsR0FBVyxFQUFFLEVBQUU7b0JBQ2pDLE1BQU0sQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUM7Z0JBQzFCLENBQUMsQ0FBQyxDQUFDO2dCQUVILFVBQVUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxHQUFXLEVBQUUsRUFBRTtvQkFDakMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsQ0FBQztnQkFDdkIsQ0FBQyxDQUFDLENBQUM7YUFDSjtRQUNILENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztDQUVGLENBQUE7QUFqR2lCO0lBQWYsS0FBSyxDQUFDLE9BQU8sQ0FBQzs7OENBQWU7QUFDVDtJQUFwQixLQUFLLENBQUMsWUFBWSxDQUFDOztrREFBMEI7QUFDN0I7SUFBaEIsS0FBSyxDQUFDLFFBQVEsQ0FBQzs7K0NBQTJCO0FBQ3pCO0lBQWpCLEtBQUssQ0FBQyxTQUFTLENBQUM7O2dEQUFpQjtBQUNiO0lBQXBCLEtBQUssQ0FBQyxZQUFZLENBQUM7O2tEQUFtQjtBQUNoQjtJQUF0QixLQUFLLENBQUMsY0FBYyxDQUFDOztvREFBcUI7QUFDMUI7SUFBaEIsS0FBSyxDQUFDLFFBQVEsQ0FBQzs7K0NBQWlCO0FBRVo7SUFBcEIsS0FBSyxDQUFDLFlBQVksQ0FBQzs7a0RBQW1CO0FBQ25CO0lBQW5CLEtBQUssQ0FBQyxXQUFXLENBQUM7O2lEQUFrQjtBQUNoQjtJQUFwQixLQUFLLENBQUMsWUFBWSxDQUFDOztrREFBbUI7QUFFRDtJQUFyQyxTQUFTLENBQUMsT0FBTyxFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxDQUFDOzhCQUFnQixVQUFVOzhDQUFDO0FBZHJELGVBQWU7SUFSM0IsU0FBUyxDQUFDO1FBQ1QsUUFBUSxFQUFFLFdBQVc7UUFDckIsd2hCQUFzQztRQUV0QyxhQUFhLEVBQUUsaUJBQWlCLENBQUMsSUFBSTtRQUNyQyxTQUFTLEVBQUUsQ0FBQyxvQkFBb0IsQ0FBQyxHQUFHLENBQUMsaUJBQWUsQ0FBQyxFQUFFLFNBQVMsQ0FBQyxHQUFHLENBQUMsaUJBQWUsQ0FBQyxDQUFDO1FBQ3RGLGVBQWUsRUFBRSx1QkFBdUIsQ0FBQyxNQUFNOztLQUNoRCxDQUFDO0dBQ1csZUFBZSxDQW1HM0I7U0FuR1ksZUFBZSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7Q2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksIENvbXBvbmVudCwgRWxlbWVudFJlZiwgSW5wdXQsIFZpZXdDaGlsZCwgVmlld0VuY2Fwc3VsYXRpb259IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQge0NvbnRyb2xCYXNlfSBmcm9tICcuLi9jb250cm9sLWJhc2UnO1xyXG5pbXBvcnQge0RlZmF1bHRWYWx1ZUFjY2Vzc29yfSBmcm9tICcuLi8uLi9oZWxwZXIvZGVmYXVsdC12YWx1ZS1hY2Nlc3Nvcic7XHJcbmltcG9ydCB7VHlwZUFsaWFzfSBmcm9tICcuLi8uLi9oZWxwZXIvdHlwZS1hbGlhcyc7XHJcbmltcG9ydCB7YXNhcFNjaGVkdWxlcn0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7Um91bmRUeXBlVHlwZX0gZnJvbSAnLi4vLi4vaGVscGVyL3R5cGVzJztcclxuaW1wb3J0IHtPYmplY3RIZWxwZXJ9IGZyb20gJy4uLy4uL2hlbHBlci9vYmplY3QtaGVscGVyJztcclxuXHJcbmRlY2xhcmUgdmFyICQ6IGFueTtcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAnbTQtcmF0aW5nJyxcclxuICB0ZW1wbGF0ZVVybDogJy4vcmF0aW5nLmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi9yYXRpbmcuY29tcG9uZW50Lmxlc3MnXSxcclxuICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lLFxyXG4gIHByb3ZpZGVyczogW0RlZmF1bHRWYWx1ZUFjY2Vzc29yLmdldChSYXRpbmdDb21wb25lbnQpLCBUeXBlQWxpYXMuZ2V0KFJhdGluZ0NvbXBvbmVudCldLFxyXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBSYXRpbmdDb21wb25lbnQgZXh0ZW5kcyBDb250cm9sQmFzZTxzdHJpbmd8bnVtYmVyPiB7XHJcblxyXG4gIEBJbnB1dCgnc3RhcnMnKSBzdGFyczogbnVtYmVyO1xyXG4gIEBJbnB1dCgncm91bmQtZnVuYycpIHJvdW5kRnVuYzogUm91bmRUeXBlVHlwZTtcclxuICBASW5wdXQoJ3ZhbHVlcycpIHZhbHVlczogKHN0cmluZ3xudW1iZXIpW107XHJcbiAgQElucHV0KCdtZXNzYWdlJykgbWVzc2FnZTogc3RyaW5nO1xyXG4gIEBJbnB1dCgnc3Rhci1jb2xvcicpIHN0YXJDb2xvcjogc3RyaW5nO1xyXG4gIEBJbnB1dCgnc3RhcmVkLWNvbG9yJykgc3RhcmVkQ29sb3I6IHN0cmluZztcclxuICBASW5wdXQoJ3N0YXRpYycpIHN0YXRpYzogYm9vbGVhbjtcclxuXHJcbiAgQElucHV0KCdjbHMtcmF0aW5nJykgY2xzUmF0aW5nOiBzdHJpbmc7XHJcbiAgQElucHV0KCdjbHMtc3RhcnMnKSBjbHNTdGFyczogc3RyaW5nO1xyXG4gIEBJbnB1dCgnY2xzLXJlc3VsdCcpIGNsc1Jlc3VsdDogc3RyaW5nO1xyXG5cclxuICBAVmlld0NoaWxkKCdpbnB1dCcsIHsgc3RhdGljOiB0cnVlIH0pIHByaXZhdGUgaW5wdXQ6IEVsZW1lbnRSZWY7XHJcbiAgcHJpdmF0ZSByYXRpbmc6IGFueTtcclxuICBwcml2YXRlIGNsb25lZEVsZW1lbnQ6IGFueTtcclxuXHJcbiAgY3JlYXRlQ29udHJvbCgpIHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZTx2b2lkPigoY29tcGxldGUpID0+IHtcclxuICAgICAgY29uc3Qgb3JpZ2luYWxFbGVtZW50ID0gJCh0aGlzLmlucHV0Lm5hdGl2ZUVsZW1lbnQpO1xyXG4gICAgICBPYmplY3RIZWxwZXIuaGlkZShvcmlnaW5hbEVsZW1lbnQpO1xyXG5cclxuICAgICAgaWYgKHRoaXMuY2xvbmVkRWxlbWVudCkge1xyXG4gICAgICAgIHRoaXMuY2xvbmVkRWxlbWVudC5wYXJlbnQoKS5yZW1vdmUoKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgdGhpcy5jbG9uZWRFbGVtZW50ID0gb3JpZ2luYWxFbGVtZW50LmNsb25lKCk7XHJcbiAgICAgIE9iamVjdEhlbHBlci5zaG93KHRoaXMuY2xvbmVkRWxlbWVudCk7XHJcbiAgICAgIG9yaWdpbmFsRWxlbWVudC5wYXJlbnQoKS5hcHBlbmQodGhpcy5jbG9uZWRFbGVtZW50KTtcclxuXHJcbiAgICAgIHRoaXMucmF0aW5nID0gdGhpcy5jbG9uZWRFbGVtZW50LnJhdGluZygpLmRhdGEoJ3JhdGluZycpO1xyXG5cclxuICAgICAgdGhpcy5jbG9uZWRFbGVtZW50LnBhcmVudCgpLmZpbmQoJ3VsIGxpJykub25lKCdjbGljaycsICgpID0+IHtcclxuICAgICAgICB0aGlzLnRvdWNoQ2FsbGJhY2soKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICB0aGlzLmNsb25lZEVsZW1lbnQub24oJ2NoYW5nZScsICgpID0+IHtcclxuICAgICAgICBjb25zdCBuZXdWYWx1ZSA9IHRoaXMuY2xvbmVkRWxlbWVudC52YWwoKTtcclxuICAgICAgICBjb25zdCB2YWx1ZVBhcnNlZCA9ICtuZXdWYWx1ZTtcclxuXHJcbiAgICAgICAgaWYgKCFOdW1iZXIuaXNOYU4odmFsdWVQYXJzZWQpKSB7XHJcbiAgICAgICAgICB0aGlzLmNoYW5nZVZhbHVlKHZhbHVlUGFyc2VkKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgdGhpcy5jaGFuZ2VWYWx1ZShuZXdWYWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGNvbXBsZXRlKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgfVxyXG5cclxuICBkaXNhYmxlKGRpc2FibGVkOiBib29sZWFuKTogdm9pZCB7XHJcbiAgICBpZiAoZGlzYWJsZWQpIHtcclxuICAgICAgdGhpcy5jbG9uZWRFbGVtZW50LnBhcmVudCgpLnBhcmVudCgpLmFkZENsYXNzKCdkaXNhYmxlZCcpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5jbG9uZWRFbGVtZW50LnBhcmVudCgpLnBhcmVudCgpLnJlbW92ZUNsYXNzKCdkaXNhYmxlZCcpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgbmV3VmFsdWUoKTogdm9pZCB7XHJcbiAgICBpZiAoIXRoaXMucmF0aW5nKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBzdGFycyA9IHRoaXMuY2xvbmVkRWxlbWVudC5wYXJlbnQoKS5maW5kKCd1bCBsaScpO1xyXG4gICAgc3RhcnMucmVtb3ZlQ2xhc3MoJ29uJyk7XHJcblxyXG4gICAgaWYgKHRoaXMudmFsdWVzKSB7XHJcbiAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy52YWx1ZXMuaW5kZXhPZih0aGlzLmlubmVyVmFsdWUpO1xyXG5cclxuICAgICAgaWYgKGluZGV4ICE9PSAtMSkge1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDw9IGluZGV4OyBpKyspIHtcclxuICAgICAgICAgICQoc3RhcnMuZ2V0KGkpKS5hZGRDbGFzcygnb24nKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMucmF0aW5nLnZhbCh0aGlzLmlubmVyVmFsdWUpO1xyXG4gICAgfVxyXG5cclxuICB9XHJcblxyXG4gIG5ld0NsYXNzVmFsdWUobmV3Q2xhc3Nlczogc3RyaW5nW10sIG9sZENsYXNzZXM6IHN0cmluZ1tdKSB7XHJcbiAgICBhc2FwU2NoZWR1bGVyLnNjaGVkdWxlKCgpID0+IHtcclxuICAgICAgaWYgKHRoaXMuY2xvbmVkRWxlbWVudCkge1xyXG4gICAgICAgIGNvbnN0IHRhcmdldCA9IHRoaXMuY2xvbmVkRWxlbWVudC5wYXJlbnQoKTtcclxuXHJcbiAgICAgICAgb2xkQ2xhc3Nlcy5mb3JFYWNoKChjbHM6IHN0cmluZykgPT4ge1xyXG4gICAgICAgICAgdGFyZ2V0LnJlbW92ZUNsYXNzKGNscyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIG5ld0NsYXNzZXMuZm9yRWFjaCgoY2xzOiBzdHJpbmcpID0+IHtcclxuICAgICAgICAgIHRhcmdldC5hZGRDbGFzcyhjbHMpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG59XHJcbiJdfQ==