var KeypadComponent_1;
import { __decorate, __metadata } from "tslib";
import { ChangeDetectionStrategy, Component, ElementRef, Input, ViewChild } from '@angular/core';
import { DefaultValueAccessor } from '../../helper/default-value-accessor';
import { ControlBase } from '../control-base';
import { TypeAlias } from '../../helper/type-alias';
import { asapScheduler } from 'rxjs';
import { ObjectHelper } from '../../helper/object-helper';
let KeypadComponent = KeypadComponent_1 = class KeypadComponent extends ControlBase {
    constructor() {
        super(...arguments);
        this.type = 'text';
    }
    createControl() {
        return new Promise((complete) => {
            const originalElement = $(this.input.nativeElement);
            ObjectHelper.hide(originalElement);
            if (this.clonedElement) {
                this.clonedElement.parent().remove();
            }
            this.clonedElement = originalElement.clone();
            ObjectHelper.show(this.clonedElement);
            originalElement.parent().append(this.clonedElement);
            this.keypad = this.clonedElement.keypad().data('keypad');
            this.clonedElement.one('blur', () => {
                this.touchCallback();
            });
            this.clonedElement.on('change', () => {
                asapScheduler.schedule(() => {
                    let newValue = this.clonedElement.val();
                    if (this.type === 'number') {
                        newValue = +newValue;
                    }
                    this.changeValue(newValue);
                });
            });
            complete();
        });
    }
    disable(disabled) {
        if (disabled) {
            this.keypad.disable();
        }
        else {
            this.keypad.enable();
        }
    }
    newValue() {
        if (!this.keypad) {
            return;
        }
        this.keypad.val(this.innerValue ? this.innerValue.toString() : '');
    }
    newClassValue(newClasses, oldClasses) {
        if (this.clonedElement) {
            const target = this.clonedElement.parent();
            oldClasses.forEach((cls) => {
                target.removeClass(cls);
            });
            newClasses.forEach((cls) => {
                target.addClass(cls);
            });
        }
    }
};
__decorate([
    Input('type'),
    __metadata("design:type", String)
], KeypadComponent.prototype, "type", void 0);
__decorate([
    Input('key-size'),
    __metadata("design:type", Number)
], KeypadComponent.prototype, "keySize", void 0);
__decorate([
    Input('keys'),
    __metadata("design:type", Array)
], KeypadComponent.prototype, "keys", void 0);
__decorate([
    Input('key-length'),
    __metadata("design:type", Number)
], KeypadComponent.prototype, "keyLength", void 0);
__decorate([
    Input('shuffle'),
    __metadata("design:type", Boolean)
], KeypadComponent.prototype, "shuffle", void 0);
__decorate([
    Input('shuffle-count'),
    __metadata("design:type", Number)
], KeypadComponent.prototype, "shuffleCount", void 0);
__decorate([
    Input('position'),
    __metadata("design:type", String)
], KeypadComponent.prototype, "position", void 0);
__decorate([
    Input('dynamic-position'),
    __metadata("design:type", Boolean)
], KeypadComponent.prototype, "dynamicPosition", void 0);
__decorate([
    Input('service-buttons'),
    __metadata("design:type", Boolean)
], KeypadComponent.prototype, "serviceButtons", void 0);
__decorate([
    Input('show-value'),
    __metadata("design:type", Boolean)
], KeypadComponent.prototype, "showValue", void 0);
__decorate([
    Input('open'),
    __metadata("design:type", Boolean)
], KeypadComponent.prototype, "open", void 0);
__decorate([
    Input('size-as-keys'),
    __metadata("design:type", Boolean)
], KeypadComponent.prototype, "sizeAsKeys", void 0);
__decorate([
    Input('cls-keypad'),
    __metadata("design:type", String)
], KeypadComponent.prototype, "clsKeypad", void 0);
__decorate([
    Input('cls-input'),
    __metadata("design:type", String)
], KeypadComponent.prototype, "clsInput", void 0);
__decorate([
    Input('cls-keys'),
    __metadata("design:type", String)
], KeypadComponent.prototype, "clsKeys", void 0);
__decorate([
    Input('cls-key'),
    __metadata("design:type", String)
], KeypadComponent.prototype, "clsKey", void 0);
__decorate([
    Input('cls-service-key'),
    __metadata("design:type", String)
], KeypadComponent.prototype, "clsServiceKey", void 0);
__decorate([
    Input('cls-backspace'),
    __metadata("design:type", String)
], KeypadComponent.prototype, "clsBackspace", void 0);
__decorate([
    Input('cls-clear'),
    __metadata("design:type", String)
], KeypadComponent.prototype, "clsClear", void 0);
__decorate([
    ViewChild('input', { static: true }),
    __metadata("design:type", ElementRef)
], KeypadComponent.prototype, "input", void 0);
KeypadComponent = KeypadComponent_1 = __decorate([
    Component({
        selector: 'm4-keypad',
        template: "<input [type]=\"type\" #input\r\n\r\n\r\n       [attr.data-key-size]=\"keySize\"\r\n       [attr.data-keys]=\"keys?.join(',')\"\r\n       [attr.data-key-length]=\"keyLength\"\r\n       [attr.data-shuffle]=\"shuffle\"\r\n       [attr.data-shuffle-count]=\"shuffleCount\"\r\n       [attr.data-position]=\"position\"\r\n       [attr.data-dynamic-position]=\"dynamicPosition\"\r\n       [attr.data-service-buttons]=\"serviceButtons\"\r\n       [attr.data-show-value]=\"showValue\"\r\n       [attr.data-open]=\"open\"\r\n       [attr.data-size-as-keys]=\"sizeAsKeys\"\r\n\r\n       [attr.data-cls-keypad]=\"clsKeypad\"\r\n       [attr.data-cls-input]=\"clsInput\"\r\n       [attr.data-cls-keys]=\"clsKeys\"\r\n       [attr.data-cls-key]=\"clsKey\"\r\n       [attr.data-cls-service-key]=\"clsServiceKey\"\r\n       [attr.data-cls-backspace]=\"clsBackspace\"\r\n       [attr.data-cls-clear]=\"clsClear\">\r\n",
        providers: [DefaultValueAccessor.get(KeypadComponent_1), TypeAlias.get(KeypadComponent_1)],
        changeDetection: ChangeDetectionStrategy.OnPush,
        styles: [""]
    })
], KeypadComponent);
export { KeypadComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoia2V5cGFkLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25nLW1ldHJvNC8iLCJzb3VyY2VzIjpbImxpYi9mb3JtL2tleXBhZC9rZXlwYWQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsT0FBTyxFQUFDLHVCQUF1QixFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUMvRixPQUFPLEVBQUMsb0JBQW9CLEVBQUMsTUFBTSxxQ0FBcUMsQ0FBQztBQUN6RSxPQUFPLEVBQUMsV0FBVyxFQUFDLE1BQU0saUJBQWlCLENBQUM7QUFFNUMsT0FBTyxFQUFDLFNBQVMsRUFBQyxNQUFNLHlCQUF5QixDQUFDO0FBQ2xELE9BQU8sRUFBQyxhQUFhLEVBQUMsTUFBTSxNQUFNLENBQUM7QUFDbkMsT0FBTyxFQUFDLFlBQVksRUFBQyxNQUFNLDRCQUE0QixDQUFDO0FBV3hELElBQWEsZUFBZSx1QkFBNUIsTUFBYSxlQUFnQixTQUFRLFdBQTBCO0lBQS9EOztRQUVpQixTQUFJLEdBQWMsTUFBTSxDQUFDO0lBNEYxQyxDQUFDO0lBbkVDLGFBQWE7UUFDWCxPQUFPLElBQUksT0FBTyxDQUFPLENBQUMsUUFBUSxFQUFFLEVBQUU7WUFDcEMsTUFBTSxlQUFlLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFDLENBQUM7WUFDcEQsWUFBWSxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQztZQUVuQyxJQUFJLElBQUksQ0FBQyxhQUFhLEVBQUU7Z0JBQ3RCLElBQUksQ0FBQyxhQUFhLENBQUMsTUFBTSxFQUFFLENBQUMsTUFBTSxFQUFFLENBQUM7YUFDdEM7WUFFRCxJQUFJLENBQUMsYUFBYSxHQUFHLGVBQWUsQ0FBQyxLQUFLLEVBQUUsQ0FBQztZQUM3QyxZQUFZLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQztZQUN0Qyxl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O0FBRXRCO0lBQXBCLEtBQUssQ0FBQyxZQUFZLENBQUM7O2tEQUFtQjtBQUNuQjtJQUFuQixLQUFLLENBQUMsV0FBVyxDQUFDOztpREFBa0I7QUFDbEI7SUFBbEIsS0FBSyxDQUFDLFVBQVUsQ0FBQzs7Z0RBQWlCO0FBQ2pCO0lBQWpCLEtBQUssQ0FBQyxTQUFTLENBQUM7OytDQUFnQjtBQUNQO0lBQXpCLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQzs7c0RBQXVCO0FBQ3hCO0lBQXZCLEtBQUssQ0FBQyxlQUFlLENBQUM7O3FEQUFzQjtBQUN6QjtJQUFuQixLQUFLLENBQUMsV0FBVyxDQUFDOztpREFBa0I7QUFFQztJQUFyQyxTQUFTLENBQUMsT0FBTyxFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxDQUFDOzhCQUFnQixVQUFVOzhDQUFDO0FBdkJyRCxlQUFlO0lBUDNCLFNBQVMsQ0FBQztRQUNULFFBQVEsRUFBRSxXQUFXO1FBQ3JCLGk1QkFBc0M7UUFFdEMsU0FBUyxFQUFFLENBQUMsb0JBQW9CLENBQUMsR0FBRyxDQUFDLGlCQUFlLENBQUMsRUFBRSxTQUFTLENBQUMsR0FBRyxDQUFDLGlCQUFlLENBQUMsQ0FBQztRQUN0RixlQUFlLEVBQUUsdUJBQXVCLENBQUMsTUFBTTs7S0FDaEQsQ0FBQztHQUNXLGVBQWUsQ0E4RjNCO1NBOUZZLGVBQWUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0NoYW5nZURldGVjdGlvblN0cmF0ZWd5LCBDb21wb25lbnQsIEVsZW1lbnRSZWYsIElucHV0LCBWaWV3Q2hpbGR9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQge0RlZmF1bHRWYWx1ZUFjY2Vzc29yfSBmcm9tICcuLi8uLi9oZWxwZXIvZGVmYXVsdC12YWx1ZS1hY2Nlc3Nvcic7XHJcbmltcG9ydCB7Q29udHJvbEJhc2V9IGZyb20gJy4uL2NvbnRyb2wtYmFzZSc7XHJcbmltcG9ydCB7SW5wdXRUeXBlLCBQb3NpdGlvblR5cGV9IGZyb20gJy4uLy4uL2hlbHBlci90eXBlcyc7XHJcbmltcG9ydCB7VHlwZUFsaWFzfSBmcm9tICcuLi8uLi9oZWxwZXIvdHlwZS1hbGlhcyc7XHJcbmltcG9ydCB7YXNhcFNjaGVkdWxlcn0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7T2JqZWN0SGVscGVyfSBmcm9tICcuLi8uLi9oZWxwZXIvb2JqZWN0LWhlbHBlcic7XHJcblxyXG5kZWNsYXJlIHZhciAkOiBhbnk7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ200LWtleXBhZCcsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL2tleXBhZC5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4va2V5cGFkLmNvbXBvbmVudC5jc3MnXSxcclxuICBwcm92aWRlcnM6IFtEZWZhdWx0VmFsdWVBY2Nlc3Nvci5nZXQoS2V5cGFkQ29tcG9uZW50KSwgVHlwZUFsaWFzLmdldChLZXlwYWRDb21wb25lbnQpXSxcclxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaFxyXG59KVxyXG5leHBvcnQgY2xhc3MgS2V5cGFkQ29tcG9uZW50IGV4dGVuZHMgQ29udHJvbEJhc2U8c3RyaW5nfG51bWJlcj4ge1xyXG5cclxuICBASW5wdXQoJ3R5cGUnKSB0eXBlOiBJbnB1dFR5cGUgPSAndGV4dCc7XHJcbiAgQElucHV0KCdrZXktc2l6ZScpIGtleVNpemU6IG51bWJlcjtcclxuICBASW5wdXQoJ2tleXMnKSBrZXlzOiBzdHJpbmdbXTtcclxuICBASW5wdXQoJ2tleS1sZW5ndGgnKSBrZXlMZW5ndGg6IG51bWJlcjtcclxuICBASW5wdXQoJ3NodWZmbGUnKSBzaHVmZmxlOiBib29sZWFuO1xyXG4gIEBJbnB1dCgnc2h1ZmZsZS1jb3VudCcpIHNodWZmbGVDb3VudDogbnVtYmVyO1xyXG4gIEBJbnB1dCgncG9zaXRpb24nKSBwb3NpdGlvbjogUG9zaXRpb25UeXBlO1xyXG4gIEBJbnB1dCgnZHluYW1pYy1wb3NpdGlvbicpIGR5bmFtaWNQb3NpdGlvbjogYm9vbGVhbjtcclxuICBASW5wdXQoJ3NlcnZpY2UtYnV0dG9ucycpIHNlcnZpY2VCdXR0b25zOiBib29sZWFuO1xyXG4gIEBJbnB1dCgnc2hvdy12YWx1ZScpIHNob3dWYWx1ZTogYm9vbGVhbjtcclxuICBASW5wdXQoJ29wZW4nKSBvcGVuOiBib29sZWFuO1xyXG4gIEBJbnB1dCgnc2l6ZS1hcy1rZXlzJykgc2l6ZUFzS2V5czogYm9vbGVhbjtcclxuXHJcbiAgQElucHV0KCdjbHMta2V5cGFkJykgY2xzS2V5cGFkOiBzdHJpbmc7XHJcbiAgQElucHV0KCdjbHMtaW5wdXQnKSBjbHNJbnB1dDogc3RyaW5nO1xyXG4gIEBJbnB1dCgnY2xzLWtleXMnKSBjbHNLZXlzOiBzdHJpbmc7XHJcbiAgQElucHV0KCdjbHMta2V5JykgY2xzS2V5OiBzdHJpbmc7XHJcbiAgQElucHV0KCdjbHMtc2VydmljZS1rZXknKSBjbHNTZXJ2aWNlS2V5OiBzdHJpbmc7XHJcbiAgQElucHV0KCdjbHMtYmFja3NwYWNlJykgY2xzQmFja3NwYWNlOiBzdHJpbmc7XHJcbiAgQElucHV0KCdjbHMtY2xlYXInKSBjbHNDbGVhcjogc3RyaW5nO1xyXG5cclxuICBAVmlld0NoaWxkKCdpbnB1dCcsIHsgc3RhdGljOiB0cnVlIH0pIHByaXZhdGUgaW5wdXQ6IEVsZW1lbnRSZWY7XHJcbiAgcHJpdmF0ZSBrZXlwYWQ6IGFueTtcclxuICBwcml2YXRlIGNsb25lZEVsZW1lbnQ6IGFueTtcclxuXHJcbiAgY3JlYXRlQ29udHJvbCgpIHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZTx2b2lkPigoY29tcGxldGUpID0+IHtcclxuICAgICAgY29uc3Qgb3JpZ2luYWxFbGVtZW50ID0gJCh0aGlzLmlucHV0Lm5hdGl2ZUVsZW1lbnQpO1xyXG4gICAgICBPYmplY3RIZWxwZXIuaGlkZShvcmlnaW5hbEVsZW1lbnQpO1xyXG5cclxuICAgICAgaWYgKHRoaXMuY2xvbmVkRWxlbWVudCkge1xyXG4gICAgICAgIHRoaXMuY2xvbmVkRWxlbWVudC5wYXJlbnQoKS5yZW1vdmUoKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgdGhpcy5jbG9uZWRFbGVtZW50ID0gb3JpZ2luYWxFbGVtZW50LmNsb25lKCk7XHJcbiAgICAgIE9iamVjdEhlbHBlci5zaG93KHRoaXMuY2xvbmVkRWxlbWVudCk7XHJcbiAgICAgIG9yaWdpbmFsRWxlbWVudC5wYXJlbnQoKS5hcHBlbmQodGhpcy5jbG9uZWRFbGVtZW50KTtcclxuXHJcbiAgICAgIHRoaXMua2V5cGFkID0gdGhpcy5jbG9uZWRFbGVtZW50LmtleXBhZCgpLmRhdGEoJ2tleXBhZCcpO1xyXG5cclxuICAgICAgdGhpcy5jbG9uZWRFbGVtZW50Lm9uZSgnYmx1cicsICgpID0+IHtcclxuICAgICAgICB0aGlzLnRvdWNoQ2FsbGJhY2soKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICB0aGlzLmNsb25lZEVsZW1lbnQub24oJ2NoYW5nZScsICgpID0+IHtcclxuICAgICAgICBhc2FwU2NoZWR1bGVyLnNjaGVkdWxlKCgpID0+IHtcclxuICAgICAgICAgIGxldCBuZXdWYWx1ZSA9IHRoaXMuY2xvbmVkRWxlbWVudC52YWwoKTtcclxuXHJcbiAgICAgICAgICBpZiAodGhpcy50eXBlID09PSAnbnVtYmVyJykge1xyXG4gICAgICAgICAgICBuZXdWYWx1ZSA9ICtuZXdWYWx1ZTtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICB0aGlzLmNoYW5nZVZhbHVlKG5ld1ZhbHVlKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb21wbGV0ZSgpO1xyXG4gICAgfSk7XHJcblxyXG5cclxuICB9XHJcblxyXG4gIGRpc2FibGUoZGlzYWJsZWQ6IGJvb2xlYW4pOiB2b2lkIHtcclxuICAgIGlmIChkaXNhYmxlZCkge1xyXG4gICAgICB0aGlzLmtleXBhZC5kaXNhYmxlKCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLmtleXBhZC5lbmFibGUoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIG5ld1ZhbHVlKCk6IHZvaWQge1xyXG4gICAgaWYgKCF0aGlzLmtleXBhZCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5rZXlwYWQudmFsKHRoaXMuaW5uZXJWYWx1ZSA/IHRoaXMuaW5uZXJWYWx1ZS50b1N0cmluZygpIDogJycpO1xyXG4gIH1cclxuXHJcbiAgbmV3Q2xhc3NWYWx1ZShuZXdDbGFzc2VzOiBzdHJpbmdbXSwgb2xkQ2xhc3Nlczogc3RyaW5nW10pIHtcclxuICAgIGlmICh0aGlzLmNsb25lZEVsZW1lbnQpIHtcclxuICAgICAgY29uc3QgdGFyZ2V0ID0gdGhpcy5jbG9uZWRFbGVtZW50LnBhcmVudCgpO1xyXG5cclxuICAgICAgb2xkQ2xhc3Nlcy5mb3JFYWNoKChjbHM6IHN0cmluZykgPT4ge1xyXG4gICAgICAgIHRhcmdldC5yZW1vdmVDbGFzcyhjbHMpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIG5ld0NsYXNzZXMuZm9yRWFjaCgoY2xzOiBzdHJpbmcpID0+IHtcclxuICAgICAgICB0YXJnZXQuYWRkQ2xhc3MoY2xzKTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxufVxyXG4iXX0=